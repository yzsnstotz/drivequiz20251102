⚠️ 你只需要在每次任务开始前粘贴这一段即可。
⚠️ 可定制内容：仅允许修改「规范文件路径」与「结构文件路径」。
⚠️ 本指令头不包含任何任务内容。

📌 【指令头 v4.0 — 统一研发规范执行机制】

接下来所有任务执行必须严格遵守以下要求。
任何违反都视为任务失败，必须在执行报告中标注并修正。

🔒 ① 必须严格阅读并遵守以下规范文件（可自行修改路径）：
【核心架构规范】（必须遵守）

docs/研发规范/🧩 AI 服务研发规范（ai-service 统一架构规范 v1.0）.md

docs/研发规范/🧩 AI 核心服务规范（ai-core 统一架构规范 v2.0）.md

【数据库结构文档】（对应修改需同步更新）

docs/研发规范/数据库结构_DRIVEQUIZ.md

docs/研发规范/数据库结构_AI_SERVICE.md

【文件结构文档】（涉及文件变动需同步更新）

docs/研发规范/文件结构.md

🟥 ② 在执行任务前，你必须先完成「规范对齐检查」

在执行任何任务之前，必须输出一段简短摘要（5–8 行）：

你已阅读上述所有规范

本任务会受哪些规范约束

哪些规范条款与你的执行逻辑强相关（仅编号，如 A1、A2、B1、C1…）

提前列出会受影响的文件（只列路径，不讲内容）

⚠️ 未提供这段摘要，任务视为失败。

🧱 ③ 强制「红线规范机制」

以下规则始终有效，必须逐条遵守：

A. 架构红线

A1. 路由层禁止承载业务逻辑
A2. 所有核心逻辑必须写入 ai-core
A3. ai-service 与 local-ai-service 行为必须完全一致
A4. 接口参数、返回结构必须同步统一

B. 数据与结构红线

B1. 任何数据库字段变更必须更新数据库结构文件
B2. 任何文件新增/删除/迁移必须更新文件结构文档

C. 测试红线

C1. 若涉及 AI 调用，必须同时测试：

本地 local-ai-service

远程 ai-service（真实 URL）
C2. 必须附带测试日志摘要

D. 报告红线

D1. 执行完毕必须按模板输出
D2. 必须逐条对照红线 A1–D2 标记「已遵守 / 不适用 / 必须修复」

⚠️ 未逐条自检则视为任务不合格。

🛠 ④ 若任务涉及数据库迁移：

你必须在执行报告中明确：

迁移脚本名称

作用的数据库（DriveQuiz / AiService）

变更项

同步更新两份数据库结构文档

🗂 ⑤ 若任务涉及文件结构变更：

必须更新：

docs/研发规范/文件结构.md

并在执行报告列出：

新增文件

删除文件

路径变更

目录调整

🧪 ⑥ 若任务需要跑脚本或测试：

你必须：

自动执行脚本，不得要求用户手动执行

在执行报告输出：

执行命令

执行日志

结果摘要

如果测试失败，必须自动继续排查并修复

📑 ⑦ 最终必须输出「执行报告」（固定模板）

路径格式：
docs/问题修复/<问题文件夹>/执行报告/

必须包含：

任务摘要

修改文件列表

逐条红线规范自检

测试结果（本地 + 远程）

迁移脚本（如有）

更新后的规范文档（如有变动）