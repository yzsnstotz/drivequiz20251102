@ä¿®å¤æŒ‡ä»¤å¤´05ç‰ˆï¼ˆç°ç”¨ï¼‰.md (1-188) 

# ===========================================
#    ğŸ”§ Google OAuth ç™»å½•ä¿®å¤ â€” ç»ˆæç¨³å®šæ–¹æ¡ˆ
# ===========================================

è¯·ä¸¥æ ¼æŒ‰ä»¥ä¸‹æ­¥éª¤ä¿®å¤ï¼Œä¸å¾—çœç•¥ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘  ç»Ÿä¸€ OAuth å›è°ƒè·¯ç”±ç»“æ„ï¼ˆå¼ºåˆ¶å›ºå®šï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

åœ¨ Next.jsï¼ˆapps/webï¼‰ä¸­åˆ›å»ºæˆ–è¦†ç›–ï¼š

  /app/api/auth/[provider]/route.ts

å†…å®¹å¿…é¡»ä¸ºï¼š

import { authHandler } from "@/lib/authHandler";

export const GET = authHandler;
export const POST = authHandler;

âš ï¸ å¿…é¡»ä¿è¯ï¼š
- æ–‡ä»¶å EXACTLY: [provider]/route.ts
- GET + POST éƒ½è¦ export
- route.ts ä¸å¾—å‡ºç° React Component
- ä¸å¾—ä½¿ç”¨ default export

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘¡ ä¿®å¤ authHandlerï¼ˆç»Ÿä¸€ OAuth Pipelineï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç¡®ä¿ authHandler å†…å®¹å¦‚ä¸‹ï¼š

import { createRouteHandlerClient } from "@supabase/auth-helpers-nextjs";
import { cookies } from "next/headers";

export function authHandler(request) {
  const supabase = createRouteHandlerClient({ cookies });

  return supabase.auth.signInWithOAuth({
    provider: request.nextUrl.pathname.split("/").pop(),
    options: {
      redirectTo: `${process.env.NEXT_PUBLIC_SITE_URL}/auth/callback`
    }
  });
}

âš ï¸ redirectTo å¿…é¡»å¼ºåˆ¶ä¸ºï¼š

  https://ä½ çš„åŸŸå/auth/callback

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘¢ ä¿®å¤ OAuth Callback é¡µé¢
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

åœ¨ /app/auth/callback/route.ts åˆ›å»ºï¼š

import { createRouteHandlerClient } from "@supabase/auth-helpers-nextjs";
import { cookies } from "next/headers";

export async function GET(request) {
  const supabase = createRouteHandlerClient({ cookies });
  await supabase.auth.getSession();

  return Response.redirect(`${process.env.NEXT_PUBLIC_SITE_URL}/dashboard`);
}

âš ï¸ å¿…é¡»ä¿è¯ï¼š
- callback ä¸è¿›è¡Œä¸šåŠ¡é€»è¾‘
- åªæ¢å¤ sessionï¼Œç„¶åè·³è½¬

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘£ ä¿®å¤ supabase browser client
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

apps/web/lib/supabaseClient.ts å¿…é¡»ï¼š

export const supabase = createBrowserClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL,
  process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
  {
    auth: {
      autoRefreshToken: true,
      persistSession: true,
      detectSessionInUrl: true
    }
  }
);

é˜²æ­¢ session ä¸è‡ªåŠ¨æ¢å¤ å¯¼è‡´ Google ç™»å½•å›è°ƒå¤±è´¥ã€‚

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘¤ ä¿®å¤ middleware.ts
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ç¡®ä¿ middleware ä¸ä¼šæ‹¦æˆª OAuthï¼š

export const config = {
  matcher: [
    "/((?!api/auth|auth/callback|_next|static|favicon).*)"
  ]
};

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘¥ ä¿®å¤ç¯å¢ƒå˜é‡ï¼ˆå¿…é¡»ç»Ÿä¸€ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

.env.local ä¸­å¿…é¡»ï¼š

NEXT_PUBLIC_SITE_URL="https://ä½ çš„åŸŸå"
SUPABASE_URL="https://xxxxx.supabase.co"
SUPABASE_ANON_KEY="xxxxxx"

å¹¶ä¸”ï¼š

Google Cloud Console â†’ OAuth â†’ Authorized redirect URI  
å¿…é¡»æ·»åŠ ï¼š

https://ä½ çš„åŸŸå/auth/callback

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â‘¦ è‡ªåŠ¨è¿›è¡Œå®Œæ•´è‡ªæµ‹ï¼ˆCursor å¿…é¡»æ‰§è¡Œï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. yarn dev or pnpm dev
2. æ‰“å¼€ http://localhost:3000/login
3. ç‚¹å‡» â€œSign in with Googleâ€
4. å¿…é¡»è·³è½¬åˆ° Google
5. è°·æ­ŒéªŒè¯åå¿…é¡»è·³è½¬å› /auth/callback
6. å¿…é¡»çœ‹åˆ° network ä¸­ session å­˜å…¥ supabase-auth-token
7. å¿…é¡»è‡ªåŠ¨è·³è½¬åˆ° dashboard

ç¡®è®¤å…¨éƒ¨é€šè¿‡åæ ‡è®°ä»»åŠ¡ä¸º succeededã€‚
