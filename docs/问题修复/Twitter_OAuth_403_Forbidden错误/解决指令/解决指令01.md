âš ï¸ å‰ç½®çº¦æŸï¼šä¿æŒç°æœ‰ ä¿®å¤æŒ‡ä»¤å¤´05ç‰ˆ ä¸å˜ï¼Œä¸‹é¢æ˜¯æœ¬æ¬¡ä»»åŠ¡çš„å…·ä½“ä¿®æ”¹å†…å®¹ã€‚

ğŸ›  ä»»åŠ¡ï¼šè¡¥å…¨ Twitter OAuth2 scopeï¼Œä¿®å¤ /2/users/me 403

ç›®æ ‡ï¼š

åœ¨ä¿æŒç°æœ‰ Twitter OAuth2 æµç¨‹ä¸å˜çš„å‰æä¸‹ï¼Œè¡¥å…¨æˆæƒ scopeï¼Œç¡®ä¿è·å–åˆ°çš„ access token å…·å¤‡è°ƒç”¨ /2/users/me æ‰€éœ€çš„æƒé™ã€‚

ä¿®å¤åï¼Œç”¨æˆ·ä½¿ç”¨ Twitter ç™»å½•æ—¶ï¼Œ/2/users/me ä¸å†è¿”å› 403 Forbiddenã€‚

â‘  ä¿®æ”¹æ–‡ä»¶ä¸ä½ç½®

æ–‡ä»¶è·¯å¾„ï¼šsrc/lib/providers/twitter.ts

ç›®æ ‡ä½ç½®ï¼šTwitterProvider å‡½æ•°å†…çš„ authorization.params.scope é…ç½®ï¼ˆç›®å‰æ˜¯ "users.read offline.access"ï¼‰

â‘¡ å…·ä½“ä¿®æ”¹å†…å®¹

æ›´æ–° scope å­—ç¬¦ä¸²

å°†ï¼š

authorization: {
  url: "https://x.com/i/oauth2/authorize",
  params: {
    scope: "users.read offline.access", // åªè¯·æ±‚å¿…è¦çš„æƒé™ï¼Œä¸åŒ…å« tweet.read
    response_type: "code",
  },
},


ä¿®æ”¹ä¸ºï¼š

authorization: {
  url: "https://x.com/i/oauth2/authorize",
  params: {
    // è¯·æ±‚ Twitter OAuth2 user context æ‰€éœ€çš„å®Œæ•´æœ€å°æƒé™
    // è¯´æ˜ï¼š
    // - users.read: è·å–ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    // - tweet.read: ç›®å‰ /2/users/me ç­‰ v2 ç«¯ç‚¹åœ¨ OAuth2 user context ä¸‹å®é™…éœ€è¦è¯¥ scopeï¼Œå¦åˆ™å®¹æ˜“è¿”å› 403
    // - offline.access: è·å– refresh tokenï¼Œæ”¯æŒé•¿æœŸç™»å½•
    scope: "users.read tweet.read offline.access",
    response_type: "code",
  },
},


ä¿ç•™ç°æœ‰ userinfo.request æ—¥å¿—ä¸é”™è¯¯å¤„ç†é€»è¾‘ï¼Œä¸åšè°ƒæ•´

ä¸è¦æ”¹åŠ¨ userinfo.request çš„å®ç°ï¼Œå®ƒç›®å‰å·²ç»ç»™å‡ºäº†è¾ƒå®Œæ•´çš„è°ƒè¯•ä¿¡æ¯ã€‚

æœ¬æ¬¡ä»»åŠ¡åªèšç„¦åœ¨ æˆæƒé˜¶æ®µ scope ä¸è¶³ è¿™ä¸ªç‚¹ä¸Šã€‚

â‘¢ éªŒè¯æ­¥éª¤ï¼ˆè®© Cursor å†™åˆ°æ‰§è¡ŒæŠ¥å‘Šé‡Œï¼‰

ä¿®æ”¹å®Œæˆåï¼Œè¯·æŒ‰ä¸‹é¢æ­¥éª¤è‡ªæ£€ï¼Œå¹¶åœ¨æ‰§è¡ŒæŠ¥å‘Šä¸­æ˜ç¡®å†™å‡ºç»“æœï¼š

é‡å¯ dev æœåŠ¡

npm run dev


åŠŸèƒ½éªŒè¯

æ‰“å¼€ http://localhost:3000/login

ç‚¹å‡»ã€Œä½¿ç”¨ Twitter ç™»å½•ã€

å®Œæˆæˆæƒæµç¨‹

æ—¥å¿—éªŒè¯

åœ¨ dev server æ§åˆ¶å°ä¸­ç¡®è®¤ä»¥ä¸‹å‡ ç‚¹ï¼š

çœ‹åˆ°æ–°çš„ scope æ—¥å¿—ï¼Œç±»ä¼¼ï¼š

[Twitter Provider] Scope from token: users.read tweet.read offline.access


å†æ¬¡è°ƒç”¨ /2/users/me æ—¶ï¼š

âœ… æ­£å¸¸æƒ…å†µä¸‹åº”çœ‹åˆ°ï¼š

[Twitter Provider] Userinfo response status: 200 OK
[Twitter Provider] Userinfo response received
[Twitter Provider] Profile data: { ... }


âŒ å¦‚æœä»ç„¶æ˜¯ 403ï¼Œè¯·åœ¨æ‰§è¡ŒæŠ¥å‘Šä¸­åŒæ—¶é™„ä¸Šï¼š

å®Œæ•´ scope æ—¥å¿—

Userinfo response status ä¸ Userinfo request error response çš„åŸæ–‡

å‰ç«¯è¡Œä¸º

é¡µé¢ä¸å†è·³è½¬åˆ° /login/error?error=Configuration

Twitter ç™»å½•åèƒ½æ­£å¸¸å›åˆ°é¦–é¡µæˆ–é¢„æœŸé¡µé¢

â‘£ ä¸ç°æœ‰ã€Šè§£å†³æŒ‡ä»¤01ã€‹çš„å…³ç³»è¯´æ˜ï¼ˆé¡»å†™å…¥æŠ¥å‘Šï¼‰

åœ¨æ‰§è¡ŒæŠ¥å‘Šä¸­è¡¥å……ä¸€æ®µè¯´æ˜ï¼š

ä¹‹å‰çš„ã€Šè§£å†³æŒ‡ä»¤01ã€‹å‡è®¾â€œä»£ç å®Œå…¨æ­£ç¡®ï¼Œä»…ä¸º Twitter åº”ç”¨é…ç½®é—®é¢˜â€ã€‚

é€šè¿‡æœ¬æ¬¡ä¿®å¤ï¼Œå¯ä»¥ç¡®è®¤ï¼š

Twitter Developer Portal é…ç½®ä»éœ€æŒ‰æ£€æŸ¥æ¸…å•æ ¸å¯¹ï¼›

ä½†ä»£ç ä¸­ scope é…ç½® users.read offline.access æ˜¾ç„¶ä¸è¶³ï¼Œå¿…é¡»è¡¥å…¨ tweet.read æ‰ç¬¦åˆå½“å‰ X API å¯¹ /2/users/me çš„è¦æ±‚ã€‚

å› æ­¤ï¼Œé—®é¢˜å±äºã€Œé…ç½® + scope è¯·æ±‚ä¸å®Œæ•´ çš„ç»„åˆåŸå› ã€ï¼Œä¸æ˜¯å•çº¯çš„ Portal é…ç½®é—®é¢˜ã€‚