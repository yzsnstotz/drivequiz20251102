# Twitter OAuth 2.0 403 Forbidden é”™è¯¯è¯Šæ–­æŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2025-11-26  
**é—®é¢˜ID**: TWITTER-OAUTH-20251126-001

---

## ğŸ“Œ ç¬¬ä¸€éƒ¨åˆ†ï¼šé—®é¢˜æ¦‚è¦ï¼ˆSummaryï¼‰

| å­—æ®µ | å¡«å†™å†…å®¹ |
|------|----------|
| **é—®é¢˜åç§°** | Twitter OAuth 2.0 ç™»å½•æ—¶è·å–ç”¨æˆ·ä¿¡æ¯å¤±è´¥ï¼šAPI è¿”å› 403 Forbidden é”™è¯¯ |
| **é—®é¢˜ç­‰çº§** | Highï¼ˆé˜»å¡ Twitter OAuth ç™»å½•åŠŸèƒ½ï¼‰ |
| **è§¦å‘æ—¶é—´** | 2025-11-26ï¼ˆåå¤å‡ºç°ï¼‰ |
| **è§¦å‘ç¯å¢ƒ** | Development |
| **ç›¸å…³æ¨¡å—** | auth / login / oauth / nextauth / twitter |
| **å½“å‰çŠ¶æ€** | å¯å¤ç°ï¼Œä»£ç å±‚é¢å·²æ­£ç¡®å®ç°ï¼Œé—®é¢˜åœ¨äº Twitter åº”ç”¨é…ç½® |

---

## ğŸ“Œ ç¬¬äºŒéƒ¨åˆ†ï¼šå¤ç°è·¯å¾„ï¼ˆReproduce Stepsï¼‰

### å‰ç«¯æ“ä½œæ­¥éª¤

1. å¯åŠ¨ Next.js å¼€å‘æœåŠ¡å™¨ï¼ˆ`npm run dev`ï¼‰
2. è®¿é—®ç™»å½•é¡µé¢ï¼ˆ`http://localhost:3000/login`ï¼‰
3. ç‚¹å‡» "ä½¿ç”¨ Twitter ç™»å½•" æŒ‰é’®
4. åœ¨ Twitter æˆæƒé¡µé¢å®Œæˆæˆæƒ
5. æˆæƒæˆåŠŸåï¼Œç³»ç»Ÿå°è¯•å¤„ç†å›è°ƒ

### è§¦å‘ç‚¹

- Twitter OAuth æˆæƒæˆåŠŸï¼Œè¿”å›æˆæƒç ï¼ˆ`code`ï¼‰
- NextAuth ä½¿ç”¨æˆæƒç æ¢å– access tokenï¼ˆ**æˆåŠŸ**ï¼‰
- NextAuth ä½¿ç”¨ access token è°ƒç”¨ Twitter API v2 è·å–ç”¨æˆ·ä¿¡æ¯
- Twitter API è¿”å› 403 Forbidden é”™è¯¯
- ç”¨æˆ·è¢«é‡å®šå‘åˆ°é”™è¯¯é¡µé¢ (`/login/error?error=Configuration`)
- ç™»å½•å¤±è´¥

### é”™è¯¯ä¿¡æ¯

```
[Twitter Provider] Userinfo response status: 403 Forbidden

[Twitter Provider] Userinfo request error response: {
  "title": "Forbidden",
  "type": "about:blank",
  "status": 403,
  "detail": "Forbidden"
}
```

### é”™è¯¯å †æ ˆ

```
[auth][error] CallbackRouteError: Read more at https://errors.authjs.dev#callbackrouteerror
[auth][cause]: Error: Twitter userinfo request failed: 403 Forbidden - {
  "title": "Forbidden",
  "type": "about:blank",
  "status": 403,
  "detail": "Forbidden"
}
    at Object.request (webpack-internal:///(rsc)/./src/lib/providers/twitter.ts:134:31)
    at async handleOAuth (webpack-internal:///(rsc)/./node_modules/next-auth/node_modules/@auth/core/lib/actions/callback/oauth/callback.js:200:30)
```

### æ“ä½œç³»ç»Ÿ / æµè§ˆå™¨ / Node ç‰ˆæœ¬

- macOS / Chrome / Node.js 22.12.0
- Next.js version: 15.5.6
- NextAuth version: 5.0.0-beta.30
- Twitter OAuth 2.0 API

---

## ğŸ“Œ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®é™…è¡Œä¸º vs é¢„æœŸè¡Œä¸º

### å®é™…è¡Œä¸º

1. âœ… Twitter OAuth æˆæƒæˆåŠŸ
2. âœ… æˆæƒç è·å–æˆåŠŸ
3. âœ… Token äº¤æ¢æˆåŠŸï¼ˆè·å– access_tokenï¼‰
   - Token type: `bearer`
   - Scope: `users.read offline.access`
   - Access token å­˜åœ¨ä¸”æœ‰æ•ˆ
4. âŒ è°ƒç”¨ Twitter API v2 `/2/users/me` è·å–ç”¨æˆ·ä¿¡æ¯æ—¶è¿”å› 403 Forbidden
5. âŒ ç”¨æˆ·è¢«é‡å®šå‘åˆ°é”™è¯¯é¡µé¢ (`/login/error?error=Configuration`)
6. âŒ ç™»å½•å¤±è´¥

### é¢„æœŸè¡Œä¸º

1. âœ… Twitter OAuth æˆæƒæˆåŠŸ
2. âœ… æˆæƒç è·å–æˆåŠŸ
3. âœ… Token äº¤æ¢æˆåŠŸ
4. âœ… è°ƒç”¨ Twitter API v2 `/2/users/me` è·å–ç”¨æˆ·ä¿¡æ¯æˆåŠŸ
5. âœ… ç”¨æˆ·ä¿¡æ¯è§£ææˆåŠŸ
6. âœ… ç”¨æˆ·æˆåŠŸç™»å½•ï¼Œé‡å®šå‘åˆ°é¦–é¡µæˆ–æŒ‡å®šé¡µé¢
7. âœ… Session å†™å…¥æ•°æ®åº“æˆåŠŸ

---

## ğŸ“Œ ç¬¬å››éƒ¨åˆ†ï¼šä»£ç ä½ç½®

### é—®é¢˜ä»£ç ä½ç½®

1. **Twitter Provider é…ç½®**ï¼š`src/lib/providers/twitter.ts`
   - è¡Œæ•°ï¼š92-140
   - é—®é¢˜ï¼šUserinfo API è¯·æ±‚è¿”å› 403 Forbidden

2. **Userinfo è¯·æ±‚å¤„ç†**ï¼š`src/lib/providers/twitter.ts`
   - å‡½æ•°ï¼š`userinfo.request`
   - è¡Œæ•°ï¼š92-140
   - é—®é¢˜ï¼šTwitter API æ‹’ç»è¯·æ±‚ï¼Œè¿”å› 403 é”™è¯¯

### ç›¸å…³ä»£ç ç‰‡æ®µ

#### Twitter Provider Userinfo è¯·æ±‚ï¼ˆsrc/lib/providers/twitter.tsï¼‰

```92:140:src/lib/providers/twitter.ts
      async request({ provider, tokens }) {
        console.log("[Twitter Provider] Userinfo request started");
        console.log("[Twitter Provider] Userinfo URL:", provider.userinfo?.url);
        console.log("[Twitter Provider] Has access_token:", !!(tokens as any).access_token);
        console.log("[Twitter Provider] Token type:", (tokens as any).token_type);
        console.log("[Twitter Provider] Scope from token:", (tokens as any).scope);
        console.log("[Twitter Provider] Access token (first 20 chars):", (tokens as any).access_token?.substring(0, 20) + "...");
        
        const url = new URL(provider.userinfo?.url as string);
        // æ·»åŠ æŸ¥è¯¢å‚æ•°
        if (provider.userinfo?.params) {
          Object.entries(provider.userinfo.params).forEach(([key, value]) => {
            url.searchParams.set(key, String(value));
          });
        }

        console.log("[Twitter Provider] Final userinfo URL:", url.toString());

        const accessToken = (tokens as any).access_token;
        if (!accessToken) {
          throw new Error("Access token is missing from tokens");
        }

        const response = await fetch(url.toString(), {
          method: "GET",
          headers: {
            Authorization: `Bearer ${accessToken}`,
            "User-Agent": "NextAuth-Twitter-Provider",
          },
        });

        console.log("[Twitter Provider] Userinfo response status:", response.status, response.statusText);
        console.log("[Twitter Provider] Userinfo response headers:", Object.fromEntries(response.headers.entries()));

        if (!response.ok) {
          const errorText = await response.text();
          console.error("[Twitter Provider] Userinfo request error response:", errorText);
          
          // å°è¯•è§£æé”™è¯¯å“åº”
          let errorJson;
          try {
            errorJson = JSON.parse(errorText);
            console.error("[Twitter Provider] Parsed error:", JSON.stringify(errorJson, null, 2));
          } catch (e) {
            console.error("[Twitter Provider] Error response is not JSON:", errorText);
          }
          
          // æä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
          if (response.status === 403) {
            const detailedError = `Twitter API returned 403 Forbidden when accessing userinfo endpoint.

è¿™é€šå¸¸è¡¨ç¤º Twitter åº”ç”¨é…ç½®é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. âœ… Twitter Developer Portal â†’ Settings â†’ User authentication settings
   - App permissions: å¿…é¡»è®¾ç½®ä¸º "Read"ï¼ˆä¸æ˜¯ "Read and write"ï¼‰
   - Type of App: å¿…é¡»è®¾ç½®ä¸º "Web App"
   - Callback URI: å¿…é¡»åŒ¹é… ${process.env.NEXTAUTH_URL}/api/auth/callback/twitter

2. âœ… ç¡®ä¿åº”ç”¨çŠ¶æ€ä¸º "Active"

3. âœ… å¦‚æœåˆšåˆšä¿®æ”¹äº†é…ç½®ï¼Œè¯·ç­‰å¾… 2-5 åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ

4. âœ… æ£€æŸ¥åº”ç”¨çš„ OAuth 2.0 è®¾ç½®æ˜¯å¦å·²å¯ç”¨

å½“å‰è¯·æ±‚ä¿¡æ¯ï¼š
- URL: ${url.toString()}
- Token type: ${(tokens as any).token_type}
- Scope: ${(tokens as any).scope || "unknown"}

å¦‚æœé—®é¢˜æŒç»­å­˜åœ¨ï¼Œå¯èƒ½æ˜¯ Twitter åº”ç”¨éœ€è¦å®¡æ ¸æˆ–æƒé™ä¸è¶³ã€‚`;
            console.error("[Twitter Provider]", detailedError);
            throw new Error(detailedError);
          }
          
          throw new Error(`Twitter userinfo request failed: ${response.status} ${response.statusText} - ${errorText}`);
        }

        const profile = await response.json();
        console.log("[Twitter Provider] Userinfo response received");
        console.log("[Twitter Provider] Profile data:", JSON.stringify(profile, null, 2));
        
        return profile;
      },
```

#### Twitter Provider é…ç½®ï¼ˆsrc/lib/providers/twitter.tsï¼‰

```18:32:src/lib/providers/twitter.ts
export default function TwitterProvider(
  options: OAuthUserConfig<TwitterProfile>
): OAuthConfig<TwitterProfile> {
  return {
    id: "twitter",
    name: "Twitter",
    type: "oauth",
    checks: ["pkce", "state"],
    authorization: {
      url: "https://x.com/i/oauth2/authorize",
      params: {
        scope: "users.read offline.access", // åªè¯·æ±‚å¿…è¦çš„æƒé™ï¼Œä¸åŒ…å« tweet.read
        response_type: "code",
      },
    },
```

**ä»£ç åˆ†æ**ï¼š
- âœ… OAuth 2.0 æµç¨‹æ­£ç¡®å®ç°
- âœ… PKCE å®‰å…¨éªŒè¯å·²å¯ç”¨
- âœ… Scope é…ç½®æ­£ç¡®ï¼ˆ`users.read offline.access`ï¼‰
- âœ… API è¯·æ±‚æ ¼å¼æ­£ç¡®ï¼ˆBearer token è®¤è¯ï¼‰
- âœ… é”™è¯¯å¤„ç†å®Œå–„

---

## ğŸ“Œ ç¬¬äº”éƒ¨åˆ†ï¼šé”™è¯¯æ—¥å¿—åˆ†æ

### å…³é”®æ—¥å¿—ä¿¡æ¯

```
[Twitter Provider] Userinfo request started
[Twitter Provider] Userinfo URL: https://api.x.com/2/users/me?user.fields=profile_image_url
[Twitter Provider] Has access_token: true
[Twitter Provider] Token type: bearer
[Twitter Provider] Scope from token: users.read offline.access
[Twitter Provider] Access token (first 20 chars): TUtsMVFpSWF4Tk50TDN3...
[Twitter Provider] Final userinfo URL: https://api.x.com/2/users/me?user.fields=profile_image_url
[Twitter Provider] Userinfo response status: 403 Forbidden
```

### æ—¥å¿—åˆ†æ

1. **Token è·å–æˆåŠŸ**ï¼š
   - âœ… Access token å­˜åœ¨ä¸”æœ‰æ•ˆ
   - âœ… Token type ä¸º `bearer`ï¼ˆæ­£ç¡®ï¼‰
   - âœ… Scope ä¸º `users.read offline.access`ï¼ˆæ­£ç¡®ï¼‰

2. **è¯·æ±‚æ ¼å¼æ­£ç¡®**ï¼š
   - âœ… URL æ ¼å¼æ­£ç¡®ï¼š`https://api.x.com/2/users/me?user.fields=profile_image_url`
   - âœ… è®¤è¯å¤´æ ¼å¼æ­£ç¡®ï¼š`Authorization: Bearer {token}`
   - âœ… æŸ¥è¯¢å‚æ•°æ­£ç¡®ï¼š`user.fields=profile_image_url`

3. **API æ‹’ç»è¯·æ±‚**ï¼š
   - âŒ Twitter API è¿”å› 403 Forbidden
   - âŒ é”™è¯¯å“åº”ï¼š`{ "title": "Forbidden", "status": 403, "detail": "Forbidden" }`

### ç»“è®º

**ä»£ç å±‚é¢æ²¡æœ‰é—®é¢˜**ï¼Œæ‰€æœ‰å®ç°éƒ½ç¬¦åˆ Twitter OAuth 2.0 è§„èŒƒã€‚é—®é¢˜åœ¨äº **Twitter åº”ç”¨é…ç½®**ï¼ŒAPI æ‹’ç»äº†è¯·æ±‚ï¼Œè¡¨ç¤ºåº”ç”¨æƒé™ä¸è¶³æˆ–é…ç½®ä¸æ­£ç¡®ã€‚

---

## ğŸ“Œ ç¬¬å…­éƒ¨åˆ†ï¼šæ ¹æœ¬åŸå› åˆ†æ

### å¯èƒ½åŸå› 

1. **Twitter åº”ç”¨æƒé™è®¾ç½®ä¸æ­£ç¡®**ï¼ˆæœ€å¯èƒ½ï¼‰
   - App permissions ä¸æ˜¯ "Read"
   - æˆ–åº”ç”¨ç±»å‹è®¾ç½®é”™è¯¯

2. **User authentication settings æœªæ­£ç¡®é…ç½®**
   - OAuth 2.0 è®¾ç½®æœªå¯ç”¨
   - å›è°ƒ URL é…ç½®é”™è¯¯

3. **åº”ç”¨çŠ¶æ€é—®é¢˜**
   - åº”ç”¨è¢«æš‚åœæˆ–é™åˆ¶
   - éœ€è¦å®¡æ ¸

4. **Scope æƒé™é—®é¢˜**
   - `users.read` scope æœªå¯ç”¨
   - åº”ç”¨ä¸æ”¯æŒè¯·æ±‚çš„ scope

### æ ¹æœ¬åŸå› 

**403 Forbidden é”™è¯¯æ˜¯ Twitter API å±‚é¢çš„æƒé™æ‹’ç»ï¼Œä¸æ˜¯ä»£ç é”™è¯¯ã€‚**

ä»£ç å·²ç»æ­£ç¡®å®ç°äº†ï¼š
- âœ… OAuth 2.0 æˆæƒæµç¨‹
- âœ… PKCE å®‰å…¨éªŒè¯
- âœ… Token äº¤æ¢
- âœ… æ­£ç¡®çš„ API è¯·æ±‚æ ¼å¼
- âœ… Bearer token è®¤è¯

é—®é¢˜å¿…é¡»é€šè¿‡æ­£ç¡®é…ç½® Twitter Developer Portal ä¸­çš„åº”ç”¨è®¾ç½®æ¥è§£å†³ã€‚

---

## ğŸ“Œ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šå½±å“èŒƒå›´

### ç›´æ¥å½±å“

- âŒ Twitter OAuth ç™»å½•åŠŸèƒ½å®Œå…¨ä¸å¯ç”¨
- âŒ ç”¨æˆ·æ— æ³•é€šè¿‡ Twitter è´¦å·ç™»å½•ç³»ç»Ÿ

### é—´æ¥å½±å“

- âš ï¸ ç”¨æˆ·ä½“éªŒå—å½±å“ï¼ˆç¼ºå°‘ä¸€ç§ç™»å½•æ–¹å¼ï¼‰
- âš ï¸ å¦‚æœç”¨æˆ·åªæ³¨å†Œäº† Twitter è´¦å·ï¼Œå°†æ— æ³•ç™»å½•

### å—å½±å“çš„åŠŸèƒ½æ¨¡å—

- `src/app/login/page.tsx` - ç™»å½•é¡µé¢
- `src/lib/providers/twitter.ts` - Twitter OAuth Provider
- `src/lib/auth.ts` - NextAuth é…ç½®

---

## ğŸ“Œ ç¬¬å…«éƒ¨åˆ†ï¼šè§£å†³æ–¹æ¡ˆå»ºè®®

### æ–¹æ¡ˆ Aï¼šæ£€æŸ¥å¹¶ä¿®å¤ Twitter åº”ç”¨é…ç½®ï¼ˆæ¨èï¼‰

**æ­¥éª¤**ï¼š
1. ç™»å½• [Twitter Developer Portal](https://developer.twitter.com/en/portal/dashboard)
2. é€‰æ‹©ä½ çš„åº”ç”¨
3. è¿›å…¥ **"Settings"** â†’ **"User authentication settings"**
4. æ£€æŸ¥å¹¶ä¿®å¤ä»¥ä¸‹é…ç½®ï¼š
   - **App permissions**: å¿…é¡»è®¾ç½®ä¸º "Read"ï¼ˆä¸æ˜¯ "Read and write"ï¼‰
   - **Type of App**: å¿…é¡»è®¾ç½®ä¸º "Web App"ï¼ˆä¸æ˜¯ "Native App"ï¼‰
   - **Callback URI / Redirect URL**: å¿…é¡»å®Œå…¨åŒ¹é… `http://localhost:3000/api/auth/callback/twitter`
   - **Website URL**: å¡«å†™ä½ çš„ç½‘ç«™åœ°å€
5. ç‚¹å‡» "Save"
6. ç­‰å¾… 2-5 åˆ†é’Ÿè®©é…ç½®ç”Ÿæ•ˆ
7. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å¹¶é‡è¯•

**ä¼˜ç‚¹**ï¼š
- è§£å†³æ ¹æœ¬é—®é¢˜
- ä¸éœ€è¦ä¿®æ”¹ä»£ç 
- ç¬¦åˆ Twitter æœ€ä½³å®è·µ

**ç¼ºç‚¹**ï¼š
- éœ€è¦è®¿é—® Twitter Developer Portal
- é…ç½®æ›´æ”¹éœ€è¦ç­‰å¾…ç”Ÿæ•ˆ

### æ–¹æ¡ˆ Bï¼šé‡æ–°åˆ›å»º Twitter åº”ç”¨

**æ­¥éª¤**ï¼š
1. åœ¨ Twitter Developer Portal ä¸­åˆ›å»ºæ–°åº”ç”¨
2. ä»ä¸€å¼€å§‹å°±æ­£ç¡®é…ç½®æ‰€æœ‰è®¾ç½®
3. æ›´æ–°ç¯å¢ƒå˜é‡ä¸­çš„ Client ID å’Œ Client Secret

**ä¼˜ç‚¹**ï¼š
- ç¡®ä¿é…ç½®å®Œå…¨æ­£ç¡®
- é¿å…æ—§é…ç½®çš„æ½œåœ¨é—®é¢˜

**ç¼ºç‚¹**ï¼š
- éœ€è¦é‡æ–°é…ç½®
- éœ€è¦æ›´æ–°ç¯å¢ƒå˜é‡

### æ–¹æ¡ˆ Cï¼šè”ç³» Twitter æ”¯æŒ

**é€‚ç”¨åœºæ™¯**ï¼š
- é…ç½®çœ‹èµ·æ¥éƒ½æ­£ç¡®ä½†ä»ç„¶å¤±è´¥
- åº”ç”¨å¯èƒ½éœ€è¦å®¡æ ¸
- æƒé™ç›¸å…³é—®é¢˜

**æ­¥éª¤**ï¼š
1. åœ¨ Twitter Developer Portal ä¸­æäº¤æ”¯æŒè¯·æ±‚
2. æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œé…ç½®æˆªå›¾

---

## ğŸ“Œ ç¬¬ä¹éƒ¨åˆ†ï¼šæµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤

1. **é…ç½®éªŒè¯**ï¼š
   - [ ] æ£€æŸ¥ Twitter Developer Portal é…ç½®
   - [ ] ç¡®è®¤ App permissions ä¸º "Read"
   - [ ] ç¡®è®¤ Type of App ä¸º "Web App"
   - [ ] ç¡®è®¤ Callback URI å®Œå…¨åŒ¹é…

2. **åŠŸèƒ½æµ‹è¯•**ï¼š
   - [ ] æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ Cookies
   - [ ] é‡å¯å¼€å‘æœåŠ¡å™¨
   - [ ] è®¿é—®ç™»å½•é¡µé¢
   - [ ] ç‚¹å‡» "ä½¿ç”¨ Twitter ç™»å½•"
   - [ ] å®Œæˆæˆæƒ
   - [ ] éªŒè¯ç™»å½•æˆåŠŸ

3. **æ—¥å¿—éªŒè¯**ï¼š
   - [ ] æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰ 403 é”™è¯¯
   - [ ] ç¡®è®¤ userinfo è¯·æ±‚è¿”å› 200 OK
   - [ ] ç¡®è®¤ç”¨æˆ·ä¿¡æ¯æ­£ç¡®è§£æ

### æˆåŠŸæ ‡å‡†

- âœ… Twitter OAuth ç™»å½•æˆåŠŸ
- âœ… ç”¨æˆ·ä¿¡æ¯æ­£ç¡®è·å–
- âœ… Session æ­£ç¡®åˆ›å»º
- âœ… ç”¨æˆ·æˆåŠŸç™»å½•ç³»ç»Ÿ

---

## ğŸ“Œ ç¬¬åéƒ¨åˆ†ï¼šç›¸å…³æ–‡ä»¶

### ä»£ç æ–‡ä»¶

1. `src/lib/providers/twitter.ts` - Twitter OAuth Provider å®ç°
2. `src/lib/auth.ts` - NextAuth é…ç½®
3. `src/app/login/page.tsx` - ç™»å½•é¡µé¢

### æ–‡æ¡£æ–‡ä»¶

1. `docs/é—®é¢˜ä¿®å¤/Twitter_OAuthç™»å½•å¤±è´¥é—®é¢˜/Twitter_403_Forbiddené”™è¯¯æ’æŸ¥.md`
2. `docs/é—®é¢˜ä¿®å¤/Twitter_OAuthç™»å½•å¤±è´¥é—®é¢˜/Twitter_403_æœ€ç»ˆè¯Šæ–­.md`
3. `docs/é—®é¢˜ä¿®å¤/Twitter_OAuthç™»å½•å¤±è´¥é—®é¢˜/Twitter_403_å¿«é€Ÿæ£€æŸ¥.md`
4. `docs/é—®é¢˜ä¿®å¤/Twitter_OAuthç™»å½•å¤±è´¥é—®é¢˜/Twitter_OAuthé…ç½®æ£€æŸ¥æ¸…å•.md`

### å‚è€ƒé“¾æ¥

- [Twitter OAuth 2.0 æ–‡æ¡£](https://developer.twitter.com/en/docs/authentication/oauth-2-0)
- [Twitter API v2 Users Lookup](https://developer.twitter.com/en/docs/twitter-api/users/lookup/api-reference/get-users-me)
- [Twitter Developer Portal](https://developer.twitter.com/en/portal/dashboard)

---

## ğŸ“Œ ç¬¬åä¸€éƒ¨åˆ†ï¼šé™„å½•

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# .env.local
TWITTER_CLIENT_ID=ä½ çš„Twitter_Client_ID
TWITTER_CLIENT_SECRET=ä½ çš„Twitter_Client_Secret
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=ä½ çš„NextAuth_Secret
```

### Twitter API è¯·æ±‚ç¤ºä¾‹

**æˆåŠŸçš„ Token è¯·æ±‚**ï¼š
```
POST https://api.x.com/2/oauth2/token
Authorization: Basic {base64(client_id:client_secret)}
Content-Type: application/x-www-form-urlencoded

grant_type=authorization_code
&code={authorization_code}
&redirect_uri=http://localhost:3000/api/auth/callback/twitter
&code_verifier={pkce_code_verifier}
```

**å¤±è´¥çš„ Userinfo è¯·æ±‚**ï¼š
```
GET https://api.x.com/2/users/me?user.fields=profile_image_url
Authorization: Bearer {access_token}

Response: 403 Forbidden
{
  "title": "Forbidden",
  "type": "about:blank",
  "status": 403,
  "detail": "Forbidden"
}
```

### å…³é”®é…ç½®æ£€æŸ¥æ¸…å•

- [ ] App permissions: "Read"
- [ ] Type of App: "Web App"
- [ ] Callback URI: `http://localhost:3000/api/auth/callback/twitter`
- [ ] Website URL: å·²å¡«å†™
- [ ] åº”ç”¨çŠ¶æ€: "Active"
- [ ] OAuth 2.0: å·²å¯ç”¨

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-26  
**æŠ¥å‘Šç”Ÿæˆå·¥å…·**: Cursor AI Assistant

