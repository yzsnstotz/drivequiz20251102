# 执行报告 — 标签字段统一化_v3 · 数据库还原脚本

## 目标
- 从 `question_package_versions` 最新的 JSON 包版本读取 `questions`，将其中的 `category`、`stage_tag`、`license_type_tag`、`topic_tags` 按 `question.id` 覆盖到 `questions` 表对应记录。

## 实施内容
- 新增脚本：`scripts/restore-tags-from-latest-package.ts`
  - 读取最新统一版本（或传入版本号参数）
  - 遍历 JSON 包中题目，构造 `UPDATE`：
    - `category`: 字符串直接写入
    - `stage_tag`: 字段允许 null，直接写入
    - `topic_tags`: `TEXT[]`，数组直接写入
    - `license_type_tag`: 使用 `::jsonb` 强制写入 JSONB 数组
  - 以 `id` 匹配更新 `questions` 表
- 增加运行脚本：`npm run restore-tags`

## 运行结果（本地）
- 命令：`npm run restore-tags`
- 输出：`[restore-tags] done { total: 0, updated: 0, version: 'de0c3b6fd0f0a41b-1764853543908' }`
- 说明：最新 JSON 包版本中 `questions` 为空，未执行任何更新。

## 兼容说明
- 支持通过参数指定版本号：`npm run restore-tags -- <version>`
- 如需还原，请确保该版本的 `package_content.questions` 包含题目并携带有效 `id` 值。

## 下一步建议
- 先执行一次“统一版本保存”流程，生成包含 `questions` 的最新 JSON 包（含 `id` 字段）。
- 然后运行：`npm run restore-tags -- <新版本号>`，复核统计值与抽样记录。

