# å–æ¶ˆå•†æˆ·ä¸å¹¿å‘Šä¿¡æ¯è¾“å…¥ç©ºæ ¼é™åˆ¶_æ‰§è¡ŒæŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2025-11-29  
**ä»»åŠ¡åç§°**: å–æ¶ˆå•†æˆ·ä¸å¹¿å‘Šä¿¡æ¯è¾“å…¥çš„ç©ºæ ¼é™åˆ¶  
**ç‰ˆæœ¬å·**: 2025-11-29 11:47:33

---

## ğŸ“Œ ä»»åŠ¡æ‘˜è¦

å–æ¶ˆå•†æˆ·ä¸å¹¿å‘Šä¿¡æ¯è¾“å…¥ä¸­ä¸å…è®¸ç©ºæ ¼çš„é™åˆ¶ã€‚ä¿®æ”¹äº† `MultilangInput` ç»„ä»¶å’Œå•†æˆ· API è·¯ç”±ï¼Œç¡®ä¿è¾“å…¥çš„å†…å®¹ï¼ˆåŒ…æ‹¬å¤šè¯­è¨€å­—æ®µå’Œæ™®é€šå­—æ®µï¼‰èƒ½å¤Ÿä¿ç•™æ‰€æœ‰ç©ºæ ¼ï¼ŒåŒ…æ‹¬é¦–å°¾ç©ºæ ¼ã€‚

---

## ğŸ“Œ ä¿®æ”¹æ–‡ä»¶åˆ—è¡¨

1. **src/components/admin/MultilangInput.tsx**
   - ä¿®å¤ `handleChange` å‡½æ•°ï¼Œä¿ç•™åŸå§‹å€¼ï¼ˆåŒ…æ‹¬é¦–å°¾ç©ºæ ¼ï¼‰
   - åªåœ¨æ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ—¶ä½¿ç”¨ `trim()`ï¼Œä¿å­˜æ—¶ä¿ç•™æ‰€æœ‰ç©ºæ ¼

2. **src/app/api/admin/merchants/route.ts**
   - ç§»é™¤ `phone`ã€`email`ã€`imageUrl`ã€`category`ã€`adSlot` å­—æ®µçš„ `.trim()` æ“ä½œ
   - ä¿ç•™åŸå§‹è¾“å…¥å€¼ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç©ºæ ¼

3. **src/app/api/admin/merchants/[id]/route.ts**
   - ç§»é™¤ `phone`ã€`email`ã€`imageUrl`ã€`category`ã€`adSlot` å­—æ®µçš„ `.trim()` æ“ä½œ
   - ä¿ç•™åŸå§‹è¾“å…¥å€¼ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç©ºæ ¼

4. **src/lib/version.ts**
   - æ›´æ–°ç‰ˆæœ¬å·ä¸º `2025-11-29 11:47:33`

---

## ğŸ“Œ é€æ¡çº¢çº¿è§„èŒƒè‡ªæ£€ï¼ˆA1â€“D2ï¼‰

### ğŸ”´ A. æ¶æ„çº¢çº¿

| ç¼–å· | è§„åˆ™ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| A1 | è·¯ç”±å±‚ç¦æ­¢æ‰¿è½½ä¸šåŠ¡é€»è¾‘ | âœ… å·²éµå®ˆ | æœ¬æ¬¡ä¿®æ”¹ä»…æ¶‰åŠè¾“å…¥å¤„ç†é€»è¾‘ï¼Œä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘ |
| A2 | æ‰€æœ‰æ ¸å¿ƒé€»è¾‘å¿…é¡»å†™å…¥ ai-core | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠ AI åŠŸèƒ½ |
| A3 | ai-service ä¸ local-ai-service è¡Œä¸ºå¿…é¡»ä¿æŒå®Œå…¨ä¸€è‡´ | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠ AI æœåŠ¡ |
| A4 | æ¥å£å‚æ•°ã€è¿”å›ç»“æ„å¿…é¡»ä¿æŒç»Ÿä¸€ | âœ… å·²éµå®ˆ | æœ¬æ¬¡ä¿®æ”¹ä¸å½±å“æ¥å£ç»“æ„ï¼Œä»…ä¿®æ”¹è¾“å…¥å¤„ç†æ–¹å¼ |

### ğŸ”´ B. æ•°æ®åº“ & æ–‡ä»¶ç»“æ„çº¢çº¿

| ç¼–å· | è§„åˆ™ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| B1 | ä»»ä½•æ•°æ®åº“å­—æ®µã€è¡¨ç»“æ„ã€ç´¢å¼•çš„ä¿®æ”¹å¿…é¡»åŒæ­¥æ›´æ–°æ•°æ®åº“ç»“æ„æ–‡æ¡£ | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠæ•°æ®åº“ç»“æ„ä¿®æ”¹ |
| B2 | æ‰€æœ‰æ–‡ä»¶æ–°å¢ã€åˆ é™¤ã€è¿ç§»å¿…é¡»åŒæ­¥æ›´æ–°æ–‡ä»¶ç»“æ„æ–‡æ¡£ | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡æœªæ–°å¢ã€åˆ é™¤æˆ–è¿ç§»æ–‡ä»¶ |
| B3 | æ‰€æœ‰ Kysely ç±»å‹å®šä¹‰å¿…é¡»ä¸æ•°æ®åº“ç»“æ„åŒæ­¥ä¿æŒä¸€è‡´ | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠæ•°æ®åº“ç±»å‹å®šä¹‰ |
| B4 | DriveQuiz ä¸»åº“ä¸ AI Service åº“çš„ schema éœ€ä¿æŒæ–‡æ¡£åŒæ­¥ | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠæ•°æ®åº“ schema ä¿®æ”¹ |

### ğŸ”´ C. æµ‹è¯•çº¢çº¿ï¼ˆAI è°ƒç”¨å¿…é¡»åŒç¯å¢ƒæµ‹è¯•ï¼‰

| ç¼–å· | è§„åˆ™ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| C1 | æ¶‰åŠ AI åŠŸèƒ½å¿…é¡»åŒæ—¶æµ‹è¯•ï¼šlocal-ai-service & è¿œç¨‹ ai-service | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠ AI åŠŸèƒ½ |
| C2 | å¿…é¡»è¾“å‡ºæµ‹è¯•æ—¥å¿—æ‘˜è¦ï¼ˆè¯·æ±‚ã€å“åº”ã€è€—æ—¶ã€é”™è¯¯ï¼‰ | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠ AI è°ƒç”¨ |
| C3 | è‹¥æµ‹è¯•å¤±è´¥ï¼Œå¿…é¡»ä¸»åŠ¨ç»§ç»­æ’æŸ¥ï¼Œä¸å¾—è¦æ±‚ç”¨æˆ·æ‰‹åŠ¨é‡è¯• | âšª ä¸é€‚ç”¨ | æœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠ AI è°ƒç”¨æµ‹è¯• |

### ğŸ”´ D. æ‰§è¡ŒæŠ¥å‘Šçº¢çº¿ï¼ˆæœ€ç»ˆå¿…é¡»è¾“å‡ºï¼‰

| ç¼–å· | è§„åˆ™ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| D1 | ä»»åŠ¡ç»“æŸå¿…é¡»æŒ‰æ¨¡æ¿è¾“å‡ºå®Œæ•´æ‰§è¡ŒæŠ¥å‘Š | âœ… å·²éµå®ˆ | æœ¬æŠ¥å‘Šå³ä¸ºå®Œæ•´æ‰§è¡ŒæŠ¥å‘Š |
| D2 | å¿…é¡»é€æ¡å¯¹ç…§ A1â€“D2ï¼Œæ ‡æ³¨"å·²éµå®ˆ / ä¸é€‚ç”¨ / å¿…é¡»ä¿®å¤" | âœ… å·²éµå®ˆ | å·²é€æ¡å¯¹ç…§å¹¶æ ‡æ³¨çŠ¶æ€ |

### ğŸ”´ E. æ¸…é™¤å†—ä½™å’Œè‚¥èƒ–ä»£ç 

| ç¼–å· | è§„åˆ™ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| E1 | åˆ é™¤ç›®æ ‡åŠŸèƒ½æµç¨‹ä¸­æ®‹ç•™çš„æ— ç”¨è°ƒè¯•ä»£ç ã€é‡å¤æ—¥å¿—ã€æœªå†ä½¿ç”¨çš„è¾…åŠ©å‡½æ•° | âœ… å·²éµå®ˆ | æœ¬æ¬¡ä¿®æ”¹æœªå¼•å…¥å†—ä½™ä»£ç  |
| E2 | ç§»é™¤å†—ä½™/è¿‡æ—¶ä»£ç ï¼Œä¿è¯ç›®æ ‡åŠŸèƒ½æµç¨‹ç»“æ„ç®€æ´ã€èŒè´£å•ä¸€ | âœ… å·²éµå®ˆ | æœ¬æ¬¡ä¿®æ”¹ç®€åŒ–äº†è¾“å…¥å¤„ç†é€»è¾‘ï¼Œæœªå¼•å…¥å†—ä½™ä»£ç  |

---

## ğŸ“Œ é—®é¢˜åˆ†æ

### é—®é¢˜æè¿°

å•†æˆ·ä¸å¹¿å‘Šä¿¡æ¯è¾“å…¥ä¸å…è®¸ç©ºæ ¼ï¼Œç”¨æˆ·æ— æ³•è¾“å…¥åŒ…å«ç©ºæ ¼çš„å†…å®¹ï¼Œç‰¹åˆ«æ˜¯é¦–å°¾ç©ºæ ¼ä¼šè¢«è‡ªåŠ¨ç§»é™¤ã€‚

### æ ¹æœ¬åŸå› 

1. **MultilangInput ç»„ä»¶é—®é¢˜**ï¼š
   - åœ¨ `handleChange` å‡½æ•°ä¸­ï¼Œä½¿ç”¨ `filtered.zh = newValues.zh.trim()` ä¿å­˜å€¼
   - è™½ç„¶æ³¨é‡Šè¯´"åª trim ç”¨äºæ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼Œä¿å­˜æ—¶ä¿ç•™åŸå§‹å€¼"ï¼Œä½†å®é™…ä¸Šä¿å­˜æ—¶è¿˜æ˜¯ä½¿ç”¨äº† trim åçš„å€¼

2. **API è·¯ç”±é—®é¢˜**ï¼š
   - åœ¨å•†æˆ·åˆ›å»ºå’Œæ›´æ–° API ä¸­ï¼Œ`phone`ã€`email`ã€`imageUrl`ã€`category`ã€`adSlot` ç­‰å­—æ®µä½¿ç”¨äº† `.trim()` æ“ä½œ
   - è¿™å¯¼è‡´è¿™äº›å­—æ®µçš„é¦–å°¾ç©ºæ ¼è¢«ç§»é™¤

### ä¿®å¤æ–¹æ¡ˆ

1. **ä¿®å¤ MultilangInput ç»„ä»¶**ï¼š
   - ä¿®æ”¹ `handleChange` å‡½æ•°ï¼Œä¿ç•™åŸå§‹å€¼ï¼ˆåŒ…æ‹¬é¦–å°¾ç©ºæ ¼ï¼‰
   - åªåœ¨æ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ—¶ä½¿ç”¨ `trim()`ï¼Œä¿å­˜æ—¶ä½¿ç”¨åŸå§‹å€¼

2. **ä¿®å¤ API è·¯ç”±**ï¼š
   - ç§»é™¤æ‰€æœ‰ç›¸å…³å­—æ®µçš„ `.trim()` æ“ä½œ
   - ä¿ç•™åŸå§‹è¾“å…¥å€¼ï¼ŒåŒ…æ‹¬æ‰€æœ‰ç©ºæ ¼

---

## ğŸ“Œ ä¿®æ”¹è¯¦æƒ…

### 1. MultilangInput.tsx ä¿®æ”¹

**ä¿®æ”¹å‰**ï¼š
```typescript
const handleChange = (lang: "zh" | "en" | "ja", newValue: string) => {
  const newValues = { ...values, [lang]: newValue };
  setValues(newValues);
  
  const filtered: { zh?: string; en?: string; ja?: string } = {};
  if (newValues.zh.trim()) filtered.zh = newValues.zh.trim(); // âŒ ä½¿ç”¨ trim åçš„å€¼
  if (newValues.en.trim()) filtered.en = newValues.en.trim(); // âŒ ä½¿ç”¨ trim åçš„å€¼
  if (newValues.ja.trim()) filtered.ja = newValues.ja.trim(); // âŒ ä½¿ç”¨ trim åçš„å€¼
  
  onChange(filtered);
};
```

**ä¿®æ”¹å**ï¼š
```typescript
const handleChange = (lang: "zh" | "en" | "ja", newValue: string) => {
  const newValues = { ...values, [lang]: newValue };
  setValues(newValues);
  
  // è¿‡æ»¤ç©ºå€¼ï¼Œåªä¼ é€’æœ‰å†…å®¹çš„è¯­è¨€
  // æ³¨æ„ï¼šä¿ç•™æ‰€æœ‰ç©ºæ ¼ï¼ˆåŒ…æ‹¬é¦–å°¾ç©ºæ ¼ï¼‰ï¼Œåªåœ¨æ£€æŸ¥æ˜¯å¦ä¸ºç©ºæ—¶ä½¿ç”¨ trim
  const filtered: { zh?: string; en?: string; ja?: string } = {};
  // åª trim ç”¨äºæ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼Œä¿å­˜æ—¶ä¿ç•™åŸå§‹å€¼ï¼ˆåŒ…æ‹¬æ‰€æœ‰ç©ºæ ¼ï¼‰
  if (newValues.zh.trim()) filtered.zh = newValues.zh; // âœ… ä¿ç•™åŸå§‹å€¼ï¼ŒåŒ…æ‹¬é¦–å°¾ç©ºæ ¼
  if (newValues.en.trim()) filtered.en = newValues.en; // âœ… ä¿ç•™åŸå§‹å€¼ï¼ŒåŒ…æ‹¬é¦–å°¾ç©ºæ ¼
  if (newValues.ja.trim()) filtered.ja = newValues.ja; // âœ… ä¿ç•™åŸå§‹å€¼ï¼ŒåŒ…æ‹¬é¦–å°¾ç©ºæ ¼
  
  onChange(filtered);
};
```

### 2. å•†æˆ·åˆ›å»º API ä¿®æ”¹

**ä¿®æ”¹å‰**ï¼š
```typescript
phone: phone?.trim() || null,
email: email?.trim() || null,
image_url: imageUrl?.trim() || null,
category: category?.trim() || null,
ad_slot: adSlot?.trim() || null,
```

**ä¿®æ”¹å**ï¼š
```typescript
phone: phone || null,
email: email || null,
image_url: imageUrl || null,
category: category || null,
ad_slot: adSlot || null,
```

### 3. å•†æˆ·æ›´æ–° API ä¿®æ”¹

**ä¿®æ”¹å‰**ï¼š
```typescript
if (phone !== undefined) {
  updateData.phone = phone?.trim() || null;
}
if (email !== undefined) {
  updateData.email = email?.trim() || null;
}
if (imageUrl !== undefined) {
  updateData.image_url = imageUrl?.trim() || null;
}
if (category !== undefined) {
  updateData.category = category?.trim() || null;
}
if (adSlot !== undefined) {
  updateData.ad_slot = adSlot?.trim() || null;
}
```

**ä¿®æ”¹å**ï¼š
```typescript
if (phone !== undefined) {
  updateData.phone = phone || null;
}
if (email !== undefined) {
  updateData.email = email || null;
}
if (imageUrl !== undefined) {
  updateData.image_url = imageUrl || null;
}
if (category !== undefined) {
  updateData.category = category || null;
}
if (adSlot !== undefined) {
  updateData.ad_slot = adSlot || null;
}
```

---

## ğŸ“Œ æµ‹è¯•ç»“æœ

### å‰ç«¯ç»„ä»¶æµ‹è¯•

**æµ‹è¯•ç¯å¢ƒ**ï¼š
- Next.js 15.5.6
- React 18+
- TypeScript

**æµ‹è¯•é¡¹**ï¼š
1. âœ… ç±»å‹æ£€æŸ¥é€šè¿‡ï¼ˆæ—  TypeScript é”™è¯¯ï¼‰
2. âœ… Lint æ£€æŸ¥é€šè¿‡ï¼ˆæ—  ESLint é”™è¯¯ï¼‰
3. âœ… å¤šè¯­è¨€è¾“å…¥å¯ä»¥ä¿ç•™é¦–å°¾ç©ºæ ¼
4. âœ… å¤šè¯­è¨€è¾“å…¥å¯ä»¥ä¿ç•™ä¸­é—´ç©ºæ ¼
5. âœ… æ™®é€šå­—æ®µè¾“å…¥å¯ä»¥ä¿ç•™æ‰€æœ‰ç©ºæ ¼

**æµ‹è¯•åœºæ™¯**ï¼š
- âœ… è¾“å…¥åŒ…å«é¦–å°¾ç©ºæ ¼çš„å¤šè¯­è¨€å†…å®¹
- âœ… è¾“å…¥åŒ…å«ä¸­é—´ç©ºæ ¼çš„å¤šè¯­è¨€å†…å®¹
- âœ… è¾“å…¥åŒ…å«é¦–å°¾ç©ºæ ¼çš„æ™®é€šå­—æ®µï¼ˆphoneã€email ç­‰ï¼‰
- âœ… è¾“å…¥åŒ…å«ä¸­é—´ç©ºæ ¼çš„æ™®é€šå­—æ®µ
- âœ… ç©ºå€¼æ£€æŸ¥ä»ç„¶æ­£å¸¸å·¥ä½œï¼ˆä½¿ç”¨ trim æ£€æŸ¥ï¼‰

---

## ğŸ“Œ è¿ç§»è„šæœ¬

**ä¸é€‚ç”¨**ï¼šæœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠæ•°æ®åº“è¿ç§»ã€‚

---

## ğŸ“Œ æ›´æ–°åçš„æ–‡æ¡£

**ä¸é€‚ç”¨**ï¼šæœ¬æ¬¡ä»»åŠ¡ä¸æ¶‰åŠæ•°æ®åº“ç»“æ„æˆ–æ–‡ä»¶ç»“æ„çš„ä¿®æ”¹ã€‚

---

## ğŸ“Œ é£é™©ç‚¹ä¸ä¸‹ä¸€æ­¥å»ºè®®

### é£é™©ç‚¹

1. **æ•°æ®ä¸€è‡´æ€§**ï¼šç§»é™¤ trim åï¼Œæ•°æ®åº“ä¸­å¯èƒ½å­˜å‚¨åŒ…å«é¦–å°¾ç©ºæ ¼çš„æ•°æ®ï¼Œéœ€è¦ç¡®ä¿æ˜¾ç¤ºæ—¶æ­£ç¡®å¤„ç†
2. **éªŒè¯é€»è¾‘**ï¼šæŸäº›éªŒè¯é€»è¾‘å¯èƒ½ä¾èµ–äº trim åçš„å€¼ï¼Œéœ€è¦æ£€æŸ¥å¹¶æ›´æ–°

### ä¸‹ä¸€æ­¥å»ºè®®

1. **æ•°æ®æ¸…ç†**ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥è€ƒè™‘æ¸…ç†ç°æœ‰æ•°æ®ä¸­çš„é¦–å°¾ç©ºæ ¼ï¼ˆå¯é€‰ï¼‰
2. **éªŒè¯é€»è¾‘æ£€æŸ¥**ï¼šæ£€æŸ¥å…¶ä»–åœ°æ–¹çš„éªŒè¯é€»è¾‘ï¼Œç¡®ä¿ä¸ä¼šå› ä¸ºä¿ç•™ç©ºæ ¼è€Œå‡ºç°é—®é¢˜
3. **æ˜¾ç¤ºå¤„ç†**ï¼šç¡®ä¿å‰ç«¯æ˜¾ç¤ºæ—¶èƒ½å¤Ÿæ­£ç¡®å¤„ç†åŒ…å«ç©ºæ ¼çš„æ•°æ®

---

## ğŸ“Œ æ€»ç»“

æœ¬æ¬¡ä¿®å¤æˆåŠŸå–æ¶ˆäº†å•†æˆ·ä¸å¹¿å‘Šä¿¡æ¯è¾“å…¥ä¸­çš„ç©ºæ ¼é™åˆ¶ã€‚é€šè¿‡ä¿®æ”¹ `MultilangInput` ç»„ä»¶å’Œ API è·¯ç”±ï¼Œç¡®ä¿äº†æ‰€æœ‰è¾“å…¥å†…å®¹ï¼ˆåŒ…æ‹¬å¤šè¯­è¨€å­—æ®µå’Œæ™®é€šå­—æ®µï¼‰èƒ½å¤Ÿä¿ç•™æ‰€æœ‰ç©ºæ ¼ï¼ŒåŒ…æ‹¬é¦–å°¾ç©ºæ ¼ã€‚ç©ºå€¼æ£€æŸ¥ä»ç„¶æ­£å¸¸å·¥ä½œï¼Œä½¿ç”¨ `trim()` ä»…ç”¨äºæ£€æŸ¥æ˜¯å¦ä¸ºç©ºï¼Œä¸å½±å“å®é™…ä¿å­˜çš„å€¼ã€‚

**å½“å‰ç‰ˆæœ¬å·**: 2025-11-29 11:47:33

**ä¿®å¤çŠ¶æ€**: âœ… å·²å®Œæˆ

