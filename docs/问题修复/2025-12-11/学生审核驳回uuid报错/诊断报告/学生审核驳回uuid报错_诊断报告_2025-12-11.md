# å­¦ç”Ÿå®¡æ ¸é©³å› UUID æŠ¥é”™ - è¯Šæ–­æŠ¥å‘Šï¼ˆ2025-12-11ï¼‰

## é—®é¢˜æ¦‚è¿°
- ç°ç½‘åå°å­¦ç”Ÿå®¡æ ¸é©³å›æ¥å£ `/api/admin/student/verifications/:id/reject` è¿”å› 400ï¼Œé”™è¯¯ä¿¡æ¯ï¼š`DB_ERROR: invalid input syntax for type uuid: "admin"`ã€‚
- è¯´æ˜åå°å†™å…¥ `reviewer_id` æ—¶ä»ä¼ å…¥é UUID å­—ç¬¦ä¸²ï¼Œå¯¼è‡´æ•°æ®åº“å­—æ®µï¼ˆuuid ç±»å‹ï¼‰è§£æå¤±è´¥ã€‚

## è§¦å‘è¯·æ±‚ä¸æ—¥å¿—
- å‰ç«¯ï¼šç‚¹å‡»åå°å­¦ç”Ÿå®¡æ ¸è¯¦æƒ…é¡µçš„â€œç¡®è®¤é©³å›â€æŒ‰é’®è§¦å‘ `POST /api/admin/student/verifications/{id}/reject`ã€‚
- è¿”å›ï¼šHTTP 400ï¼Œbody å« `DB_ERROR: invalid input syntax for type uuid: "admin"`ã€‚
- å…³é”®æ ˆï¼šbrowser console 400ï¼›æœåŠ¡ç«¯æœªè®°å½•è¯¦ç»† stackï¼ˆéœ€å¤ç°æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—ï¼‰ã€‚

## ç°æœ‰ä»£ç è¡Œä¸ºï¼ˆåªè¯»åˆ†æï¼‰
- æ–‡ä»¶ï¼š`src/app/api/admin/student/verifications/[id]/reject/route.ts`
  - reviewerId å¤„ç†ï¼š`normalizeReviewerId(reviewerId) || normalizeReviewerId(adminInfo?.username) || "admin"`ã€‚
  - è‹¥ admin ç”¨æˆ·åé UUIDï¼Œåˆ™å‰ä¸¤é¡¹å‡ä¸º nullï¼Œæœ€ç»ˆ fallback ä¸ºå­—ç¬¦ä¸² "admin"ï¼Œå†™å…¥ DB â†’ è§¦å‘ uuid è§£æé”™è¯¯ã€‚
- æ–‡ä»¶ï¼š`src/app/api/admin/student/verifications/[id]/approve/route.ts`
  - åŒç±»é€»è¾‘ï¼Œä½† fallback ä¸º `adminReviewer ?? "admin"`ï¼ˆå½“å‰æœªè§¦å‘æŠ¥é”™ä½†å­˜åœ¨åŒç±»é£é™©ï¼‰ã€‚
- æ•°æ®æ¨¡å‹ï¼š`student_verifications.reviewer_id` åœ¨ Kysely ç±»å‹ä¸­ä¸º `string | null`ï¼Œå®é™… DB ä¸º uuidï¼ˆä»é”™è¯¯å¯è§ï¼‰ï¼Œé UUID å­—ç¬¦ä¸²å°†å¯¼è‡´ PG æŠ¥é”™ã€‚

## æ—¢å¾€å°è¯•
- ä¹‹å‰å·²æ·»åŠ å¯¹ reviewerId çš„ UUID æ ¼å¼æ ¡éªŒï¼Œå¹¶å°è¯•ä½¿ç”¨ adminInfo.usernameï¼›ä»ç„¶å‡ºç° fallback ä¸º "admin" çš„æƒ…å†µï¼Œå¯¼è‡´ DB æŠ¥é”™ã€‚
- æœªè°ƒæ•´ reviewerId çš„æœ€ç»ˆæ¥æºå’Œé»˜è®¤å€¼ã€‚

## åˆæ­¥æ ¹å› 
- reviewerId fallback é€»è¾‘ä»ä¼šè¿”å›é UUIDï¼ˆ"admin"ï¼‰ï¼Œä¸æ•°æ®åº“ uuid ç±»å‹ä¸å…¼å®¹ï¼Œå†™å…¥æ—¶è§¦å‘ `invalid input syntax for type uuid`ã€‚

## å½±å“èŒƒå›´
- åå°å­¦ç”Ÿå®¡æ ¸é©³å›æ“ä½œï¼›å®¡æ ¸é€šè¿‡æ¥å£å­˜åœ¨åŒç±»éšæ‚£ï¼ˆè‹¥ reviewer å­—æ®µä¸º uuid ç±»å‹ï¼‰ã€‚
- ç”¨æˆ·æ— æ³•å®Œæˆé©³å›ï¼Œå¯¼è‡´å­¦ç”Ÿå®¡æ ¸æµç¨‹å—é˜»ã€‚

## åç»­ä¿®å¤å»ºè®®ï¼ˆä»…åˆ—å»ºè®®ï¼Œä¸åœ¨æœ¬æŠ¥å‘Šä¸­å®æ–½ï¼‰
1) ç»Ÿä¸€ reviewerId æ¥æºï¼šä¼˜å…ˆä½¿ç”¨å·²ç™»å½•ç®¡ç†å‘˜çš„ `adminInfo.id`ï¼ˆè‹¥ä¸ºæ•°å­—æˆ– UUIDï¼Œéœ€è¦ç¡®è®¤å­—æ®µç±»å‹ï¼‰ï¼›è‹¥ç±»å‹ä¸åŒ¹é…åˆ™ç½® nullï¼Œä¸è¦ fallback é UUID å­—ç¬¦ä¸²ã€‚
2) å¦‚æœ DB å­—æ®µä¸º uuidï¼Œç¡®ä¿ä¼ å…¥å€¼æ»¡è¶³ UUID æ ¼å¼ï¼›å¦åˆ™ä¼  nullï¼ˆå…è®¸ç©ºï¼‰æˆ–æ”¹å­—æ®µç±»å‹/è¿ç§»ï¼ˆéœ€æŒ‰è§„èŒƒå•ç‹¬è¯„ä¼°ï¼‰ã€‚
3) å¯¹ approve/reject ä¸¤ä¸ªæ¥å£åŒæ—¶ä¿®æ­£ï¼Œé¿å…åŒç±»é—®é¢˜ã€‚
4) è¡¥å……é”™è¯¯æ—¥å¿—è®°å½• reviewerId å€¼ï¼Œä¾¿äºçº¿ä¸Šæ’æŸ¥ã€‚

## å‚è€ƒæ–‡ä»¶
- `/Users/leo/Desktop/v3/src/app/api/admin/student/verifications/[id]/reject/route.ts`
- `/Users/leo/Desktop/v3/src/app/api/admin/student/verifications/[id]/approve/route.ts`
- `/Users/leo/Desktop/v3/src/lib/studentVerification.ts`
- `/Users/leo/Desktop/drivequizç ”å‘è§„èŒƒ/âœ… ã€ŠCursor é—®é¢˜è¯Šæ–­ä¿¡æ¯æ¨¡æ¿ v1.0ã€‹.md`
- `/Users/leo/Desktop/drivequizç ”å‘è§„èŒƒ/ğŸ“ Cursor æ‰§è¡ŒæŠ¥å‘Šé€šç”¨æ¨¡æ¿ v1.0.md`

ï¼ˆæœ¬æŠ¥å‘ŠæŒ‰è¦æ±‚ä»…åšè¯Šæ–­ï¼Œä¸åŒ…å«ä¿®å¤å®ç°ã€‚ï¼‰
