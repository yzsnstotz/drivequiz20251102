## 问题诊断报告：未登录访问首页被重定向到 /login

### 1. 问题概述
- 现象：未登录访问首页 `/`（以及其他信息页）被强制跳转到 `/login`，不符合“仅学习/考试/AI/后台需要登录”的预期。
- 影响：所有匿名访问首页、信息页的用户都会被迫登录，导致浏览体验受阻。

### 2. 复现步骤
1. 清理浏览器登录态或使用隐身窗口。
2. 访问 `/`、`/license` 等信息页。
3. 页面立即跳转到 `/login`（回跳参数无关，中间件当前已改为按前缀判断）。

### 3. 现有逻辑排查
- 中间件 `src/middleware.ts`：已改为仅在 `AUTH_REQUIRED_PREFIXES` 命中且未登录时重定向，其余路径放行，逻辑符合预期。
- 全局搜索 `withAuth(`、`NextResponse.redirect('/login'...)`：未发现其他服务端全局拦截。
- 根层布局 `src/app/layout.tsx` 使用 `AuthGuard` 包裹所有页面。
- `src/components/AuthGuard.tsx`：
  - 仅把 `/login` 相关路径视为 public，其他路径在 `status === "unauthenticated"` 时执行 `router.replace("/login")`。
  - App Router 的首页 `/` 不在其 public 列表中，导致客户端渲染阶段直接重定向。
  - 行为与中间件的“按前缀保护”设计冲突，形成双重、且更严格的拦截。

### 4. 根因分析
- 客户端层 AuthGuard 仍按“非登录页即需登录”的兜底逻辑执行，覆盖了首页和信息页。
- 中间件虽已放行信息页，但前端 AuthGuard 的重定向优先发生，导致最终仍跳登录。

### 5. 影响范围
- 所有未登录访问 `/`、`/license`、`/services`、`/vehicles`、`/about`、`/terms`、`/privacy` 等信息页的用户。
- 学习/AI 等需要登录的路径仍受中间件保护，不受影响。

### 6. 相关日志/线索
- 代码引用：`src/app/layout.tsx` 全局包裹 `AuthGuard`。
- 拦截逻辑：`src/components/AuthGuard.tsx` 第 45–52 行（public 路径仅 login 系列；其他 unauthenticated 直接 `router.replace("/login")`）。
- 中间件已无强制兜底，说明重定向由前端 AuthGuard 触发。

### 7. 已有尝试/状态
- 中间件已按需求改为前缀驱动，不再强制首页登录。
- 未对 AuthGuard 做调整，问题仍然存在。

### 8. 初步修复建议（需另建指令执行）
- 放宽或移除全局 AuthGuard 的未登录重定向：为信息页新增显式放行列表，或仅对需要登录的页面/模块使用 AuthGuard 包裹。
- 若保留全局包裹，需与 `AUTH_REQUIRED_PREFIXES` 对齐：仅当匹配需要登录的前缀且未登录时重定向，其余直接放行。

### 9. 后续工作
- 依据上述建议创建“解决指令”和“执行计划”，调整 `AuthGuard` 或其使用范围；执行后需在对应报告中记录验证结果。
