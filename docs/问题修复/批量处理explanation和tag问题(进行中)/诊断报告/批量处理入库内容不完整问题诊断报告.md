# æ‰¹é‡å¤„ç†å…¥åº“å†…å®¹ä¸å®Œæ•´é—®é¢˜è¯Šæ–­æŠ¥å‘Š

**æŠ¥å‘Šæ—¥æœŸ**: 2025-11-21  
**é—®é¢˜ID**: BP-20251121-003  
**å…³è”æŠ¥å‘Š**: BP-20250124-001, BP-20250124-002

---

## ðŸ“Œ ç¬¬ä¸€éƒ¨åˆ†ï¼šé—®é¢˜æ¦‚è¦ï¼ˆSummaryï¼‰

| å­—æ®µ | å¡«å†™å†…å®¹ |
|------|----------|
| **é—®é¢˜åç§°** | æ‰¹é‡å¤„ç† full_pipeline æ“ä½œåŽï¼Œå…¥åº“å†…å®¹ä¸å®Œæ•´ï¼ˆç¼ºå°‘ zh explanation æˆ–éƒ¨åˆ†è¯­è¨€ç¿»è¯‘ï¼‰ |
| **é—®é¢˜ç­‰çº§** | High |
| **è§¦å‘æ—¶é—´** | 2025-11-21 |
| **è§¦å‘çŽ¯å¢ƒ** | local / production |
| **ç›¸å…³æ¨¡å—** | admin / question-processing / batch-process / full_pipeline |
| **å½“å‰çŠ¶æ€** | éƒ¨åˆ†ä¿®å¤ï¼ˆja ç¿»è¯‘å·²ä¿®å¤ï¼Œzh explanation ä»ç¼ºå¤±ï¼‰ |

---

## ðŸ“Œ ç¬¬äºŒéƒ¨åˆ†ï¼šé—®é¢˜çŽ°è±¡ï¼ˆSymptomsï¼‰

### é—®é¢˜1ï¼šzh explanation ç¼ºå¤±

**çŽ°è±¡æè¿°**ï¼š
- æ‰§è¡Œ full_pipeline æ“ä½œï¼ˆæºè¯­è¨€ï¼šzhï¼Œç›®æ ‡è¯­è¨€ï¼šja, enï¼‰
- AI è¿”å›žäº†å®Œæ•´çš„ç¿»è¯‘æ•°æ®ï¼ˆåŒ…æ‹¬ zh, ja, en çš„ explanationï¼‰
- æœ€ç»ˆå…¥åº“æ•°æ®ä¸­ç¼ºå°‘ zh çš„ explanation

**å®žé™…æ•°æ®ç¤ºä¾‹**ï¼ˆé¢˜ç›® 12ï¼‰ï¼š
```json
// AI è¿”å›žçš„æ•°æ®
{
  "source": {
    "language": "ja",  // âŒ AI é”™è¯¯è¿”å›žäº† "ja" è€Œä¸æ˜¯ "zh"
    "content": "å›³ä¸­ã®æ¨™è­˜ã¯...",
    "explanation": "å›³ä¸­ã®æ¨™è­˜ã¯..."  // âŒ æ—¥æ–‡ï¼Œä¸æ˜¯ä¸­æ–‡
  },
  "translations": {
    "zh": {
      "content": "å›¾ä¸­çš„æ ‡å¿—è¡¨ç¤º...",
      "explanation": "å›¾ä¸­çš„æ ‡å¿—è¡¨æ˜Ž..."  // âœ… ä¸­æ–‡ explanation
    },
    "ja": {...},
    "en": {...}
  }
}

// æœ€ç»ˆå…¥åº“æ•°æ®
{
  "explanation": {
    "en": "The sign in the diagram...",
    "ja": "å›³ä¸­ã®æ¨™è­˜ã¯..."
    // âŒ ç¼ºå°‘ "zh"
  }
}
```

### é—®é¢˜2ï¼šja ç¿»è¯‘è¢«è¯¯åˆ¤ä¸ºä¸­æ–‡ï¼ˆå·²ä¿®å¤ï¼‰

**çŽ°è±¡æè¿°**ï¼š
- AI è¿”å›žäº†æ­£ç¡®çš„ ja ç¿»è¯‘
- ç³»ç»Ÿè¯¯åˆ¤ä¸ºä¸­æ–‡ï¼Œå¯¼è‡´ ja ç¿»è¯‘è¢«è·³è¿‡
- æœ€ç»ˆå…¥åº“æ•°æ®ä¸­ç¼ºå°‘ ja å†…å®¹

**æ ¹æœ¬åŽŸå› **ï¼š
- æ—¥æ–‡ä½¿ç”¨å¤§é‡æ±‰å­—ï¼ˆå›³ä¸­æ¨™è­˜å‰æ–¹å·¦æ›²è¡¨ç¤ºï¼‰
- `isChineseContent` å‡½æ•°åŸºäºŽæ±‰å­—å æ¯”åˆ¤æ–­ï¼Œè¯¯åˆ¤ä¸ºä¸­æ–‡
- ç³»ç»Ÿåœ¨è¯­è¨€æ ¡éªŒæ—¶è·³è¿‡äº† ja ç¿»è¯‘

**ä¿®å¤çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼ˆé€šè¿‡æ£€æµ‹æ—¥æ–‡å‡ååŒºåˆ†ä¸­æ—¥æ–‡ï¼‰

### é—®é¢˜3ï¼šAI è¿”å›žé”™è¯¯çš„ source æ•°æ®

**çŽ°è±¡æè¿°**ï¼š
- AI æ¨¡åž‹ï¼ˆqwen2.5:3b-instructï¼‰æœ‰æ—¶è¿”å›žé”™è¯¯çš„ `source.language`
- `source.language` åº”è¯¥æ˜¯ "zh"ï¼Œä½†è¿”å›žäº† "ja"
- `source.content` å’Œ `source.explanation` ä¹Ÿæ˜¯é”™è¯¯çš„è¯­è¨€

**å½±å“**ï¼š
- ç³»ç»Ÿæ— æ³•ä½¿ç”¨ AI è¿”å›žçš„ `source.explanation` æ¥è¡¥å……ç¼ºå¤±çš„ zh explanation
- å¯¼è‡´ zh explanation æŒç»­ç¼ºå¤±

---

## ðŸ“Œ ç¬¬ä¸‰éƒ¨åˆ†ï¼šé—®é¢˜åˆ†æžï¼ˆRoot Cause Analysisï¼‰

### 3.1 æ•°æ®æµåˆ†æž

```
1. ç”¨æˆ·åˆ›å»º full_pipeline ä»»åŠ¡
   â†“
2. ç³»ç»Ÿè°ƒç”¨ AIï¼ˆæºè¯­è¨€ï¼šzhï¼Œç›®æ ‡è¯­è¨€ï¼šja, enï¼‰
   â†“
3. AI è¿”å›žæ•°æ®ï¼š
   - source.language = "ja" (âŒ é”™è¯¯)
   - source.explanation = "æ—¥æ–‡è§£é‡Š" (âŒ é”™è¯¯)
   - translations.zh.explanation = "ä¸­æ–‡è§£é‡Š" (âœ… æ­£ç¡®)
   â†“
4. ç³»ç»Ÿå¤„ç†é€»è¾‘ï¼š
   a) æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰ zh explanation â†’ æ²¡æœ‰
   b) æ£€æŸ¥ AI è¿”å›žçš„ source.explanation â†’ æ˜¯æ—¥æ–‡ï¼Œè¯­è¨€æ£€æµ‹å¤±è´¥
   c) æ£€æŸ¥ translations.zh.explanation â†’ å› ä¸ºæ˜¯æºè¯­è¨€è¢«è·³è¿‡
   â†“
5. æœ€ç»ˆç»“æžœï¼šzh explanation ç¼ºå¤±
```

### 3.2 ä»£ç é€»è¾‘åˆ†æž

#### 3.2.1 æºè¯­è¨€ explanation è¡¥å……é€»è¾‘

**æ–‡ä»¶**: `src/app/api/admin/question-processing/_lib/batchProcessUtils.ts`  
**ä½ç½®**: ç¬¬ 2224-2267 è¡Œ

**å½“å‰é€»è¾‘**ï¼š
```typescript
// 1. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰æºè¯­è¨€ explanation
let hasSourceExplanation = false;
if (typeof question.explanation === "string" && question.explanation.trim()) {
  hasSourceExplanation = true;
} else if (typeof question.explanation === "object" && question.explanation !== null) {
  hasSourceExplanation = !!question.explanation[sourceLanguage];
}

// 2. å¦‚æžœæ²¡æœ‰ï¼Œå°è¯•ä½¿ç”¨ AI è¿”å›žçš„ source.explanation
if (!hasSourceExplanation && sourceExplanation) {
  const isEn = isEnglishContent(sourceExplanation);
  const isZh = isChineseContent(sourceExplanation);
  
  // è¯­è¨€æ£€æµ‹é€šè¿‡åŽä½¿ç”¨
  if (sourceLanguage === "zh" && isZh && !isEn) {
    question.explanation = { [sourceLanguage]: sourceExplanation };
  }
}
```

**é—®é¢˜**ï¼š
- âŒ æ²¡æœ‰æ£€æŸ¥ AI è¿”å›žçš„ `source.language` æ˜¯å¦æ­£ç¡®
- âŒ å¦‚æžœ AI è¿”å›žé”™è¯¯çš„ `source.language`ï¼Œ`source.explanation` ä¹Ÿä¼šæ˜¯é”™è¯¯çš„è¯­è¨€
- âŒ è¯­è¨€æ£€æµ‹å¯èƒ½å¤±è´¥ï¼Œå¯¼è‡´æ— æ³•ä½¿ç”¨

#### 3.2.2 ç¿»è¯‘ explanation ä¿å­˜é€»è¾‘

**æ–‡ä»¶**: `src/app/api/admin/question-processing/_lib/batchProcessUtils.ts`  
**ä½ç½®**: ç¬¬ 2417-2572 è¡Œ

**å½“å‰é€»è¾‘**ï¼š
```typescript
for (const { lang, translation } of translationsToSave) {
  // 2ï¼‰lang ä¸èƒ½ç­‰äºŽ sourceLanguageï¼ˆé˜²æ­¢æŠŠç¿»è¯‘å†™å›žæºè¯­è¨€ keyï¼‰
  if (lang === sourceLanguage) {
    console.warn(`âš ï¸ è¯­è¨€ ${lang} ä¸ºæºè¯­è¨€ï¼Œä¸åº”ä½œä¸ºç¿»è¯‘ä¿å­˜ï¼Œè·³è¿‡`);
    continue;  // âŒ è¿™é‡Œè·³è¿‡äº† zh çš„ç¿»è¯‘
  }
  
  // ... ä¿å­˜ç¿»è¯‘é€»è¾‘
}
```

**é—®é¢˜**ï¼š
- âœ… è¿™æ˜¯**æ­£ç¡®çš„è¡Œä¸º**ï¼ˆé˜²æ­¢ç”¨"ç¿»è¯‘"è¦†ç›–æºè¯­è¨€å†…å®¹ï¼‰
- âŒ ä½†å¦‚æžœæ•°æ®åº“ä¸­åŽŸæœ¬æ²¡æœ‰ zh explanationï¼ŒAI åœ¨ `translations.zh` ä¸­è¿”å›žäº†ï¼Œä¹Ÿä¼šè¢«è·³è¿‡
- âŒ å¯¼è‡´æ— æ³•è¡¥å……ç¼ºå¤±çš„ zh explanation

### 3.3 AI æ¨¡åž‹é—®é¢˜

**æ¨¡åž‹**: qwen2.5:3b-instruct

**é—®é¢˜è¡¨çŽ°**ï¼š
1. **source.language é”™è¯¯**ï¼šè¿”å›ž "ja" è€Œä¸æ˜¯ "zh"
2. **source.content é”™è¯¯**ï¼šè¿”å›žæ—¥æ–‡å†…å®¹è€Œä¸æ˜¯ä¸­æ–‡
3. **source.explanation é”™è¯¯**ï¼šè¿”å›žæ—¥æ–‡è§£é‡Šè€Œä¸æ˜¯ä¸­æ–‡
4. **ä¸åº”è¯¥è¿”å›žçš„ç¿»è¯‘**ï¼šåœ¨ `translations` ä¸­åŒ…å«äº†æºè¯­è¨€ zh

**æ ¹æœ¬åŽŸå› **ï¼š
- æ¨¡åž‹èƒ½åŠ›ä¸è¶³ï¼Œæ— æ³•æ­£ç¡®ç†è§£ä»»åŠ¡è¦æ±‚
- prompt å¯èƒ½ä¸å¤Ÿæ˜Žç¡®ï¼Œå¯¼è‡´æ¨¡åž‹æ··æ·†æºè¯­è¨€å’Œç›®æ ‡è¯­è¨€

---

## ðŸ“Œ ç¬¬å››éƒ¨åˆ†ï¼šå®žçŽ°æ–¹æ³•ï¼ˆImplementation Approachï¼‰

### 4.1 æ–¹æ¡ˆæ¦‚è¿°

**ç›®æ ‡**ï¼šç¡®ä¿ full_pipeline æ“ä½œåŽï¼Œæ‰€æœ‰ç›®æ ‡è¯­è¨€çš„ explanation éƒ½èƒ½æ­£ç¡®å…¥åº“ï¼ŒåŒ…æ‹¬æºè¯­è¨€çš„ explanationï¼ˆå¦‚æžœåŽŸæœ¬ç¼ºå¤±ï¼‰ã€‚

**ç­–ç•¥**ï¼š
1. **çŸ­æœŸæ–¹æ¡ˆ**ï¼šæ·»åŠ å®¹é”™é€»è¾‘ï¼Œæ£€æŸ¥ AI è¿”å›žçš„ `source.language`ï¼Œå¦‚æžœé”™è¯¯åˆ™è·³è¿‡ä½¿ç”¨ `source.explanation`
2. **ä¸­æœŸæ–¹æ¡ˆ**ï¼šæ”¹è¿› promptï¼Œæ˜Žç¡®è¦æ±‚ AI æ­£ç¡®è¿”å›ž `source.language`
3. **é•¿æœŸæ–¹æ¡ˆ**ï¼šåˆ‡æ¢åˆ°æ›´å¼ºå¤§çš„ AI æ¨¡åž‹ï¼ˆå¦‚ gpt-4o-miniï¼‰

### 4.2 å®žçŽ°æ­¥éª¤

#### æ­¥éª¤1ï¼šæ£€æŸ¥ AI è¿”å›žçš„ source.language æ­£ç¡®æ€§

**ä½ç½®**: `batchProcessUtils.ts` ç¬¬ 2232-2267 è¡Œ

**å®žçŽ°é€»è¾‘**ï¼š
```typescript
if (!hasSourceExplanation && sourceExplanation) {
  // ðŸ” æ–°å¢žï¼šæ£€æŸ¥ AI è¿”å›žçš„ source.language æ˜¯å¦æ­£ç¡®
  const aiSourceLanguage = parsed.source?.language;
  const sourceLanguageMatches = aiSourceLanguage === sourceLanguage;

  if (!sourceLanguageMatches) {
    console.warn(`âš ï¸ AI è¿”å›žçš„ source.language=${aiSourceLanguage} ä¸ŽæœŸæœ›çš„ ${sourceLanguage} ä¸åŒ¹é…ï¼Œè·³è¿‡ä½¿ç”¨ source.explanation`);
    // ä¸ä½¿ç”¨é”™è¯¯çš„ source.explanation
  } else {
    // åŽŸæœ‰çš„è¯­è¨€æ£€æµ‹å’Œä½¿ç”¨é€»è¾‘
    const isEn = isEnglishContent(sourceExplanation);
    const isZh = isChineseContent(sourceExplanation);
    
    if (sourceLanguage === "zh" && isZh && !isEn) {
      question.explanation = { [sourceLanguage]: sourceExplanation };
    }
  }
}
```

**å…³é”®ä»£ç **ï¼š
```typescript
// ä»ŽåŽŸå§‹ parsed å¯¹è±¡èŽ·å– source.languageï¼ˆsanitized ä¸­å·²è¢«è¿‡æ»¤ï¼‰
const aiSourceLanguage = parsed.source?.language;
const sourceLanguageMatches = aiSourceLanguage === sourceLanguage;
```

#### æ­¥éª¤2ï¼šæ”¹è¿›æ—¥æ–‡è¯†åˆ«ï¼ˆå·²å®žçŽ°ï¼‰

**ä½ç½®**: `batchProcessUtils.ts` ç¬¬ 296-322 è¡Œ

**å®žçŽ°é€»è¾‘**ï¼š
```typescript
export function isChineseContent(text: string): boolean {
  const { englishRatio, chineseRatio } = analyzeTextLanguage(text);
  
  // ðŸ“Š æ”¹è¿›ï¼šæ£€æµ‹æ—¥æ–‡å‡åæ¥åŒºåˆ†ä¸­æ–‡å’Œæ—¥æ–‡
  const hasHiragana = /[\u3040-\u309F]/.test(text); // å¹³å‡å
  const hasKatakana = /[\u30A0-\u30FF]/.test(text); // ç‰‡å‡å
  const hasJapaneseKana = hasHiragana || hasKatakana;
  
  // å¦‚æžœæœ‰æ—¥æ–‡å‡åï¼Œä¸åˆ¤å®šä¸ºä¸­æ–‡
  if (hasJapaneseKana) {
    return false;
  }
  
  // åŽŸæœ‰é€»è¾‘
  const isChinese = chineseRatio > 0.2 && englishRatio < 0.3;
  return isChinese;
}
```

**å…³é”®ä»£ç **ï¼š
```typescript
// Unicode èŒƒå›´
// å¹³å‡åï¼šU+3040 ~ U+309Fï¼ˆãŒã€ã®ã€ã‚’ ç­‰ï¼‰
// ç‰‡å‡åï¼šU+30A0 ~ U+30FF
const hasHiragana = /[\u3040-\u309F]/.test(text);
const hasKatakana = /[\u30A0-\u30FF]/.test(text);
```

#### æ­¥éª¤3ï¼šæ·»åŠ è°ƒè¯•æ•°æ®ä¿å­˜ï¼ˆå·²å®žçŽ°ï¼‰

**ä½ç½®**: `batchProcessUtils.ts` ç¬¬ 2117-2143 è¡Œ

**å®žçŽ°é€»è¾‘**ï¼š
```typescript
// ðŸ“Š èŽ·å– scene é…ç½®ï¼ˆåŒ…å« promptï¼‰ï¼Œç”¨äºŽè°ƒè¯•æ•°æ®
const sceneConfig = await getSceneConfig("question_full_pipeline", sourceLanguage);

// ðŸ“Š æž„é€ å®Œæ•´çš„ AI è¯·æ±‚å’Œå“åº”æ•°æ®ï¼ˆåŒ…å« promptï¼‰
const aiRequestDebug = {
  scene: "question_full_pipeline",
  sceneName: sceneConfig?.sceneName || "question_full_pipeline",
  prompt: sceneConfig?.prompt || "[æ— æ³•èŽ·å– prompt]",
  question: input,
  questionPayload: aiQuestionPayload,
  sourceLanguage,
  targetLanguage: targetLanguages[0] || sourceLanguage,
  locale: sourceLanguage,
  type,
  targetLanguages,
  outputFormat: sceneConfig?.outputFormat || null,
};

const aiResponseDebug = {
  provider: aiProvider,
  answer: aiResp.answer,
  model: aiResp.model,
  duration: aiCallDuration,
};

// ðŸ“Š è°ƒç”¨å›žè°ƒå‡½æ•°ä¿å­˜è°ƒè¯•æ•°æ®åˆ°æ•°æ®åº“
if (onProgress) {
  await onProgress(question.id, {
    aiRequest: aiRequestDebug,
    aiResponse: aiResponseDebug,
    processedData: processedDataDebug,
  });
}
```

**å…³é”®ä»£ç **ï¼š
```typescript
// ä¿å­˜åˆ°æ•°æ®åº“
await updateTaskItem(fullPipelineTaskItemId, "processing", null, {
  aiRequest: JSON.stringify(aiRequestDebug),
  aiResponse: JSON.stringify(aiResponseDebug),
  processedData: JSON.stringify(processedDataDebug),
});
```

### 4.3 å…³é”®ä»£ç ä½ç½®

| åŠŸèƒ½ | æ–‡ä»¶ | è¡Œå· | è¯´æ˜Ž |
|------|------|------|------|
| æºè¯­è¨€ explanation è¡¥å…… | `batchProcessUtils.ts` | 2224-2267 | æ£€æŸ¥å¹¶è¡¥å……ç¼ºå¤±çš„æºè¯­è¨€ explanation |
| æ—¥æ–‡è¯†åˆ«æ”¹è¿› | `batchProcessUtils.ts` | 296-322 | é€šè¿‡å‡åæ£€æµ‹åŒºåˆ†ä¸­æ—¥æ–‡ |
| ç¿»è¯‘ä¿å­˜é€»è¾‘ | `batchProcessUtils.ts` | 2417-2572 | ä¿å­˜å¤šè¯­è¨€ç¿»è¯‘åˆ°æ•°æ®åº“ |
| è°ƒè¯•æ•°æ®ä¿å­˜ | `batchProcessUtils.ts` | 2117-2143 | ä¿å­˜å®Œæ•´çš„ AI è¯·æ±‚å’Œå“åº” |
| ä»»åŠ¡è¯¦æƒ… API | `tasks/[taskId]/items/route.ts` | 106-171 | è¿”å›žè°ƒè¯•æ•°æ®ç»™å‰ç«¯ |
| å‰ç«¯å±•ç¤º | `page.tsx` | 2421-2556 | åœ¨ä»»åŠ¡è¯¦æƒ…é¡µå±•ç¤ºè°ƒè¯•æ•°æ® |

---

## ðŸ“Œ ç¬¬äº”éƒ¨åˆ†ï¼šè§£å†³æ–¹æ¡ˆï¼ˆSolutionï¼‰

### 5.1 å·²å®žçŽ°çš„ä¿®å¤

#### âœ… ä¿®å¤1ï¼šæ—¥æ–‡è¯†åˆ«æ”¹è¿›

**é—®é¢˜**ï¼šja ç¿»è¯‘è¢«è¯¯åˆ¤ä¸ºä¸­æ–‡ï¼Œå¯¼è‡´æ²¡æœ‰å…¥åº“

**ä¿®å¤**ï¼šæ”¹è¿› `isChineseContent` å‡½æ•°ï¼Œé€šè¿‡æ£€æµ‹æ—¥æ–‡å‡åæ¥åŒºåˆ†ä¸­æ—¥æ–‡

**æ•ˆæžœ**ï¼š
- âœ… ja ç¿»è¯‘çŽ°åœ¨å¯ä»¥æ­£ç¡®è¯†åˆ«
- âœ… ja å†…å®¹å’Œ explanation æˆåŠŸå…¥åº“

#### âœ… ä¿®å¤2ï¼šå®Œæ•´è°ƒè¯•æ•°æ®æ˜¾ç¤º

**é—®é¢˜**ï¼šæ— æ³•æŸ¥çœ‹å®Œæ•´çš„ AI è¯·æ±‚å’Œå“åº”ï¼Œéš¾ä»¥æŽ’æŸ¥é—®é¢˜

**ä¿®å¤**ï¼š
- æ·»åŠ  `ai_request`, `ai_response`, `processed_data` å­—æ®µåˆ°æ•°æ®åº“
- åœ¨ä»»åŠ¡è¯¦æƒ…é¡µå±•ç¤ºå®Œæ•´çš„è°ƒè¯•æ•°æ®

**æ•ˆæžœ**ï¼š
- âœ… å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„ AI è¯·æ±‚ï¼ˆåŒ…æ‹¬ promptï¼‰
- âœ… å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„ AI å“åº”
- âœ… å¯ä»¥æŸ¥çœ‹æœ€ç»ˆå…¥åº“çš„æ•°æ®

### 5.2 å¾…è§£å†³çš„é—®é¢˜

#### âš ï¸ é—®é¢˜ï¼šzh explanation ç¼ºå¤±

**æ ¹æœ¬åŽŸå› **ï¼š
1. AI æ¨¡åž‹è¿”å›žé”™è¯¯çš„ `source.language`ï¼ˆ"ja" è€Œä¸æ˜¯ "zh"ï¼‰
2. AI è¿”å›žçš„ `source.explanation` æ˜¯æ—¥æ–‡ï¼Œæ— æ³•ä½¿ç”¨
3. AI åœ¨ `translations.zh.explanation` ä¸­è¿”å›žäº†ä¸­æ–‡ï¼Œä½†å› ä¸º `lang === sourceLanguage` è¢«è·³è¿‡

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ Aï¼šåˆ‡æ¢åˆ°æ›´å¼ºå¤§çš„ AI æ¨¡åž‹**ï¼ˆæŽ¨èï¼‰
```sql
UPDATE ai_config 
SET provider = 'render', model = 'gpt-4o-mini' 
WHERE id = 1;
```

**æ–¹æ¡ˆ Bï¼šä½¿ç”¨ fill_missing æ“ä½œ**
- å…ˆæ‰§è¡Œ full_pipeline ç¿»è¯‘
- å†å•ç‹¬æ‰§è¡Œ fill_missing è¡¥å……ç¼ºå¤±çš„ zh explanation

**æ–¹æ¡ˆ Cï¼šæ·»åŠ å®¹é”™é€»è¾‘**ï¼ˆä¸æŽ¨èï¼‰
- æ£€æµ‹ AI è¿”å›žçš„ `source.language` æ˜¯å¦æ­£ç¡®
- å¦‚æžœé”™è¯¯ï¼Œå°è¯•ä»Ž `translations.zh` ä¸­æå– explanation
- å¢žåŠ ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬

### 5.3 å»ºè®®çš„åŽç»­ä¼˜åŒ–

1. **æ”¹è¿› prompt**ï¼šæ˜Žç¡®è¦æ±‚ AI æ­£ç¡®è¿”å›ž `source.language`
2. **æ·»åŠ éªŒè¯**ï¼šåœ¨ AI å“åº”è§£æžåŽï¼ŒéªŒè¯ `source.language` æ˜¯å¦æ­£ç¡®
3. **å®¹é”™æœºåˆ¶**ï¼šå¦‚æžœ `source.language` é”™è¯¯ï¼Œå°è¯•ä»Ž `translations` ä¸­æå–æºè¯­è¨€æ•°æ®
4. **ç›‘æŽ§å‘Šè­¦**ï¼šå½“ AI è¿”å›žé”™è¯¯çš„ `source.language` æ—¶ï¼Œè®°å½•å‘Šè­¦æ—¥å¿—

---

## ðŸ“Œ ç¬¬å…­éƒ¨åˆ†ï¼šæµ‹è¯•éªŒè¯ï¼ˆTestingï¼‰

### 6.1 æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹1ï¼šja ç¿»è¯‘è¯†åˆ«

**è¾“å…¥**ï¼š
- é¢˜ç›®ï¼šä¸­æ–‡é¢˜ç›®
- æºè¯­è¨€ï¼šzh
- ç›®æ ‡è¯­è¨€ï¼šja, en

**é¢„æœŸç»“æžœ**ï¼š
- âœ… ja å†…å®¹æˆåŠŸå…¥åº“
- âœ… ja explanation æˆåŠŸå…¥åº“
- âœ… en å†…å®¹å’Œ explanation æˆåŠŸå…¥åº“

**å®žé™…ç»“æžœ**ï¼š
- âœ… é€šè¿‡ï¼ˆæ—¥æ–‡å‡åæ£€æµ‹ç”Ÿæ•ˆï¼‰

#### æµ‹è¯•ç”¨ä¾‹2ï¼šzh explanation è¡¥å……

**è¾“å…¥**ï¼š
- é¢˜ç›®ï¼šç¼ºå°‘ zh explanation çš„ä¸­æ–‡é¢˜ç›®
- æºè¯­è¨€ï¼šzh
- ç›®æ ‡è¯­è¨€ï¼šja, en
- AI æ¨¡åž‹ï¼šqwen2.5:3b-instruct

**é¢„æœŸç»“æžœ**ï¼š
- âš ï¸ zh explanation å¯èƒ½ç¼ºå¤±ï¼ˆå–å†³äºŽ AI æ¨¡åž‹ï¼‰

**å®žé™…ç»“æžœ**ï¼š
- âš ï¸ zh explanation ç¼ºå¤±ï¼ˆAI æ¨¡åž‹è¿”å›žé”™è¯¯çš„ source.languageï¼‰

### 6.2 éªŒè¯æ–¹æ³•

1. **æŸ¥çœ‹æ—¥å¿—**ï¼š
   ```
   [processFullPipelineBatch] [Q12] [DEBUG] æ£€æŸ¥ AI source.language: AIè¿”å›ž=ja, æœŸæœ›=zh, åŒ¹é…=false
   [processFullPipelineBatch] [Q12] âš ï¸ AI è¿”å›žçš„ source.language=ja ä¸ŽæœŸæœ›çš„ zh ä¸åŒ¹é…ï¼Œè·³è¿‡ä½¿ç”¨ source.explanation
   ```

2. **æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…**ï¼š
   - åœ¨ä»»åŠ¡è¯¦æƒ…é¡µæŸ¥çœ‹ "ðŸ“¤ AI è¯·æ±‚ä½“ï¼ˆå®Œæ•´ï¼‰"
   - æŸ¥çœ‹ "ðŸ“¥ AI å“åº”ï¼ˆå®Œæ•´ï¼‰"
   - æŸ¥çœ‹ "ðŸ’¾ æœ€ç»ˆå…¥åº“æ•°æ®"

3. **éªŒè¯æ•°æ®åº“**ï¼š
   ```sql
   SELECT id, content, explanation 
   FROM questions 
   WHERE id = 12;
   ```

---

## ðŸ“Œ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæ€»ç»“ï¼ˆSummaryï¼‰

### 7.1 é—®é¢˜çŠ¶æ€

| é—®é¢˜ | çŠ¶æ€ | è¯´æ˜Ž |
|------|------|------|
| ja ç¿»è¯‘è¢«è¯¯åˆ¤ | âœ… å·²ä¿®å¤ | é€šè¿‡æ—¥æ–‡å‡åæ£€æµ‹åŒºåˆ†ä¸­æ—¥æ–‡ |
| zh explanation ç¼ºå¤± | âš ï¸ AI æ¨¡åž‹é—®é¢˜ | éœ€è¦åˆ‡æ¢åˆ°æ›´å¼ºå¤§çš„æ¨¡åž‹ |
| è°ƒè¯•æ•°æ®ä¸å®Œæ•´ | âœ… å·²ä¿®å¤ | çŽ°åœ¨å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„è¯·æ±‚å’Œå“åº” |

### 7.2 å…³é”®å‘çŽ°

1. **AI æ¨¡åž‹é—®é¢˜**ï¼šqwen2.5:3b-instruct æœ‰æ—¶è¿”å›žé”™è¯¯çš„ `source.language`
2. **è¯­è¨€æ£€æµ‹æ”¹è¿›**ï¼šé€šè¿‡å‡åæ£€æµ‹å¯ä»¥å‡†ç¡®åŒºåˆ†ä¸­æ—¥æ–‡
3. **è°ƒè¯•æ•°æ®é‡è¦æ€§**ï¼šå®Œæ•´çš„è°ƒè¯•æ•°æ®æœ‰åŠ©äºŽå¿«é€Ÿå®šä½é—®é¢˜

### 7.3 ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³**ï¼šä½¿ç”¨ fill_missing æ“ä½œè¡¥å……ç¼ºå¤±çš„ zh explanation
2. **çŸ­æœŸ**ï¼šåˆ‡æ¢åˆ°æ›´å¼ºå¤§çš„ AI æ¨¡åž‹ï¼ˆgpt-4o-miniï¼‰
3. **é•¿æœŸ**ï¼šæ”¹è¿› promptï¼Œæ˜Žç¡®è¦æ±‚ AI æ­£ç¡®è¿”å›žæºè¯­è¨€æ•°æ®

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-21  
**è¯Šæ–­çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ä¿®å¤çŠ¶æ€**: éƒ¨åˆ†ä¿®å¤ï¼ˆja ç¿»è¯‘å·²ä¿®å¤ï¼Œzh explanation å¾…è§£å†³ï¼‰

