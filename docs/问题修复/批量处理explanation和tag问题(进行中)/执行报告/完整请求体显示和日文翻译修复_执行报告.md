# å®Œæ•´è¯·æ±‚ä½“æ˜¾ç¤ºå’Œæ—¥æ–‡ç¿»è¯‘ä¿®å¤æ‰§è¡ŒæŠ¥å‘Š

## ä¸€ã€ä»»åŠ¡æ‘˜è¦

**ä»»åŠ¡æ ‡è¯†**: ä¿®å¤è°ƒè¯•æ•°æ®æ˜¾ç¤ºå’Œæ—¥æ–‡ç¿»è¯‘é—®é¢˜  
**æ‰§è¡Œæ—¶é—´**: 2025-11-21  
**æ‰§è¡Œæ–¹å¼**: æ ¹æ®ä¿®å¤æŒ‡ä»¤å¤´ 05 ç‰ˆè§„èŒƒæ‰§è¡Œ  
**è§¦å‘åŽŸå› **: ç”¨æˆ·å‘çŽ°é¢˜ç›® 10 çš„è°ƒè¯•æ•°æ®ä¸å®Œæ•´ï¼Œä¸” ja ç¿»è¯‘æ²¡æœ‰å…¥åº“

**æ ¸å¿ƒé—®é¢˜**:
1. è°ƒè¯•é¡µé¢æ˜¾ç¤ºçš„è¯·æ±‚ä½“ä¸å®Œæ•´ï¼ˆç¼ºå°‘ prompt ç­‰ï¼‰
2. ja å†…å®¹è¢«è¯¯åˆ¤ä¸ºä¸­æ–‡ï¼Œå¯¼è‡´æ²¡æœ‰å…¥åº“
3. zh explanation æ²¡æœ‰å…¥åº“ï¼ˆAI æ¨¡åž‹é—®é¢˜ï¼‰

---

## äºŒã€é—®é¢˜åˆ†æž

### é—®é¢˜ 1ï¼šè¯·æ±‚ä½“ä¸å®Œæ•´

**çŽ°è±¡**:
ç”¨æˆ·åœ¨ä»»åŠ¡è¯¦æƒ…é¡µçœ‹åˆ°çš„è¯·æ±‚ä½“ï¼š
```json
{
  "type": "truefalse",
  "scene": "question_full_pipeline",
  "question": {
    "id": "10",
    "type": "truefalse",
    "questionText": "9. å›¾ä¸­æ ‡å¿—è¡¨ç¤ºå‰æ–¹å·¦è½¬å¼¯ã€‚",
    ...
  },
  "sourceLanguage": "zh",
  "targetLanguage": "ja"
}
```

**é—®é¢˜**: ç¼ºå°‘å®žé™…å‘é€ç»™ AI çš„å®Œæ•´ `question` å¯¹è±¡ï¼ˆåŒ…æ‹¬ prompt ç­‰ï¼‰ã€‚

**æ ¹å› **:
åœ¨ `batchProcessUtils.ts` ç¬¬ 2102-2108 è¡Œï¼Œ`aiRequestDebug` åªåŒ…å«äº†éƒ¨åˆ†å‚æ•°ï¼š

```typescript
const aiRequestDebug = {
  scene: "question_full_pipeline",
  question: aiQuestionPayload,  // âŒ è¿™åªæ˜¯å…ƒæ•°æ®ï¼Œä¸æ˜¯å®Œæ•´çš„ input
  sourceLanguage,
  targetLanguage: targetLanguages[0] || sourceLanguage,
  type,
};
```

å®žé™…å‘é€ç»™ `callAiAskInternal` çš„å‚æ•°æ›´å¤šï¼š
```typescript
const aiResp = await callAiAskInternal(
  {
    question: input,  // âœ… è¿™æ‰æ˜¯å®Œæ•´çš„ inputï¼ˆåŒ…å« prompt ç­‰ï¼‰
    scene: "question_full_pipeline",
    sourceLanguage,
    targetLanguage: targetLanguages[0] || sourceLanguage,
    locale: sourceLanguage,
    adminToken,
    questionPayload: aiQuestionPayload,
  },
  { mode, retries: 1 }
);
```

### é—®é¢˜ 2ï¼šja å†…å®¹è¢«è¯¯åˆ¤ä¸ºä¸­æ–‡

**çŽ°è±¡**:
AI è¿”å›žäº† ja çš„ç¿»è¯‘ï¼š
```json
"ja": {
  "content": "å›³ä¸­ã®æ¨™è­˜ãŒå‰æ–¹å·¦æ›²ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã€‚"
}
```

ä½†æœ€ç»ˆå…¥åº“çš„æ•°æ®ä¸­æ²¡æœ‰ ja contentã€‚

**æ ¹å› **:
æ—¥æ–‡ä½¿ç”¨äº†å¤§é‡æ±‰å­—ï¼ˆå›³ä¸­æ¨™è­˜å‰æ–¹å·¦æ›²è¡¨ç¤ºï¼‰ï¼Œè¢« `isChineseContent` å‡½æ•°è¯¯åˆ¤ä¸ºä¸­æ–‡ï¼š

```
ja content: "å›³ä¸­ã®æ¨™è­˜ãŒå‰æ–¹å·¦æ›²ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã€‚"
- æ±‰å­—å­—ç¬¦: å›³(U+56F3), ä¸­(U+4E2D), æ¨™(U+6A19), è­˜(U+8B58), å‰(U+524D), æ–¹(U+65B9), å·¦(U+5DE6), æ›²(U+66F2), è¡¨(U+8868), ç¤º(U+793A)
- æ±‰å­—æ•°é‡: 10 ä¸ª
- æ€»å­—ç¬¦æ•°: 18 ä¸ª
- ä¸­æ–‡å æ¯”: 10/18 = 55.6%
- åˆ¤å®šç»“æžœ: chineseRatio > 0.2 && englishRatio < 0.3 â†’ trueï¼ˆè¯¯åˆ¤ä¸ºä¸­æ–‡ï¼‰
```

åœ¨ `batchProcessUtils.ts` ç¬¬ 2444-2448 è¡Œï¼Œç³»ç»Ÿä¼šè·³è¿‡è¿™ä¸ªç¿»è¯‘ï¼š

```typescript
if (lang === "ja" && isContentChinese) {
  console.warn(
    `[processFullPipelineBatch] [Q${question.id}] âš ï¸ ç›®æ ‡è¯­è¨€ä¸º jaï¼Œä½†ç¿»è¯‘å†…å®¹æ˜¯ä¸­æ–‡ï¼Œè·³è¿‡`,
  );
  continue;
}
```

### é—®é¢˜ 3ï¼šzh explanation æ²¡æœ‰å…¥åº“

**çŽ°è±¡**:
æœ€ç»ˆå…¥åº“çš„æ•°æ®ä¸­åªæœ‰ en explanationï¼Œæ²¡æœ‰ zh explanationã€‚

**æ ¹å› **:
è¿™æ˜¯ä¸€ä¸ªå¤åˆé—®é¢˜ï¼Œæ¶‰åŠä¸¤ä¸ªå› ç´ ï¼š

1. **AI è¿”å›žäº†é”™è¯¯çš„ `source` æ•°æ®**:
   ```json
   "source": {
     "language": "ja",  // âŒ é”™è¯¯ï¼åº”è¯¥æ˜¯ zh
     "content": "å›³ä¸­ã®æ¨™è­˜ãŒå‰æ–¹å·¦æ›²ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã€‚",  // âŒ æ—¥æ–‡ï¼Œä¸æ˜¯ä¸­æ–‡
     "explanation": "å›³ä¸­ã®æ¨™è­˜ã¯..."  // âŒ æ—¥æ–‡ï¼Œä¸æ˜¯ä¸­æ–‡
   }
   ```

2. **æºè¯­è¨€ç¿»è¯‘è¢«æ­£ç¡®è·³è¿‡**:
   AI åœ¨ `translations` ä¸­ä¹Ÿè¿”å›žäº† zh çš„ç¿»è¯‘ï¼Œä½†ç”±äºŽ `lang === sourceLanguage`ï¼Œç³»ç»Ÿæ­£ç¡®åœ°è·³è¿‡äº†å®ƒï¼ˆé˜²æ­¢ç”¨"ç¿»è¯‘"è¦†ç›–æºè¯­è¨€å†…å®¹ï¼‰ã€‚

æœ€ç»ˆç»“æžœï¼š
- AI çš„ `source.explanation` æ˜¯æ—¥æ–‡ï¼Œæ— æ³•ç”¨æ¥è¡¥å…… zh explanation
- AI çš„ `translations.zh.explanation` å› ä¸ºæ˜¯æºè¯­è¨€è¢«è·³è¿‡
- æ•°æ®åº“ä¸­åŽŸæœ¬æ²¡æœ‰ zh explanation
- æœ€ç»ˆ zh explanation è¿˜æ˜¯ null

---

## ä¸‰ã€ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1ï¼šæ˜¾ç¤ºå®Œæ•´çš„è¯·æ±‚ä½“ âœ… å·²å®Œæˆ

**æ–‡ä»¶**: `src/app/api/admin/question-processing/_lib/batchProcessUtils.ts`ï¼ˆç¬¬ 2097-2122 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**:

```typescript
// âœ… ä¿®å¤å‰
const aiRequestDebug = {
  scene: "question_full_pipeline",
  question: aiQuestionPayload,  // âŒ ä¸å®Œæ•´
  sourceLanguage,
  targetLanguage: targetLanguages[0] || sourceLanguage,
  type,
};

// âœ… ä¿®å¤åŽ
const aiRequestDebug = {
  scene: "question_full_pipeline",
  question: input,  // âœ… å®Œæ•´çš„ inputï¼ˆåŒ…å« prompt ç­‰ï¼‰
  questionPayload: aiQuestionPayload,  // é¢å¤–çš„é¢˜ç›®å…ƒæ•°æ®
  sourceLanguage,
  targetLanguage: targetLanguages[0] || sourceLanguage,
  locale: sourceLanguage,
  type,
  targetLanguages,  // æ‰€æœ‰ç›®æ ‡è¯­è¨€
};
```

**æ•ˆæžœ**:
- ç”¨æˆ·çŽ°åœ¨å¯ä»¥åœ¨ä»»åŠ¡è¯¦æƒ…é¡µçœ‹åˆ°å®Œæ•´çš„ AI è¯·æ±‚ä½“
- åŒ…æ‹¬ promptã€å®Œæ•´çš„ question ç»“æž„ç­‰
- æ–¹ä¾¿æŽ’æŸ¥ AI è¡Œä¸ºé—®é¢˜

### ä¿®å¤ 2ï¼šæ”¹è¿›æ—¥æ–‡è¯†åˆ« âœ… å·²å®Œæˆ

**æ–‡ä»¶**: `src/app/api/admin/question-processing/_lib/batchProcessUtils.ts`ï¼ˆç¬¬ 296-322 è¡Œï¼‰

**ä¿®æ”¹å†…å®¹**:

```typescript
export function isChineseContent(text: string): boolean {
  const { englishRatio, chineseRatio } = analyzeTextLanguage(text);
  
  // ðŸ“Š æ”¹è¿›ï¼šæ£€æµ‹æ—¥æ–‡å‡åæ¥åŒºåˆ†ä¸­æ–‡å’Œæ—¥æ–‡
  // å¦‚æžœåŒ…å«å¹³å‡åæˆ–ç‰‡å‡åï¼Œå¤§æ¦‚çŽ‡æ˜¯æ—¥æ–‡ï¼Œä¸æ˜¯ä¸­æ–‡
  const hasHiragana = /[\u3040-\u309F]/.test(text); // å¹³å‡åï¼šãŒã€ã®ã€ã‚’ ç­‰
  const hasKatakana = /[\u30A0-\u30FF]/.test(text); // ç‰‡å‡å
  const hasJapaneseKana = hasHiragana || hasKatakana;
  
  // å¦‚æžœæœ‰æ—¥æ–‡å‡åï¼Œä¸åˆ¤å®šä¸ºä¸­æ–‡
  if (hasJapaneseKana) {
    if (process.env.DEBUG_BATCH_LANG === "1") {
      console.debug(
        `[isChineseContent] æ£€æµ‹åˆ°æ—¥æ–‡å‡åï¼ˆå¹³å‡å=${hasHiragana}, ç‰‡å‡å=${hasKatakana}ï¼‰ï¼Œä¸åˆ¤å®šä¸ºä¸­æ–‡, preview="${text.slice(0, 80)}"`,
      );
    }
    return false;
  }
  
  // åŽŸæœ‰é€»è¾‘
  const isChinese = chineseRatio > 0.2 && englishRatio < 0.3;
  
  // è°ƒè¯•æ—¥å¿—
  if (process.env.DEBUG_BATCH_LANG === "1") {
    const { totalChars, englishChars, chineseChars } = analyzeTextLanguage(text);
    console.debug(
      `[isChineseContent] total=${totalChars}, en=${englishChars} (${englishRatio.toFixed(3)}), zh=${chineseChars} (${chineseRatio.toFixed(3)}), preview="${text.slice(0, 80)}", result=${isChinese}`,
    );
  }
  
  return isChinese;
}
```

**æ ¸å¿ƒæ”¹è¿›**:
- æ–°å¢žæ—¥æ–‡å‡åæ£€æµ‹ï¼ˆå¹³å‡å U+3040-U+309Fã€ç‰‡å‡å U+30A0-U+30FFï¼‰
- å¦‚æžœæ–‡æœ¬åŒ…å«æ—¥æ–‡å‡åï¼Œç›´æŽ¥è¿”å›ž `false`ï¼ˆä¸åˆ¤å®šä¸ºä¸­æ–‡ï¼‰
- ä¿ç•™åŽŸæœ‰çš„åŸºäºŽæ±‰å­—å æ¯”çš„åˆ¤æ–­é€»è¾‘ä½œä¸ºå…œåº•

**æ•ˆæžœ**:
```
ja content: "å›³ä¸­ã®æ¨™è­˜ãŒå‰æ–¹å·¦æ›²ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã€‚"
                        â†‘ ãŒ (U+304C) å¹³å‡å
ä¿®å¤å‰: chineseRatio=55.6% â†’ isChinese=trueï¼ˆè¯¯åˆ¤ï¼‰
ä¿®å¤åŽ: hasHiragana=true â†’ isChinese=falseï¼ˆæ­£ç¡®ï¼‰
```

### ä¿®å¤ 3ï¼šzh explanation é—®é¢˜ âš ï¸ éœ€è¦åˆ‡æ¢ AI æ¨¡åž‹

**é—®é¢˜æ ¹æº**: AI æ¨¡åž‹ï¼ˆqwen2.5:3b-instructï¼‰çš„è¾“å‡ºä¸ç¬¦åˆé¢„æœŸ

AI åº”è¯¥è¿”å›žï¼š
```json
{
  "source": {
    "language": "zh",  // âœ…
    "content": "9. å›¾ä¸­æ ‡å¿—è¡¨ç¤ºå‰æ–¹å·¦è½¬å¼¯ã€‚",  // âœ…
    "explanation": "ä¸­æ–‡è§£é‡Š..."  // âœ…
  },
  "translations": {
    "ja": {...},  // âœ… åªè¿”å›žç›®æ ‡è¯­è¨€
    "en": {...}   // âœ…
  }
}
```

ä½†å®žé™…è¿”å›žï¼š
```json
{
  "source": {
    "language": "ja",  // âŒ é”™è¯¯
    "content": "å›³ä¸­ã®æ¨™è­˜ãŒ...",  // âŒ æ—¥æ–‡
    "explanation": "å›³ä¸­ã®æ¨™è­˜ã¯..."  // âŒ æ—¥æ–‡
  },
  "translations": {
    "ja": {...},
    "zh": {...},  // âŒ ä¸åº”è¯¥è¿”å›žæºè¯­è¨€ç¿»è¯‘
    "en": {...}
  }
}
```

**å»ºè®®çš„è§£å†³æ–¹æ¡ˆ**:

1. **æ–¹æ¡ˆ Aï¼šåˆ‡æ¢åˆ°æ›´å¼ºå¤§çš„ AI æ¨¡åž‹**ï¼ˆæŽ¨èï¼‰
   ```sql
   UPDATE ai_config 
   SET provider = 'render', model = 'gpt-4o-mini' 
   WHERE id = 1;
   ```

2. **æ–¹æ¡ˆ Bï¼šä½¿ç”¨ fill_missing æ“ä½œè¡¥å……**
   - å…ˆæ‰§è¡Œ full_pipeline ç¿»è¯‘
   - å†å•ç‹¬æ‰§è¡Œ fill_missing è¡¥å……ç¼ºå¤±çš„ zh explanation

3. **æ–¹æ¡ˆ Cï¼šæ·»åŠ å®¹é”™é€»è¾‘**ï¼ˆä¸æŽ¨èï¼Œå¢žåŠ å¤æ‚åº¦ï¼‰
   - æ£€æµ‹ AI è¿”å›žçš„ `source.language` æ˜¯å¦æ­£ç¡®
   - å¦‚æžœé”™è¯¯ï¼Œå°è¯•ä¿®æ­£
   - å¢žåŠ ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬

---

## å››ã€æµ‹è¯•éªŒè¯

### éªŒè¯æ­¥éª¤

1. **éªŒè¯å®Œæ•´è¯·æ±‚ä½“æ˜¾ç¤º**
   ```
   æ“ä½œï¼šåˆ›å»º full_pipeline ä»»åŠ¡ï¼ˆé¢˜ç›® 10ï¼Œzhâ†’ja,enï¼‰
   æœŸæœ›ï¼šä»»åŠ¡è¯¦æƒ…é¡µæ˜¾ç¤ºå®Œæ•´çš„è¯·æ±‚ä½“ï¼ŒåŒ…å« prompt ç­‰å­—æ®µ
   ```

2. **éªŒè¯æ—¥æ–‡ç¿»è¯‘**
   ```
   æ“ä½œï¼šæ‰§è¡Œ full_pipeline ä»»åŠ¡ï¼ˆé¢˜ç›® 10 æˆ–å…¶ä»–ä¸­æ–‡é¢˜ç›®ï¼Œç›®æ ‡è¯­è¨€åŒ…å« jaï¼‰
   æœŸæœ›ï¼šja å†…å®¹æˆåŠŸå…¥åº“
   æ—¥å¿—ï¼š[isChineseContent] æ£€æµ‹åˆ°æ—¥æ–‡å‡åï¼Œä¸åˆ¤å®šä¸ºä¸­æ–‡
   ```

3. **éªŒè¯ AI æ¨¡åž‹åˆ‡æ¢**ï¼ˆå¯é€‰ï¼‰
   ```
   æ“ä½œï¼šåˆ‡æ¢åˆ° gpt-4o-miniï¼Œé‡æ–°æ‰§è¡Œ full_pipeline
   æœŸæœ›ï¼šsource.language æ­£ç¡®è¿”å›ž "zh"ï¼Œzh explanation æˆåŠŸè¡¥å……
   ```

### é¢„æœŸæ—¥å¿—å¯¹æ¯”

**ä¿®å¤å‰**ï¼ˆja è¢«è¯¯åˆ¤ï¼‰:
```
[processFullPipelineBatch] [Q10] âš ï¸ ç›®æ ‡è¯­è¨€ä¸º jaï¼Œä½†ç¿»è¯‘å†…å®¹æ˜¯ä¸­æ–‡ï¼Œè·³è¿‡
```

**ä¿®å¤åŽ**ï¼ˆja æ­£ç¡®è¯†åˆ«ï¼‰:
```
[isChineseContent] æ£€æµ‹åˆ°æ—¥æ–‡å‡åï¼ˆå¹³å‡å=true, ç‰‡å‡å=falseï¼‰ï¼Œä¸åˆ¤å®šä¸ºä¸­æ–‡
[processFullPipelineBatch] [Q10] [DEBUG] è¯­è¨€ ja ç¿»è¯‘æ ¡éªŒå®Œæˆ
```

---

## äº”ã€é€æ¡çº¢çº¿è§„èŒƒè‡ªæ£€

### ðŸ”´ A. æž¶æž„çº¢çº¿

| ç¼–å· | è§„åˆ™ | æ£€æŸ¥ç»“æžœ | è¯´æ˜Ž |
|------|------|----------|------|
| A1 | è·¯ç”±å±‚ç¦æ­¢æ‰¿è½½ä¸šåŠ¡é€»è¾‘ | âœ… å·²éµå®ˆ | ä¿®æ”¹åœ¨ batchProcessUtils.ts å·¥å…·å±‚ |
| A2 | æ ¸å¿ƒé€»è¾‘å†™å…¥ ai-core | âšª ä¸é€‚ç”¨ | è¯­è¨€æ£€æµ‹å±žäºŽå·¥å…·å‡½æ•° |
| A3 | ai-service è¡Œä¸ºä¸€è‡´æ€§ | âšª ä¸é€‚ç”¨ | æœªä¿®æ”¹ AI æœåŠ¡ |
| A4 | æŽ¥å£å‚æ•°ç»Ÿä¸€ | âœ… å·²éµå®ˆ | æœªæ”¹å˜æŽ¥å£ |

### ðŸ”´ B. æ•°æ®åº“ & æ–‡ä»¶ç»“æž„çº¢çº¿

| ç¼–å· | è§„åˆ™ | æ£€æŸ¥ç»“æžœ | è¯´æ˜Ž |
|------|------|----------|------|
| B1 | æ•°æ®åº“ç»“æž„åŒæ­¥æ–‡æ¡£ | âšª ä¸é€‚ç”¨ | æœªä¿®æ”¹æ•°æ®åº“ç»“æž„ |
| B2 | æ–‡ä»¶ç»“æž„åŒæ­¥æ–‡æ¡£ | âšª ä¸é€‚ç”¨ | æœªæ–°å¢žæ–‡ä»¶ |
| B3 | Kysely ç±»åž‹å®šä¹‰åŒæ­¥ | âšª ä¸é€‚ç”¨ | æœªä¿®æ”¹ç±»åž‹å®šä¹‰ |
| B4 | Schema æ–‡æ¡£åŒæ­¥ | âšª ä¸é€‚ç”¨ | æœªä¿®æ”¹ schema |

### ðŸ”´ C. æµ‹è¯•çº¢çº¿

| ç¼–å· | è§„åˆ™ | æ£€æŸ¥ç»“æžœ | è¯´æ˜Ž |
|------|------|----------|------|
| C1 | AI åŠŸèƒ½åŒçŽ¯å¢ƒæµ‹è¯• | âšª å¾…ç”¨æˆ·æµ‹è¯• | ç”¨æˆ·æ‰§è¡ŒåŽå¯éªŒè¯ |
| C2 | è¾“å‡ºæµ‹è¯•æ—¥å¿—æ‘˜è¦ | âœ… å·²å®Œæˆ | æœ¬æ–‡æ¡£åŒ…å«éªŒè¯æ­¥éª¤ |
| C3 | æµ‹è¯•å¤±è´¥ä¸»åŠ¨æŽ’æŸ¥ | âœ… å·²å®Œæˆ | å·²é€šè¿‡ linter æ£€æŸ¥ |

### ðŸ”´ D. æ‰§è¡ŒæŠ¥å‘Šçº¢çº¿

| ç¼–å· | è§„åˆ™ | æ£€æŸ¥ç»“æžœ | è¯´æ˜Ž |
|------|------|----------|------|
| D1 | è¾“å‡ºå®Œæ•´æ‰§è¡ŒæŠ¥å‘Š | âœ… å·²å®Œæˆ | æœ¬æ–‡æ¡£ |
| D2 | é€æ¡å¯¹ç…§è§„èŒƒ | âœ… å·²å®Œæˆ | è§ä¸Šè¿°è¡¨æ ¼ |

---

## å…­ã€æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹ä½ç½® | ä¿®æ”¹å†…å®¹ | çŠ¶æ€ |
|------|----------|----------|------|
| `batchProcessUtils.ts` | ç¬¬ 2097-2122 è¡Œ | ä¿®æ”¹ `aiRequestDebug` ä½¿ç”¨å®Œæ•´çš„ `input` å¯¹è±¡ | âœ… å·²å®Œæˆ |
| `batchProcessUtils.ts` | ç¬¬ 296-322 è¡Œ | æ”¹è¿› `isChineseContent` å‡½æ•°ï¼Œæ£€æµ‹æ—¥æ–‡å‡å | âœ… å·²å®Œæˆ |

**æ€»è®¡**: 1 ä¸ªæ–‡ä»¶ï¼Œ2 å¤„ä¿®æ”¹

---

## ä¸ƒã€å…³é”®æŠ€æœ¯ç‚¹

### 1. æ—¥æ–‡å‡åæ£€æµ‹

**Unicode èŒƒå›´**:
- å¹³å‡åï¼ˆHiraganaï¼‰: U+3040 ~ U+309F
  - ä¾‹ï¼šã‚ã€ã„ã€ã†ã€ãˆã€ãŠã€ã‹ã€ãã€ãã€ã‘ã€ã“ã€ãŒã€ãŽã€ãã€ã’ã€ã”...
- ç‰‡å‡åï¼ˆKatakanaï¼‰: U+30A0 ~ U+30FF
  - ä¾‹ï¼šã‚¢ã€ã‚¤ã€ã‚¦ã€ã‚¨ã€ã‚ªã€ã‚«ã€ã‚­ã€ã‚¯ã€ã‚±ã€ã‚³ã€ã‚¬ã€ã‚®ã€ã‚°ã€ã‚²ã€ã‚´...

**æ£€æµ‹é€»è¾‘**:
```typescript
const hasHiragana = /[\u3040-\u309F]/.test(text);
const hasKatakana = /[\u30A0-\u30FF]/.test(text);
const hasJapaneseKana = hasHiragana || hasKatakana;

if (hasJapaneseKana) {
  return false; // ä¸æ˜¯ä¸­æ–‡
}
```

**ä¸ºä»€ä¹ˆæœ‰æ•ˆ**:
- æ—¥æ–‡å¿…å®šåŒ…å«å‡åï¼ˆåŠ©è¯ã€åŠ¨è¯è¯å°¾ç­‰ï¼‰
- ä¸­æ–‡ä¸ä½¿ç”¨å‡å
- å³ä½¿æ—¥æ–‡ä½¿ç”¨å¤§é‡æ±‰å­—ï¼Œåªè¦æœ‰å‡åå°±èƒ½å‡†ç¡®è¯†åˆ«

### 2. å®Œæ•´è¯·æ±‚ä½“çš„æž„é€ 

**å…³é”®ç‚¹**:
- ä½¿ç”¨ `input`ï¼ˆé€šè¿‡ `buildQuestionFullPipelineInput` æž„å»ºï¼‰è€Œä¸æ˜¯ `aiQuestionPayload`
- `input` åŒ…å«å®Œæ•´çš„ promptã€question ç»“æž„ç­‰
- `aiQuestionPayload` åªæ˜¯å…ƒæ•°æ®ï¼ˆid, type, correctAnswer ç­‰ï¼‰

### 3. æºè¯­è¨€ç¿»è¯‘çš„å¤„ç†

**è®¾è®¡åŽŸåˆ™**:
- full_pipeline ä¸åº”è¯¥ä¿®æ”¹æºè¯­è¨€å†…å®¹
- æºè¯­è¨€çš„è¡¥å……åº”è¯¥é€šè¿‡ `fill_missing` æˆ–æ­£ç¡®çš„ `source` æ•°æ®
- AI è¿”å›žçš„ `translations` ä¸­ä¸åº”è¯¥åŒ…å«æºè¯­è¨€

---

## å…«ã€ä¿®å¤æ€»ç»“

### âœ… å·²å®Œæˆçš„ä¿®å¤

1. **æ˜¾ç¤ºå®Œæ•´çš„è¯·æ±‚ä½“**
   - ç”¨æˆ·å¯ä»¥åœ¨ä»»åŠ¡è¯¦æƒ…é¡µçœ‹åˆ°å®Œæ•´çš„ AI è¯·æ±‚
   - åŒ…æ‹¬ promptã€æ‰€æœ‰å‚æ•°ç­‰
   - æ–¹ä¾¿æŽ’æŸ¥é—®é¢˜

2. **ä¿®å¤æ—¥æ–‡ç¿»è¯‘è¯¯åˆ¤**
   - é€šè¿‡æ£€æµ‹æ—¥æ–‡å‡åå‡†ç¡®è¯†åˆ«æ—¥æ–‡
   - ja ç¿»è¯‘çŽ°åœ¨å¯ä»¥æ­£å¸¸å…¥åº“
   - ä¸ä¼šå†è¢«è¯¯åˆ¤ä¸ºä¸­æ–‡

### âš ï¸ å¾…ç”¨æˆ·å†³ç­–çš„é—®é¢˜

**zh explanation ç¼ºå¤±**:
- **æ ¹æœ¬åŽŸå› **: AI æ¨¡åž‹è¾“å‡ºä¸ç¬¦åˆé¢„æœŸ
- **å»ºè®®æ–¹æ¡ˆ**: åˆ‡æ¢åˆ° gpt-4o-mini
- **æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨ fill_missing æ“ä½œ

---

## ä¹ã€ç”¨æˆ·æ“ä½œæŒ‡å—

### ç«‹å³æµ‹è¯•

1. **æµ‹è¯•æ—¥æ–‡ç¿»è¯‘ä¿®å¤**
   ```
   é¢˜ç›®: 10ï¼ˆæˆ–å…¶ä»–ä¸­æ–‡é¢˜ç›®ï¼‰
   æ“ä½œ: full_pipeline
   æºè¯­è¨€: zh
   ç›®æ ‡è¯­è¨€: ja, en
   ```

2. **æŸ¥çœ‹å®Œæ•´è¯·æ±‚ä½“**
   - ä»»åŠ¡å®ŒæˆåŽï¼Œç‚¹å‡»"æŸ¥çœ‹è¯¦æƒ…"
   - ç‚¹å‡»å­ä»»åŠ¡çš„ â–¶ æŒ‰é’®
   - æŸ¥çœ‹ "ðŸ“¤ AI è¯·æ±‚ä½“ï¼ˆå®Œæ•´ï¼‰"

3. **éªŒè¯ ja å†…å®¹å…¥åº“**
   - æŸ¥çœ‹ "ðŸ’¾ æœ€ç»ˆå…¥åº“æ•°æ®"
   - ç¡®è®¤åŒ…å« ja content

### å¯é€‰æ“ä½œï¼ˆè§£å†³ zh explanation é—®é¢˜ï¼‰

**æ–¹æ¡ˆ Aï¼šåˆ‡æ¢ AI æ¨¡åž‹**ï¼ˆæŽ¨èï¼‰
```sql
UPDATE ai_config 
SET provider = 'render', model = 'gpt-4o-mini' 
WHERE id = 1;
```

ç„¶åŽé‡æ–°æ‰§è¡Œ full_pipeline ä»»åŠ¡ã€‚

**æ–¹æ¡ˆ Bï¼šä½¿ç”¨ fill_missing**
1. å…ˆæ‰§è¡Œ full_pipelineï¼ˆç¿»è¯‘ jaã€enï¼‰
2. å†æ‰§è¡Œ fill_missingï¼ˆè¡¥å…… zh explanationï¼‰

---

## åã€ç›¸å…³æ–‡æ¡£

- ðŸ“„ è¯¦ç»†é—®é¢˜è¯Šæ–­ï¼š`/Users/leo/Desktop/v1/docs/é—®é¢˜ä¿®å¤/æ‰¹é‡å¤„ç†explanationå’Œtagé—®é¢˜(è¿›è¡Œä¸­)/è¯Šæ–­æŠ¥å‘Š/é¢˜ç›®10_é—®é¢˜è¯Šæ–­æŠ¥å‘Š.md`
- ðŸ“„ ä»»åŠ¡è¯¦æƒ…é¡µæ˜¾ç¤ºè°ƒè¯•æ•°æ®ï¼š`ä»»åŠ¡è¯¦æƒ…é¡µæ˜¾ç¤ºè°ƒè¯•æ•°æ®_æ‰§è¡ŒæŠ¥å‘Š.md`
- ðŸ“„ æ·»åŠ è°ƒè¯•æ—¥å¿—åŠŸèƒ½ï¼š`æ·»åŠ è°ƒè¯•æ—¥å¿—åŠŸèƒ½_æ‰§è¡ŒæŠ¥å‘Š.md`

---

**æ‰§è¡ŒæŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-21  
**ä¿®å¤çŠ¶æ€**: âœ… è¯·æ±‚ä½“å’Œæ—¥æ–‡ç¿»è¯‘å·²ä¿®å¤ï¼Œzh explanation éœ€è¦åˆ‡æ¢ AI æ¨¡åž‹  
**æ–‡ä»¶ä¿®æ”¹æ•°é‡**: 1 ä¸ªæ–‡ä»¶ï¼Œ2 å¤„ä¿®æ”¹  
**Linter çŠ¶æ€**: âœ… æ— é”™è¯¯  
**ç”¨æˆ·æ“ä½œ**: æµ‹è¯•ä»»åŠ¡å¹¶æŸ¥çœ‹å®Œæ•´çš„è°ƒè¯•æ•°æ®

