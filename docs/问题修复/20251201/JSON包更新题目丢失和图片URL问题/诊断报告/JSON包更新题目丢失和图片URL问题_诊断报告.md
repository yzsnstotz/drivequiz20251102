# JSONåŒ…æ›´æ–°é¢˜ç›®ä¸¢å¤±å’Œå›¾ç‰‡URLé—®é¢˜ - è¯Šæ–­æŠ¥å‘Š

=======================
ğŸ”§ Cursor é—®é¢˜è¯Šæ–­æŠ¥å‘Š
Issue ID: CP-20251201-001
=======================

## ğŸ“Œ ç¬¬ä¸€éƒ¨åˆ†ï¼šé—®é¢˜æ¦‚è¦ï¼ˆSummaryï¼‰

| å­—æ®µ | å¡«å†™å†…å®¹ |
|------|---------|
| é—®é¢˜åç§° | JSONåŒ…æ›´æ–°åé¢˜ç›®1323ä¸¢å¤±åŠå›¾ç‰‡URLè·å–å¤±è´¥ |
| é—®é¢˜ç­‰çº§ | High |
| è§¦å‘æ—¶é—´ | 2025-12-01ï¼ˆå…·ä½“æ—¶é—´å¾…ç¡®è®¤ï¼‰ |
| è§¦å‘ç¯å¢ƒ | production / staging |
| ç›¸å…³æ¨¡å— | questionDb / questionsLoader / admin / frontend |
| å½“å‰çŠ¶æ€ | å¯å¤ç° |

## ğŸ“Œ ç¬¬äºŒéƒ¨åˆ†ï¼šå¤ç°è·¯å¾„ï¼ˆReproduce Stepsï¼‰

### é—®é¢˜1ï¼šé¢˜ç›®1323åœ¨JSONåŒ…ä¸­ä¸¢å¤±

**å‰ç«¯æ“ä½œæ­¥éª¤ï¼š**
1. ç™»å½•åå°ç®¡ç†ç³»ç»Ÿ
2. è¿›å…¥"é¢˜ç›®ç®¡ç†" â†’ "é¢˜ç›®åˆ—è¡¨"é¡µé¢
3. åœ¨é¡µé¢é¡¶éƒ¨å·¥å…·æ æ‰¾åˆ°"æ›´æ–°JSONåŒ…"æŒ‰é’®
4. ç‚¹å‡»"æ›´æ–°JSONåŒ…"æŒ‰é’®
5. ç­‰å¾…æ›´æ–°å®Œæˆ
6. æ£€æŸ¥JSONåŒ…æ–‡ä»¶ `src/data/questions/zh/questions.json` æˆ–é€šè¿‡æ•°æ®åº“æŸ¥è¯¢ `question_package_versions.package_content`
7. æœç´¢é¢˜ç›®ID 1323ï¼Œå‘ç°ä¸å­˜åœ¨

**è§¦å‘ç‚¹ï¼š**
- é¡µé¢ï¼š`/admin/questions` æˆ– `/admin/questions/list`
- æŒ‰é’®ï¼šé¡µé¢é¡¶éƒ¨å·¥å…·æ çš„"æ›´æ–°JSONåŒ…"æŒ‰é’®
- APIï¼š`POST /api/admin/questions/update-package`

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```bash
curl -X POST https://your-domain.com/api/admin/questions/update-package \
  -H "Authorization: Bearer {admin_token}" \
  -H "Content-Type: application/json"
```

**æ“ä½œç³»ç»Ÿ / æµè§ˆå™¨ / Node ç‰ˆæœ¬ï¼š**
- N/Aï¼ˆæœåŠ¡å™¨ç«¯æ“ä½œï¼‰

### é—®é¢˜2ï¼šé¢˜ç›®1323å›¾ç‰‡URLè·å–å¤±è´¥

**å‰ç«¯æ“ä½œæ­¥éª¤ï¼š**
1. æ‰“å¼€å‰å°åº”ç”¨
2. è¿›å…¥å­¦ä¹ æ¨¡å¼æˆ–è€ƒè¯•æ¨¡å¼
3. å¯¼èˆªåˆ°åŒ…å«é¢˜ç›®1323çš„é¢˜ç›®é›†
4. å½“é¢˜ç›®1323æ˜¾ç¤ºæ—¶ï¼Œè§‚å¯Ÿæ˜¯å¦æ˜¾ç¤ºå›¾ç‰‡
5. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼Œæ£€æŸ¥æ§åˆ¶å°æ—¥å¿—
6. å‘ç°å›¾ç‰‡URLæ— æ³•è·å–æˆ–éªŒè¯å¤±è´¥

**è§¦å‘ç‚¹ï¼š**
- é¡µé¢ï¼š`/study/learn`ã€`/study/exam` æˆ–å…¶ä»–åšé¢˜åœºæ™¯
- ç»„ä»¶ï¼š`QuestionImage` ç»„ä»¶æ¸²æŸ“æ—¶

**æ“ä½œç³»ç»Ÿ / æµè§ˆå™¨ / Node ç‰ˆæœ¬ï¼š**
- ä»»æ„æµè§ˆå™¨
- ä»»æ„æ“ä½œç³»ç»Ÿ

## ğŸ“Œ ç¬¬äºŒéƒ¨åˆ†è¡¥å……ï¼šé—®é¢˜è¯¦ç»†æè¿°

### é—®é¢˜1ï¼šé¢˜ç›®1323åœ¨JSONåŒ…ä¸­ä¸¢å¤±

**ç°è±¡ï¼š**
- é¢˜ç›®ID 1323åœ¨æ•°æ®åº“ï¼ˆ`questions`è¡¨ï¼‰ä¸­å¯ä»¥æ­£å¸¸æŸ¥è¯¢åˆ°
- æ‰§è¡Œ"æ›´æ–°JSONåŒ…"æ“ä½œåï¼Œåœ¨æœ€æ–°çš„JSONåŒ…ï¼ˆ`questions.json`ï¼‰ä¸­æ‰¾ä¸åˆ°è¯¥é¢˜ç›®
- æ›´æ–°åJSONæ•°æ®åŒ…å’Œæ•°æ®åº“é¢˜ç›®åº”è¯¥æ˜¯ä¸€è‡´çš„ï¼Œä½†å®é™…å­˜åœ¨å·®å¼‚

**å½±å“ï¼š**
- å‰å°ç”¨æˆ·æ— æ³•çœ‹åˆ°é¢˜ç›®1323
- æ•°æ®ä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´ç”¨æˆ·ä½“éªŒé—®é¢˜

### é—®é¢˜2ï¼šé¢˜ç›®1323åœ¨å‰å°åšé¢˜åœºæ™¯ä¸­å›¾ç‰‡URLè·å–å¤±è´¥

**ç°è±¡ï¼š**
- é¢˜ç›®1323åœ¨æ•°æ®åº“ä¸­æœ‰`image`å­—æ®µï¼Œä¸”å€¼ä¸ä¸ºç©º
- åœ¨å‰å°åšé¢˜åœºæ™¯ï¼ˆå­¦ä¹ æ¨¡å¼ã€è€ƒè¯•æ¨¡å¼ç­‰ï¼‰ä¸­ï¼Œæ— æ³•è·å–åˆ°è¯¥é¢˜ç›®çš„å›¾ç‰‡URL
- ä¸ç¡®å®šæ˜¯JSONåŒ…ä¸­æ²¡æœ‰`image`å­—æ®µï¼Œè¿˜æ˜¯å‰å°æ¸²æŸ“æ—¶å‡ºç°é—®é¢˜

**å½±å“ï¼š**
- ç”¨æˆ·æ— æ³•çœ‹åˆ°é¢˜ç›®å›¾ç‰‡ï¼Œå½±å“ç­”é¢˜ä½“éªŒ
- å¯èƒ½å¯¼è‡´é¢˜ç›®ä¿¡æ¯ä¸å®Œæ•´

## ğŸ“Œ ç¬¬ä¸‰éƒ¨åˆ†ï¼šå®é™…è¾“å‡ºï¼ˆActual Behaviorï¼‰

### é—®é¢˜1ï¼šé¢˜ç›®1323åœ¨JSONåŒ…ä¸­ä¸¢å¤±

**å®é™…è¡Œä¸ºï¼š**
- æ›´æ–°JSONåŒ…æ“ä½œæˆåŠŸå®Œæˆï¼Œè¿”å›æˆåŠŸæ¶ˆæ¯
- ä½†JSONåŒ…ä¸­ä¸åŒ…å«é¢˜ç›®1323
- æ•°æ®åº“ä¸­å¯ä»¥æ­£å¸¸æŸ¥è¯¢åˆ°é¢˜ç›®1323

**åç«¯è¿”å›ï¼š**
- HTTPçŠ¶æ€ç ï¼š200
- å“åº”å†…å®¹ï¼šåŒ…å«ç‰ˆæœ¬å·ã€é¢˜ç›®æ€»æ•°ç­‰ä¿¡æ¯ï¼Œä½†å®é™…JSONåŒ…ä¸­ç¼ºå°‘é¢˜ç›®1323

**æœåŠ¡å™¨æ—¥å¿—ï¼š**
- éœ€è¦æ£€æŸ¥ `[updateAllJsonPackages]` ç›¸å…³çš„æ—¥å¿—
- éœ€è¦ç¡®è®¤æ˜¯å¦æœ‰é”™è¯¯æˆ–è­¦å‘Šä¿¡æ¯

### é—®é¢˜2ï¼šé¢˜ç›®1323å›¾ç‰‡URLè·å–å¤±è´¥

**å®é™…è¡Œä¸ºï¼š**
- é¢˜ç›®1323å¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼ˆè¯´æ˜é¢˜ç›®æœ¬èº«åœ¨JSONåŒ…ä¸­ï¼‰
- ä½†å›¾ç‰‡æ— æ³•æ˜¾ç¤º
- æµè§ˆå™¨æ§åˆ¶å°å¯èƒ½æ˜¾ç¤ºå›¾ç‰‡åŠ è½½å¤±è´¥æˆ–URLéªŒè¯å¤±è´¥

**å‰ç«¯æ—¥å¿—ï¼š**
- `[ExamMode] Image URL validation result: { isValid: false, ... }`
- æˆ– `[QuestionImage] Image load error: ...`

**åç«¯è¿”å›ï¼š**
- N/Aï¼ˆå›¾ç‰‡URLæ¥è‡ªJSONåŒ…ï¼Œä¸æ¶‰åŠåç«¯APIï¼‰

## ğŸ“Œ ç¬¬å››éƒ¨åˆ†ï¼šæœŸæœ›è¡Œä¸ºï¼ˆExpected Behaviorï¼‰

### é—®é¢˜1ï¼šé¢˜ç›®1323åœ¨JSONåŒ…ä¸­ä¸¢å¤±

**æœŸæœ›è¡Œä¸ºï¼š**
- æ›´æ–°JSONåŒ…åï¼ŒJSONåŒ…åº”è¯¥åŒ…å«æ•°æ®åº“ä¸­æ‰€æœ‰é¢˜ç›®
- é¢˜ç›®1323åº”è¯¥å‡ºç°åœ¨JSONåŒ…çš„ `questions` æ•°ç»„ä¸­
- JSONåŒ…ä¸­çš„é¢˜ç›®æ•°é‡åº”è¯¥ä¸æ•°æ®åº“ä¸­çš„é¢˜ç›®æ•°é‡ä¸€è‡´

### é—®é¢˜2ï¼šé¢˜ç›®1323å›¾ç‰‡URLè·å–å¤±è´¥

**æœŸæœ›è¡Œä¸ºï¼š**
- å¦‚æœæ•°æ®åº“ä¸­æœ‰ `image` å­—æ®µä¸”å€¼ä¸ä¸ºç©ºï¼ŒJSONåŒ…ä¸­åº”è¯¥åŒ…å«è¯¥å­—æ®µ
- å‰å°æ¸²æŸ“æ—¶åº”è¯¥èƒ½å¤Ÿæ­£ç¡®è¯»å– `image` å­—æ®µ
- å¦‚æœ `image` URLæ ¼å¼æœ‰æ•ˆï¼Œåº”è¯¥èƒ½å¤Ÿæ­£å¸¸æ˜¾ç¤ºå›¾ç‰‡

## ğŸ“Œ ç¬¬äº”éƒ¨åˆ†ï¼šä¸¤ä¸ªæ›´æ–°JSONåŒ…æ–¹å¼çš„åŒºåˆ«

### æ–¹å¼1ï¼šGUIç•Œé¢æ›´æ–°ï¼ˆæ¨èä½¿ç”¨ï¼‰

**GUIä½ç½®ï¼š**
- è·¯å¾„ï¼šåå°ç®¡ç† â†’ é¢˜ç›®ç®¡ç† â†’ é¢˜ç›®åˆ—è¡¨é¡µé¢
- ä½ç½®ï¼šé¡µé¢é¡¶éƒ¨å·¥å…·æ åŒºåŸŸ
- æŒ‰é’®åç§°ï¼š"æ›´æ–°JSONåŒ…"
- æŒ‰é’®æ–‡æœ¬ï¼š`{updatingPackage ? "æ›´æ–°ä¸­..." : "æ›´æ–°JSONåŒ…"}`

**è°ƒç”¨é“¾ï¼š**
```
å‰ç«¯æŒ‰é’®ç‚¹å‡»
  â†’ handleUpdatePackage() (src/app/admin/questions/page.tsx:814)
  â†’ POST /api/admin/questions/update-package
  â†’ updateAllJsonPackages() (src/lib/questionDb.ts:1478)
  â†’ saveQuestionFile("__unified__", ...) (src/lib/questionDb.ts:887)
  â†’ ä¿å­˜åˆ° src/data/questions/zh/questions.json
```

**ç‰¹ç‚¹ï¼š**
- éœ€è¦ç®¡ç†å‘˜æƒé™
- é€šè¿‡Webç•Œé¢æ“ä½œï¼Œç”¨æˆ·å‹å¥½
- å®æ—¶åé¦ˆæ›´æ–°ç»“æœ
- æ›´æ–°åè‡ªåŠ¨åˆ·æ–°é¢˜ç›®åˆ—è¡¨

**ä»£ç ä½ç½®ï¼š**
- å‰ç«¯ï¼š`src/app/admin/questions/page.tsx:814-847`
- APIè·¯ç”±ï¼š`src/app/api/admin/questions/update-package/route.ts`
- æ ¸å¿ƒå‡½æ•°ï¼š`src/lib/questionDb.ts:1478-1900`

### æ–¹å¼2ï¼šå‘½ä»¤è¡Œè„šæœ¬æ›´æ–°

**è„šæœ¬ä½ç½®ï¼š**
- æ–‡ä»¶è·¯å¾„ï¼š`scripts/update-json-package-with-version.ts`
- æ‰§è¡Œæ–¹å¼ï¼š`tsx scripts/update-json-package-with-version.ts [version]`

**è°ƒç”¨é“¾ï¼š**
```
å‘½ä»¤è¡Œæ‰§è¡Œè„šæœ¬
  â†’ updateJsonPackageWithVersion() (scripts/update-json-package-with-version.ts:41)
  â†’ ä»æ•°æ®åº“è¯»å–æ‰€æœ‰é¢˜ç›®
  â†’ è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼
  â†’ ä¿å­˜åˆ° src/data/questions/zh/questions.json
```

**ç‰¹ç‚¹ï¼š**
- ä¸éœ€è¦Webç•Œé¢
- å¯ä»¥æŒ‡å®šç‰ˆæœ¬å·
- é€‚åˆæ‰¹é‡æ“ä½œæˆ–è‡ªåŠ¨åŒ–è„šæœ¬
- ä¸»è¦ç”¨äºå¼€å‘/ç»´æŠ¤åœºæ™¯

**ä»£ç ä½ç½®ï¼š**
- è„šæœ¬æ–‡ä»¶ï¼š`scripts/update-json-package-with-version.ts`

### ä¸¤ç§æ–¹å¼çš„åŒºåˆ«

| ç‰¹æ€§ | æ–¹å¼1ï¼ˆGUIï¼‰ | æ–¹å¼2ï¼ˆå‘½ä»¤è¡Œï¼‰ |
|------|------------|----------------|
| ä½¿ç”¨åœºæ™¯ | æ—¥å¸¸ç®¡ç†æ“ä½œ | å¼€å‘/ç»´æŠ¤/è‡ªåŠ¨åŒ– |
| æƒé™è¦æ±‚ | éœ€è¦ç®¡ç†å‘˜ç™»å½• | éœ€è¦æœåŠ¡å™¨è®¿é—®æƒé™ |
| ç”¨æˆ·ç•Œé¢ | Webç•Œé¢ï¼Œå‹å¥½ | å‘½ä»¤è¡Œï¼ŒæŠ€æœ¯æ€§ |
| ç‰ˆæœ¬æ§åˆ¶ | è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬å· | å¯æŒ‡å®šç‰ˆæœ¬å· |
| åé¦ˆæœºåˆ¶ | å®æ—¶æ˜¾ç¤ºç»“æœ | æ§åˆ¶å°è¾“å‡º |
| æ¨èä½¿ç”¨ | âœ… æ˜¯ï¼ˆæ—¥å¸¸ä½¿ç”¨ï¼‰ | âš ï¸ ä»…å¼€å‘ç»´æŠ¤ |

**é‡è¦è¯´æ˜ï¼š**
- **æ–¹å¼1ï¼ˆGUIï¼‰æ˜¯å”¯ä¸€æ¨èç»™ç®¡ç†å‘˜ä½¿ç”¨çš„æ–¹å¼**
- æ–¹å¼2ä¸»è¦ç”¨äºå¼€å‘å’Œç»´æŠ¤åœºæ™¯
- ä¸¤ç§æ–¹å¼æœ€ç»ˆéƒ½è°ƒç”¨ç›¸åŒçš„æ ¸å¿ƒé€»è¾‘ï¼ˆ`updateAllJsonPackages()`ï¼‰

## ğŸ“Œ ç¬¬å…­éƒ¨åˆ†ï¼šä»£ç æµç¨‹åˆ†æ

### 4.1 updateAllJsonPackages() å‡½æ•°å®Œæ•´æµç¨‹

**æ–‡ä»¶ä½ç½®ï¼š** `src/lib/questionDb.ts:1478-1900`

**æµç¨‹æ­¥éª¤ï¼š**

1. **ä»æ•°æ®åº“è¯»å–æ‰€æœ‰é¢˜ç›®** (1513-1517è¡Œ)
```typescript
const allDbQuestions = await db
  .selectFrom("questions")
  .selectAll()
  .orderBy("id", "asc")
  .execute();
```
- ä½¿ç”¨ `selectAll()` è¯»å–æ‰€æœ‰å­—æ®µ
- æŒ‰ `id` å‡åºæ’åº
- **æ²¡æœ‰WHEREæ¡ä»¶ï¼Œç†è®ºä¸Šåº”è¯¥è¯»å–æ‰€æœ‰é¢˜ç›®**

2. **è½¬æ¢ä¸ºå‰ç«¯æ ¼å¼** (1522-1553è¡Œ)
```typescript
const questionsWithHash = allDbQuestions.map((q) => {
  return {
    id: q.id,
    type: q.type,
    content: q.content,  // ä¿æŒåŸæ ¼å¼ï¼ˆå­—ç¬¦ä¸²æˆ–å¤šè¯­è¨€å¯¹è±¡ï¼‰
    options: Array.isArray(q.options) ? q.options : (q.options ? [q.options] : undefined),
    correctAnswer: normalizeCorrectAnswer(q.correct_answer, q.type),
    image: q.image || undefined,  // âœ… imageå­—æ®µè¢«åŒ…å«
    explanation: q.explanation || undefined,
    category: q.category || ...,
    hash: q.content_hash,  // ä½¿ç”¨æ•°æ®åº“ä¸­çš„content_hash
    license_tags: q.license_type_tag || undefined,
    stage_tag: q.stage_tag || undefined,
    topic_tags: q.topic_tags || undefined,
  };
});
```
- **å…³é”®ç‚¹ï¼š** `image: q.image || undefined` - imageå­—æ®µä¼šè¢«åŒ…å«
- **å…³é”®ç‚¹ï¼š** ä½¿ç”¨ `q.content_hash` ä½œä¸ºhashï¼Œä¸é‡æ–°è®¡ç®—
- **æ½œåœ¨é—®é¢˜ï¼š** å¦‚æœ `q.content_hash` ä¸º `null` æˆ–ç©ºï¼Œé¢˜ç›®å¯èƒ½åœ¨æŸäº›é€»è¾‘ä¸­è¢«è¿‡æ»¤

3. **è·å–AIå›ç­”** (1555-1608è¡Œ)
- ä½¿ç”¨ `questionHashes` æ‰¹é‡æŸ¥è¯¢AIå›ç­”
- **æ³¨æ„ï¼š** `questionHashes` æ˜¯é€šè¿‡ `filter((hash): hash is string => !!hash)` è¿‡æ»¤çš„
- **æ½œåœ¨é—®é¢˜ï¼š** å¦‚æœé¢˜ç›®çš„ `content_hash` ä¸ºç©ºï¼Œè¯¥é¢˜ç›®ä¸ä¼šè¢«åŒ…å«åœ¨ `questionHashes` ä¸­ï¼Œä½†é¢˜ç›®æœ¬èº«ä»ä¼šè¢«åŒ…å«åœ¨ `questionsWithHash` ä¸­

4. **ç”Ÿæˆå¤šè¯­è¨€åŒ…** (1752-1812è¡Œ)
```typescript
const localized = questionsWithHash.map((q) => {
  const localizedQ: any = { ...q };  // âœ… ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬imageï¼‰
  
  // åªå¤„ç†contentå’Œexplanationå­—æ®µçš„å¤šè¯­è¨€æå–
  // ... contentå¤„ç†é€»è¾‘ ...
  // ... explanationå¤„ç†é€»è¾‘ ...
  
  return localizedQ;
});
```
- **å…³é”®ç‚¹ï¼š** `{ ...q }` ä¼šåŒ…å«æ‰€æœ‰åŸå§‹å­—æ®µï¼ŒåŒ…æ‹¬ `image`
- **å…³é”®ç‚¹ï¼š** åªå¯¹ `content` å’Œ `explanation` è¿›è¡Œå¤šè¯­è¨€æå–ï¼Œå…¶ä»–å­—æ®µï¼ˆåŒ…æ‹¬ `image`ï¼‰ä¿æŒä¸å˜
- **ç»“è®ºï¼š** `image` å­—æ®µåº”è¯¥ä¼šè¢«æ­£ç¡®åŒ…å«åœ¨å¤šè¯­è¨€åŒ…ä¸­

5. **ä¿å­˜åˆ°æ•°æ®åº“å’Œæ–‡ä»¶** (1814-1852è¡Œ)
```typescript
await saveUnifiedVersion(version, ..., newPackageContent);
await saveQuestionFile("__unified__", {
  questions: questionsWithHash,
  version,
  aiAnswers,
  questionsByLocale,  // åŒ…å«å¤šè¯­è¨€åŒ…
  aiAnswersByLocale,
});
```

### 4.2 å‰å°åŠ è½½JSONåŒ…çš„æµç¨‹

**æ–‡ä»¶ä½ç½®ï¼š** `src/lib/questionsLoader.ts`

**æµç¨‹æ­¥éª¤ï¼š**

1. **loadUnifiedQuestionsPackage()** (274-317è¡Œ)
   - ä¼˜å…ˆä»localStorageè¯»å–ç¼“å­˜
   - å¦‚æœæ²¡æœ‰ç¼“å­˜ï¼Œä»æœåŠ¡å™¨åŠ è½½ï¼ˆ`/api/questions/package`ï¼‰

2. **å‰å°ä½¿ç”¨é¢˜ç›®æ•°æ®** (ä»¥ `src/app/study/exam/page.tsx` ä¸ºä¾‹)
```typescript
const pkg = await loadUnifiedQuestionsPackage();
// ä¼˜å…ˆä½¿ç”¨å½“å‰è¯­è¨€çš„å¤šè¯­è¨€åŒ…
let allQuestions: any[] = [];
if (pkg?.questionsByLocale && pkg.questionsByLocale[language]) {
  allQuestions = pkg.questionsByLocale[language];  // ä½¿ç”¨å¤šè¯­è¨€åŒ…
} else {
  allQuestions = pkg?.questions || [];  // ä½¿ç”¨é»˜è®¤questions
}
```

3. **æ¸²æŸ“å›¾ç‰‡** (894-929è¡Œ)
```typescript
const imageUrl = currentQuestion.image;
const isValid = isValidImageUrl(imageUrl);
if (isValid) {
  return <QuestionImage src={imageUrl!} ... />;
}
```

### 4.3 å›¾ç‰‡URLéªŒè¯é€»è¾‘

**æ–‡ä»¶ä½ç½®ï¼š** `src/lib/imageUtils.ts:11-70`

**éªŒè¯è§„åˆ™ï¼š**
- URLä¸èƒ½ä¸º `null` æˆ– `undefined`
- URLå¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹
- å»é™¤ç©ºç™½åä¸èƒ½ä¸ºç©ºå­—ç¬¦ä¸²
- å¿…é¡»ä»¥ `http://`ã€`https://` æˆ– `/` å¼€å¤´

**æ½œåœ¨é—®é¢˜ï¼š**
- å¦‚æœ `image` å­—æ®µæ˜¯ç©ºå­—ç¬¦ä¸² `""`ï¼Œä¼šè¢«è¿‡æ»¤
- å¦‚æœ `image` å­—æ®µä¸æ˜¯ä»¥ `http://`ã€`https://` æˆ– `/` å¼€å¤´ï¼Œä¼šè¢«è¿‡æ»¤

## ğŸ“Œ ç¬¬ä¸ƒéƒ¨åˆ†ï¼šé¢˜ç›®1323æ•°æ®çŠ¶æ€æ£€æŸ¥

### 5.1 æ•°æ®åº“ä¸­çš„é¢˜ç›®1323

**éœ€è¦æ£€æŸ¥çš„å­—æ®µï¼š**
- `id`: 1323
- `content_hash`: æ˜¯å¦ä¸ºç©ºæˆ–nullï¼Ÿ
- `content`: æ˜¯å¦ä¸ºç©ºæˆ–æ ¼å¼å¼‚å¸¸ï¼Ÿ
- `image`: å€¼æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯å¦ä¸ºç©ºï¼Ÿ
- `type`: é¢˜ç›®ç±»å‹
- `category`: å·ç±»
- å…¶ä»–å­—æ®µ

### 5.2 JSONåŒ…ä¸­çš„é¢˜ç›®1323

**éœ€è¦æ£€æŸ¥ï¼š**
- åœ¨ `questions` æ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨ `id === 1323` çš„é¢˜ç›®ï¼Ÿ
- å¦‚æœå­˜åœ¨ï¼Œè¯¥é¢˜ç›®çš„ `image` å­—æ®µå€¼æ˜¯ä»€ä¹ˆï¼Ÿ
- åœ¨ `questionsByLocale` ä¸­ï¼Œå„è¯­è¨€åŒ…ä¸­æ˜¯å¦å­˜åœ¨è¯¥é¢˜ç›®ï¼Ÿ
- å¦‚æœå­˜åœ¨ï¼Œè¯¥é¢˜ç›®çš„ `image` å­—æ®µå€¼æ˜¯ä»€ä¹ˆï¼Ÿ

### 5.3 å¯èƒ½çš„æ•°æ®ä¸ä¸€è‡´æƒ…å†µ

**æƒ…å†µ1ï¼šé¢˜ç›®å®Œå…¨ä¸¢å¤±**
- æ•°æ®åº“ä¸­æœ‰ï¼ŒJSONåŒ…ä¸­æ²¡æœ‰
- å¯èƒ½åŸå› ï¼š
  - `content_hash` ä¸ºç©ºï¼Œå¯¼è‡´æŸäº›é€»è¾‘è¿‡æ»¤
  - è½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ä½†æœªæŠ›å‡º
  - ä¿å­˜æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯

**æƒ…å†µ2ï¼šé¢˜ç›®å­˜åœ¨ä½†imageå­—æ®µä¸¢å¤±**
- æ•°æ®åº“ä¸­æœ‰ `image`ï¼ŒJSONåŒ…ä¸­æ²¡æœ‰
- å¯èƒ½åŸå› ï¼š
  - è½¬æ¢æ—¶ `q.image` ä¸º `null`ï¼Œè¢«è½¬æ¢ä¸º `undefined`ï¼ŒJSONåºåˆ—åŒ–æ—¶è¢«çœç•¥
  - å¤šè¯­è¨€åŒ…ç”Ÿæˆæ—¶ä¸¢å¤±ï¼ˆä½†ä»£ç æ˜¾ç¤ºåº”è¯¥ä¿ç•™ï¼‰

**æƒ…å†µ3ï¼šé¢˜ç›®å’Œimageéƒ½å­˜åœ¨ï¼Œä½†å‰å°æ— æ³•è·å–**
- JSONåŒ…ä¸­æœ‰é¢˜ç›®å’Œimageï¼Œä½†å‰å°æ— æ³•æ˜¾ç¤º
- å¯èƒ½åŸå› ï¼š
  - ä½¿ç”¨äº†å¤šè¯­è¨€åŒ…ï¼Œä½†å¤šè¯­è¨€åŒ…ä¸­imageä¸¢å¤±
  - `isValidImageUrl()` éªŒè¯å¤±è´¥
  - å‰å°è¯»å–é€»è¾‘æœ‰é—®é¢˜

## ğŸ“Œ ç¬¬å…«éƒ¨åˆ†ï¼šå¯èƒ½çš„åŸå› åˆ†æï¼ˆRoot Cause Hypothesisï¼‰

### é—®é¢˜1ï¼šé¢˜ç›®1323åœ¨JSONåŒ…ä¸­ä¸¢å¤±

**å¯èƒ½åŸå› 1ï¼šcontent_hashä¸ºç©ºæˆ–nullï¼ˆæœ€å¯èƒ½ï¼‰**
- **å…³é”®å‘ç°ï¼š** åœ¨ `updateAllJsonPackages()` å‡½æ•°ä¸­ï¼Œè™½ç„¶ä½¿ç”¨ `selectAll()` è¯»å–æ‰€æœ‰é¢˜ç›®ï¼Œä½†åœ¨è·å–AIå›ç­”æ—¶ï¼ˆ1559-1561è¡Œï¼‰ä½¿ç”¨äº†è¿‡æ»¤ï¼š
  ```typescript
  const questionHashes = questionsWithHash
    .map((q) => (q as any).hash)
    .filter((hash): hash is string => !!hash);
  ```
- å¦‚æœé¢˜ç›®çš„ `content_hash` ä¸ºç©ºæˆ–nullï¼Œè™½ç„¶é¢˜ç›®æœ¬èº«ä¼šè¢«åŒ…å«åœ¨ `questionsWithHash` ä¸­ï¼Œä½†å¯èƒ½åœ¨æŸäº›é€»è¾‘ä¸­è¢«ç‰¹æ®Šå¤„ç†
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥æ•°æ®åº“ä¸­é¢˜ç›®1323çš„ `content_hash` å­—æ®µæ˜¯å¦ä¸º `null` æˆ–ç©ºå­—ç¬¦ä¸²

**å¯èƒ½åŸå› 1.1ï¼šcontentå­—æ®µä¸ºç©ºæˆ–æ ¼å¼å¼‚å¸¸**
- å¦‚æœ `content` å­—æ®µä¸ºç©ºæˆ–æ ¼å¼å¼‚å¸¸ï¼Œå¯èƒ½åœ¨è½¬æ¢æ—¶è¢«è¿‡æ»¤
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥æ•°æ®åº“ä¸­é¢˜ç›®1323çš„ `content` å­—æ®µ

**å¯èƒ½åŸå› 2ï¼šè½¬æ¢è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯**
- åœ¨ `map()` è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸ªé¢˜ç›®è½¬æ¢å¤±è´¥ï¼Œå¯èƒ½å¯¼è‡´è¯¥é¢˜ç›®ä¸¢å¤±
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

**å¯èƒ½åŸå› 3ï¼šä¿å­˜æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯**
- `saveQuestionFile()` å¯èƒ½å‘ç”Ÿé”™è¯¯ä½†è¢«æ•è·ï¼Œå¯¼è‡´éƒ¨åˆ†é¢˜ç›®æœªä¿å­˜
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥ä¿å­˜æ—¶çš„é”™è¯¯æ—¥å¿—

**å¯èƒ½åŸå› 4ï¼šJSONåºåˆ—åŒ–é—®é¢˜**
- å¦‚æœé¢˜ç›®å¯¹è±¡åŒ…å«æ— æ³•åºåˆ—åŒ–çš„æ•°æ®ï¼Œå¯èƒ½åœ¨ `JSON.stringify()` æ—¶è¢«è·³è¿‡
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥é¢˜ç›®1323çš„æ•°æ®ç±»å‹

### é—®é¢˜2ï¼šé¢˜ç›®1323å›¾ç‰‡URLè·å–å¤±è´¥

**å¯èƒ½åŸå› 1ï¼šimageå­—æ®µåœ¨è½¬æ¢æ—¶ä¸¢å¤±ï¼ˆæœ€å¯èƒ½ï¼‰**
- **å…³é”®å‘ç°ï¼š** åœ¨ `updateAllJsonPackages()` å‡½æ•°ä¸­ï¼ˆ1545è¡Œï¼‰ï¼Œä½¿ç”¨äº† `image: q.image || undefined`
- å¦‚æœæ•°æ®åº“ä¸­çš„ `q.image` ä¸º `null` æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œä¼šè¢«è½¬æ¢ä¸º `undefined`
- **JSONåºåˆ—åŒ–ç‰¹æ€§ï¼š** `JSON.stringify()` ä¼šçœç•¥å€¼ä¸º `undefined` çš„å­—æ®µ
- **ç»“æœï¼š** å³ä½¿æ•°æ®åº“ä¸­æœ‰ `image` å­—æ®µï¼ˆå€¼ä¸º `null`ï¼‰ï¼ŒJSONåŒ…ä¸­ä¹Ÿä¸ä¼šåŒ…å«è¯¥å­—æ®µ
- **éªŒè¯æ–¹æ³•ï¼š** 
  - æ£€æŸ¥æ•°æ®åº“ä¸­é¢˜ç›®1323çš„ `image` å­—æ®µå€¼
  - æ£€æŸ¥JSONåŒ…ä¸­é¢˜ç›®1323æ˜¯å¦æœ‰ `image` å­—æ®µ
  - å¦‚æœæ•°æ®åº“ä¸­æ˜¯ `null` ä½†JSONåŒ…ä¸­æ²¡æœ‰å­—æ®µï¼Œåˆ™ç¡®è®¤æ­¤é—®é¢˜

**å¯èƒ½åŸå› 2ï¼šå¤šè¯­è¨€åŒ…ä¸­imageå­—æ®µä¸¢å¤±**
- è™½ç„¶ä»£ç ä½¿ç”¨ `{ ...q }` åº”è¯¥ä¿ç•™æ‰€æœ‰å­—æ®µï¼Œä½†å¯èƒ½å­˜åœ¨å…¶ä»–é€»è¾‘
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥ `questionsByLocale` ä¸­é¢˜ç›®1323çš„ `image` å­—æ®µ

**å¯èƒ½åŸå› 3ï¼šisValidImageUrl()éªŒè¯å¤±è´¥**
- å¦‚æœ `image` URLæ ¼å¼ä¸ç¬¦åˆè¦æ±‚ï¼Œä¼šè¢«è¿‡æ»¤
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥é¢˜ç›®1323çš„ `image` URLæ ¼å¼

**å¯èƒ½åŸå› 4ï¼šå‰å°ä½¿ç”¨äº†å¤šè¯­è¨€åŒ…ï¼Œä½†å¤šè¯­è¨€åŒ…ä¸­imageä¸¢å¤±**
- å¦‚æœå‰å°ä½¿ç”¨ `questionsByLocale[language]`ï¼Œè€Œè¯¥è¯­è¨€åŒ…ä¸­imageä¸¢å¤±
- **éªŒè¯æ–¹æ³•ï¼š** æ£€æŸ¥å‰å°å®é™…ä½¿ç”¨çš„æ•°æ®æº

## ğŸ“Œ ç¬¬ä¹éƒ¨åˆ†ï¼šä»£ç å®šä½ï¼ˆCode Snapshotï¼‰

### 7.1 ç›¸å…³æ–‡ä»¶åˆ—è¡¨

1. **æ›´æ–°JSONåŒ…æ ¸å¿ƒé€»è¾‘**
   - `src/lib/questionDb.ts` (1478-1900è¡Œ) - `updateAllJsonPackages()` å‡½æ•°
   - `src/lib/questionDb.ts` (887-987è¡Œ) - `saveQuestionFile()` å‡½æ•°
   - `src/lib/questionDb.ts` (1182-1283è¡Œ) - `saveUnifiedVersion()` å‡½æ•°

2. **APIè·¯ç”±**
   - `src/app/api/admin/questions/update-package/route.ts` - GUIæ›´æ–°æ¥å£
   - `src/app/api/questions/package/route.ts` - å‰å°è·å–JSONåŒ…æ¥å£

3. **å‰å°åŠ è½½é€»è¾‘**
   - `src/lib/questionsLoader.ts` - åŠ è½½JSONåŒ…çš„ç»Ÿä¸€å…¥å£
   - `src/app/study/exam/page.tsx` - è€ƒè¯•æ¨¡å¼é¡µé¢
   - `src/app/study/learn/page.tsx` - å­¦ä¹ æ¨¡å¼é¡µé¢

4. **å›¾ç‰‡æ¸²æŸ“é€»è¾‘**
   - `src/lib/imageUtils.ts` - `isValidImageUrl()` å‡½æ•°
   - `src/components/common/QuestionImage.tsx` - å›¾ç‰‡ç»„ä»¶

5. **å‘½ä»¤è¡Œè„šæœ¬**
   - `scripts/update-json-package-with-version.ts` - å‘½ä»¤è¡Œæ›´æ–°è„šæœ¬

### 7.2 å…³é”®ä»£ç ç‰‡æ®µ

**ä»£ç ç‰‡æ®µ1ï¼šé¢˜ç›®è½¬æ¢é€»è¾‘ï¼ˆimageå­—æ®µå¯èƒ½ä¸¢å¤±ï¼‰**
```typescript:1522:1553:src/lib/questionDb.ts
const questionsWithHash = allDbQuestions.map((q) => {
  return {
    id: q.id,
    type: q.type,
    content: q.content,
    options: Array.isArray(q.options) ? q.options : (q.options ? [q.options] : undefined),
    correctAnswer: normalizeCorrectAnswer(q.correct_answer, q.type),
    image: q.image || undefined,  // âš ï¸ å¦‚æœq.imageä¸ºnullï¼Œä¼šè½¬æ¢ä¸ºundefinedï¼ŒJSONåºåˆ—åŒ–æ—¶ä¼šè¢«çœç•¥
    explanation: q.explanation || undefined,
    category: q.category || ...,
    hash: q.content_hash,
    // ...
  };
});
```

**å…³é”®é—®é¢˜ï¼š**
- `q.image || undefined` çš„é€»è¾‘ï¼šå¦‚æœ `q.image` ä¸º `null`ã€`undefined` æˆ–ç©ºå­—ç¬¦ä¸²ï¼Œéƒ½ä¼šè½¬æ¢ä¸º `undefined`
- `JSON.stringify()` ä¼šçœç•¥å€¼ä¸º `undefined` çš„å­—æ®µ
- **ç»“æœï¼š** å¦‚æœæ•°æ®åº“ä¸­ `image` å­—æ®µä¸º `null`ï¼ŒJSONåŒ…ä¸­å°†ä¸åŒ…å« `image` å­—æ®µ

**ä»£ç ç‰‡æ®µ2ï¼šå¤šè¯­è¨€åŒ…ç”Ÿæˆï¼ˆåº”è¯¥ä¿ç•™imageå­—æ®µï¼‰**
```typescript:1761:1810:src/lib/questionDb.ts
const localized = questionsWithHash.map((q) => {
  const localizedQ: any = { ...q };  // âœ… ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦ï¼ŒåŒ…å«æ‰€æœ‰å­—æ®µï¼ˆåŒ…æ‹¬imageï¼‰
  
  // åªå¤„ç†contentå’Œexplanationå­—æ®µçš„å¤šè¯­è¨€æå–
  // ... contentå¤„ç†é€»è¾‘ ...
  // ... explanationå¤„ç†é€»è¾‘ ...
  
  return localizedQ;  // imageå­—æ®µåº”è¯¥è¢«ä¿ç•™
});
```

**ä»£ç ç‰‡æ®µ3ï¼šå‰å°å›¾ç‰‡æ¸²æŸ“é€»è¾‘**
```typescript:894:929:src/app/study/exam/page.tsx
const imageUrl = currentQuestion.image;
const isValid = isValidImageUrl(imageUrl);
if (isValid) {
  return <QuestionImage src={imageUrl!} ... />;
}
```

**ä»£ç ç‰‡æ®µ4ï¼šå›¾ç‰‡URLéªŒè¯é€»è¾‘**
```typescript:11:70:src/lib/imageUtils.ts
export function isValidImageUrl(url: string | null | undefined): boolean {
  if (url === null || url === undefined) return false;
  if (typeof url !== 'string') return false;
  const trimmed = url.trim();
  if (trimmed.length === 0) return false;
  const lowerTrimmed = trimmed.toLowerCase();
  return (
    lowerTrimmed.startsWith('http://') ||
    lowerTrimmed.startsWith('https://') ||
    trimmed.startsWith('/')
  );
}
```

## ğŸ“Œ ç¬¬åéƒ¨åˆ†ï¼šé…ç½®ä¸ç¯å¢ƒï¼ˆConfig & Envï¼‰

### 8.1 æ•°æ®åº“é…ç½®
- æ•°æ®åº“ç±»å‹ï¼šPostgreSQL
- è¡¨åï¼š`questions`
- å…³é”®å­—æ®µï¼š`id`, `content_hash`, `content`, `image`, `category`

### 8.2 JSONåŒ…å­˜å‚¨ä½ç½®
- æ–‡ä»¶è·¯å¾„ï¼š`src/data/questions/zh/questions.json`
- æ•°æ®åº“å¤‡ä»½ï¼š`question_package_versions.package_content` (JSONBå­—æ®µ)

### 8.3 å‰å°ç¼“å­˜æœºåˆ¶
- localStorageé”®åï¼š`dq_questions_package_v_{version}`
- ç‰ˆæœ¬å·é”®åï¼š`dq_questions_package_current_version`
- ç¼“å­˜ç­–ç•¥ï¼šä¼˜å…ˆä½¿ç”¨æœ¬åœ°ç¼“å­˜ï¼Œåå°å¼‚æ­¥æ£€æŸ¥æ›´æ–°

## ğŸ“Œ ç¬¬åä¸€éƒ¨åˆ†ï¼šé—®é¢˜å½±å“èŒƒå›´ï¼ˆImpact Analysisï¼‰

### å½±å“æ¨¡å—
- âœ… **é¢˜ç›®ç®¡ç†æ¨¡å—**ï¼šåå°æ›´æ–°JSONåŒ…åŠŸèƒ½
- âœ… **å‰å°å­¦ä¹ /è€ƒè¯•æ¨¡å—**ï¼šç”¨æˆ·æ— æ³•çœ‹åˆ°é¢˜ç›®1323åŠå…¶å›¾ç‰‡
- âœ… **æ•°æ®ä¸€è‡´æ€§**ï¼šæ•°æ®åº“å’ŒJSONåŒ…ä¸ä¸€è‡´

### å½±å“ç”¨æˆ·
- âœ… **æ™®é€šç”¨æˆ·**ï¼šæ— æ³•çœ‹åˆ°é¢˜ç›®1323ï¼Œå½±å“å­¦ä¹ ä½“éªŒ
- âœ… **ç®¡ç†å‘˜**ï¼šæ•°æ®ä¸ä¸€è‡´ï¼Œå¯èƒ½å¯¼è‡´ç®¡ç†å›°æƒ‘

### å½±å“ç”Ÿäº§ç¯å¢ƒ
- âœ… **æ˜¯**ï¼šå¦‚æœé¢˜ç›®1323æ˜¯é‡è¦é¢˜ç›®ï¼Œä¼šå½±å“ç”¨æˆ·ä½“éªŒ

### æ˜¯å¦å½±å“æ ¸å¿ƒé€»è¾‘
- âœ… **æ˜¯**ï¼šé¢˜ç›®æ•°æ®æ˜¯æ ¸å¿ƒæ•°æ®ï¼Œæ•°æ®ä¸ä¸€è‡´ä¼šå½±å“ç³»ç»ŸåŠŸèƒ½

### æ˜¯å¦éœ€ç´§æ€¥ä¿®å¤
- âš ï¸ **å»ºè®®å°½å¿«ä¿®å¤**ï¼šæ•°æ®ä¸ä¸€è‡´é—®é¢˜éœ€è¦åŠæ—¶è§£å†³

## ğŸ“Œ ç¬¬åäºŒéƒ¨åˆ†ï¼šå»ºè®®ä¿®å¤æ–¹å‘ï¼ˆSuggested Fixesï¼‰

### ä¿®å¤æ–¹æ¡ˆAï¼ˆæ¨èï¼‰ï¼šå…¨é¢è¯Šæ–­ + ä¿®å¤

1. **è¯Šæ–­æ­¥éª¤ï¼š**
   - æŸ¥è¯¢æ•°æ®åº“ï¼Œæ£€æŸ¥é¢˜ç›®1323çš„å®Œæ•´æ•°æ®ï¼ˆç‰¹åˆ«æ˜¯ `content_hash` å’Œ `image` å­—æ®µï¼‰
   - æ£€æŸ¥JSONåŒ…ä¸­æ˜¯å¦å­˜åœ¨é¢˜ç›®1323
   - å¦‚æœå­˜åœ¨ï¼Œæ£€æŸ¥ `image` å­—æ®µå€¼
   - æ£€æŸ¥å¤šè¯­è¨€åŒ…ä¸­é¢˜ç›®1323çš„ `image` å­—æ®µ

2. **ä¿®å¤æªæ–½ï¼š**
   - å¦‚æœé¢˜ç›®ä¸¢å¤±ï¼šæ£€æŸ¥è½¬æ¢é€»è¾‘ï¼Œç¡®ä¿æ‰€æœ‰é¢˜ç›®éƒ½è¢«åŒ…å«
   - å¦‚æœimageä¸¢å¤±ï¼šä¿®å¤è½¬æ¢é€»è¾‘ï¼Œç¡®ä¿ `image` å­—æ®µè¢«æ­£ç¡®åŒ…å«
   - å¦‚æœimageæ ¼å¼é—®é¢˜ï¼šä¿®å¤ `isValidImageUrl()` éªŒè¯é€»è¾‘æˆ–æ•°æ®æ ¼å¼

3. **éªŒè¯æªæ–½ï¼š**
   - æ›´æ–°JSONåŒ…åï¼ŒéªŒè¯é¢˜ç›®1323æ˜¯å¦å­˜åœ¨
   - éªŒè¯é¢˜ç›®1323çš„ `image` å­—æ®µæ˜¯å¦æ­£ç¡®
   - åœ¨å‰å°éªŒè¯å›¾ç‰‡æ˜¯å¦èƒ½æ­£å¸¸æ˜¾ç¤º

### ä¿®å¤æ–¹æ¡ˆBï¼ˆå¿«é€Ÿä¿®å¤ï¼‰ï¼šå¼ºåˆ¶åŒ…å«imageå­—æ®µ

1. **ä¿®æ”¹è½¬æ¢é€»è¾‘ï¼š**
   - ç¡®ä¿ `image` å­—æ®µå³ä½¿ä¸º `null` ä¹ŸåŒ…å«åœ¨JSONä¸­ï¼ˆä½¿ç”¨ `null` è€Œä¸æ˜¯ `undefined`ï¼‰
   - åœ¨å¤šè¯­è¨€åŒ…ç”Ÿæˆæ—¶ï¼Œæ˜ç¡®ä¿ç•™ `image` å­—æ®µ

2. **ä¿®æ”¹éªŒè¯é€»è¾‘ï¼š**
   - æ”¾å®½ `isValidImageUrl()` çš„éªŒè¯æ¡ä»¶ï¼ˆå¦‚æœéœ€è¦ï¼‰

### ä¿®å¤æ–¹æ¡ˆCï¼ˆç»“æ„æ€§æ”¹è¿›ï¼‰ï¼šå¢å¼ºæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

1. **æ·»åŠ éªŒè¯æœºåˆ¶ï¼š**
   - æ›´æ–°JSONåŒ…åï¼ŒéªŒè¯æ•°æ®åº“å’ŒJSONåŒ…çš„é¢˜ç›®æ•°é‡æ˜¯å¦ä¸€è‡´
   - éªŒè¯å…³é”®å­—æ®µï¼ˆå¦‚ `image`ï¼‰æ˜¯å¦ä¸€è‡´
   - æ·»åŠ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š

2. **æ”¹è¿›é”™è¯¯å¤„ç†ï¼š**
   - åœ¨è½¬æ¢è¿‡ç¨‹ä¸­æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—
   - å¦‚æœæŸä¸ªé¢˜ç›®è½¬æ¢å¤±è´¥ï¼Œè®°å½•é”™è¯¯ä½†ä¸ä¸­æ–­æ•´ä¸ªæµç¨‹

## ğŸ“Œ ç¬¬åä¸‰éƒ¨åˆ†ï¼šéœ€è¦å†³ç­–çš„ç‚¹ï¼ˆDecision Neededï¼‰

### éœ€è¦ç¡®è®¤çš„é—®é¢˜

1. **é¢˜ç›®1323çš„å…·ä½“æ•°æ®çŠ¶æ€ï¼š**
   - æ•°æ®åº“ä¸­çš„ `content_hash` å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
   - æ•°æ®åº“ä¸­çš„ `image` å€¼æ˜¯ä»€ä¹ˆï¼Ÿ
   - JSONåŒ…ä¸­æ˜¯å¦å­˜åœ¨é¢˜ç›®1323ï¼Ÿ
   - å¦‚æœå­˜åœ¨ï¼Œ`image` å­—æ®µå€¼æ˜¯ä»€ä¹ˆï¼Ÿ

2. **ä¿®å¤ä¼˜å…ˆçº§ï¼š**
   - æ˜¯å¦éœ€è¦ç«‹å³ä¿®å¤ï¼Ÿ
   - æ˜¯å¦å¯ä»¥æ¥å—ä¸´æ—¶æ–¹æ¡ˆï¼Ÿ

3. **ä¿®å¤èŒƒå›´ï¼š**
   - åªä¿®å¤é¢˜ç›®1323ï¼Œè¿˜æ˜¯å…¨é¢æ£€æŸ¥æ‰€æœ‰é¢˜ç›®ï¼Ÿ
   - æ˜¯å¦éœ€è¦æ·»åŠ æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥æœºåˆ¶ï¼Ÿ

## ğŸ“Œ ç¬¬åå››éƒ¨åˆ†ï¼šé™„å½•ï¼ˆAttachmentsï¼‰

### ä¹‹å‰é‡‡å–è¿‡çš„æªæ–½è¯¦æƒ…

**N/A** - è¿™æ˜¯é¦–æ¬¡æŠ¥å‘Šæ­¤é—®é¢˜ï¼Œä¹‹å‰æœªé‡‡å–è¿‡ä¿®å¤æªæ–½ã€‚

### ç›¸å…³æ—¥å¿—ä¿¡æ¯

**éœ€è¦æ”¶é›†çš„æ—¥å¿—ï¼š**
1. æ›´æ–°JSONåŒ…æ—¶çš„æœåŠ¡å™¨æ—¥å¿—
2. å‰å°åŠ è½½JSONåŒ…æ—¶çš„æµè§ˆå™¨æ§åˆ¶å°æ—¥å¿—
3. å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶çš„é”™è¯¯æ—¥å¿—

**æ—¥å¿—ä½ç½®ï¼š**
- æœåŠ¡å™¨æ—¥å¿—ï¼šæ£€æŸ¥ `[updateAllJsonPackages]` ç›¸å…³æ—¥å¿—
- å‰ç«¯æ—¥å¿—ï¼šæµè§ˆå™¨æ§åˆ¶å°ä¸­çš„ `[ExamMode]`ã€`[StudyMode]`ã€`[QuestionImage]` ç›¸å…³æ—¥å¿—

### ç›¸å…³ä»£ç æ–‡ä»¶

1. **æ ¸å¿ƒæ›´æ–°é€»è¾‘**
   - `src/lib/questionDb.ts` - `updateAllJsonPackages()` å‡½æ•°
   - `src/lib/questionDb.ts` - `saveQuestionFile()` å‡½æ•°

2. **å‰å°åŠ è½½é€»è¾‘**
   - `src/lib/questionsLoader.ts` - `loadUnifiedQuestionsPackage()` å‡½æ•°
   - `src/app/study/exam/page.tsx` - è€ƒè¯•æ¨¡å¼é¡µé¢

3. **å›¾ç‰‡æ¸²æŸ“é€»è¾‘**
   - `src/lib/imageUtils.ts` - `isValidImageUrl()` å‡½æ•°
   - `src/components/common/QuestionImage.tsx` - å›¾ç‰‡ç»„ä»¶

### æ•°æ®åº“æŸ¥è¯¢å»ºè®®

```sql
-- æ£€æŸ¥é¢˜ç›®1323çš„å®Œæ•´æ•°æ®
SELECT 
  id, 
  content_hash, 
  type, 
  content, 
  image, 
  category, 
  license_type_tag, 
  stage_tag, 
  topic_tags,
  created_at,
  updated_at
FROM questions 
WHERE id = 1323;

-- æ£€æŸ¥content_hashä¸ºç©ºçš„é¢˜ç›®æ•°é‡
SELECT COUNT(*) 
FROM questions 
WHERE content_hash IS NULL OR content_hash = '';

-- æ£€æŸ¥imageå­—æ®µä¸ºç©ºçš„é¢˜ç›®æ•°é‡
SELECT COUNT(*) 
FROM questions 
WHERE image IS NULL OR image = '';
```

### JSONåŒ…æ£€æŸ¥å»ºè®®

1. æ£€æŸ¥ `src/data/questions/zh/questions.json` æ–‡ä»¶
2. æœç´¢ `"id": 1323` æ˜¯å¦å­˜åœ¨
3. å¦‚æœå­˜åœ¨ï¼Œæ£€æŸ¥è¯¥é¢˜ç›®çš„ `image` å­—æ®µ

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´ï¼š** 2025-12-01
**æŠ¥å‘Šç‰ˆæœ¬ï¼š** v1.0

