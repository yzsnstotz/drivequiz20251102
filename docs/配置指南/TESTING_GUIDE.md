# 题目管理功能测试指南

## 快速测试步骤

### 1️⃣ 测试下载模板功能

1. 访问 http://localhost:3000/admin/questions
2. 点击页面顶部的 **"下载模板"** 按钮
3. ✅ **预期结果**：浏览器应该下载一个名为 `题目导入模板_2025-11-02.xlsx` 的文件
4. ❌ **如果失败**：打开浏览器开发者工具（F12），查看 Console 和 Network 标签页

### 2️⃣ 测试无限滚动加载

#### 准备工作
确保数据库中有超过 20 道题目（如果题目少于 20 道，无限滚动不会触发）

#### 测试步骤
1. 访问 http://localhost:3000/admin/questions
2. 打开浏览器开发者工具（F12）
3. 切换到 **Console** 标签页
4. 向下滚动页面到底部（或接近底部）
5. ✅ **预期结果**：
   - Console 中出现类似这样的日志：
     ```
     [IntersectionObserver] isIntersecting=true, hasMore=true, loadingMore=false, loading=false
     [IntersectionObserver] Triggering loadMore()
     [loadMore] Loading page 2 of 5
     [loadData] page=2, totalPages=5, hasMore=true
     ```
   - 页面底部自动加载第 2 页数据
   - 题目列表增加（从 20 条变成 40 条）
   - 底部显示：`已加载 40 / 100 条 (第 2 / 5 页)`
   
6. 继续滚动，观察是否继续加载第 3、4、5 页
7. 滚动到最后一页时，应显示 **"没有更多数据了"**

#### 调试日志说明

| 日志内容 | 含义 |
|---------|------|
| `[loadData] page=2, totalPages=5, hasMore=true` | 加载第 2 页，共 5 页，还有更多数据 |
| `[loadMore] Loading page 2 of 5` | 正在加载第 2 页 |
| `[IntersectionObserver] isIntersecting=true` | 触发器进入视口，准备加载 |
| `[loadMore] Skipped: ...` | 跳过加载（可能正在加载中或没有更多数据） |

### 3️⃣ 测试批量导入功能

1. 下载模板（参考步骤 1）
2. 打开 Excel 文件，填写几条测试数据：
   
   | 卷类 | 类型 | 题目内容 | 选项A | 选项B | 选项C | 选项D | 正确答案 | 图片URL | 解析 |
   |------|------|---------|-------|-------|-------|-------|---------|---------|------|
   | 免许-1 | single | 这是测试题目 1 | 选项A | 选项B | | | A | | 这是解析 |
   | 免许-1 | multiple | 这是测试题目 2 | 选项A | 选项B | 选项C | | A,B | | 这是解析 |
   | 免许-1 | truefalse | 这是测试题目 3 | | | | | true | | 这是解析 |

3. 保存 Excel 文件
4. 在题目管理页面点击 **"批量导入"** 按钮
5. 选择刚才保存的 Excel 文件
6. ✅ **预期结果**：
   - 页面显示导入结果：
     ```
     导入结果
     成功: 3 条
     失败: 0 条
     ```
   - 题目列表自动刷新，显示新导入的题目
   - 页面底部的总数增加（如：`已加载 20 / 103 条`）

## 常见问题排查

### ❌ 下载模板返回 500 错误

**可能原因**：
- Node.js Runtime 配置未生效
- xlsx 包未安装

**解决方法**：
```bash
# 1. 检查 xlsx 包是否安装
npm list xlsx

# 2. 如果未安装，执行：
npm install xlsx@^0.18.5

# 3. 重启开发服务器
npm run dev
```

### ❌ 无限滚动不触发

**可能原因 1**：题目总数 ≤ 20 条
- 解决方法：导入更多题目，确保总数 > 20

**可能原因 2**：底部触发器未进入视口
- 解决方法：确保页面高度足够，可以向下滚动

**可能原因 3**：JavaScript 错误
- 解决方法：打开 Console，查看是否有错误日志

### ❌ 批量导入失败

**可能原因 1**：Excel 格式错误
- 解决方法：使用下载的模板，不要修改表头

**可能原因 2**：必填字段为空
- 解决方法：确保 `卷类`、`类型`、`题目内容`、`正确答案` 都有值

**可能原因 3**：类型字段值错误
- 解决方法：类型只能是 `single`、`multiple` 或 `truefalse`

## 高级测试

### 测试筛选功能

1. 在 **"卷类"** 下拉框选择特定卷类（如：免许-1）
2. ✅ 预期：只显示该卷类的题目
3. 清空筛选，观察是否恢复显示所有题目

### 测试搜索功能

1. 在 **"搜索内容"** 输入框输入关键词（如：交通）
2. 点击 **"搜索"** 按钮
3. ✅ 预期：只显示包含关键词的题目
4. 点击 **"重置"** 按钮，恢复显示所有题目

### 测试编辑/删除功能

1. 点击任意题目的 **"编辑"** 按钮
2. 修改题目内容
3. 点击 **"更新"** 按钮
4. ✅ 预期：题目更新成功，列表刷新
5. 点击 **"删除"** 按钮
6. 确认删除
7. ✅ 预期：题目删除成功，列表刷新

## 性能测试

### 测试大数据量场景

1. 导入 100+ 题目
2. 测试无限滚动是否流畅
3. 观察加载时间（每页应该在 1 秒内加载完成）

### 测试内存泄漏

1. 连续滚动加载 5-10 页
2. 打开 Chrome DevTools > Memory 标签页
3. 点击 **"Take snapshot"**
4. 观察内存使用情况

## 测试清单

- [ ] ✅ 下载模板成功
- [ ] ✅ 无限滚动加载第 2 页
- [ ] ✅ 无限滚动加载第 3 页
- [ ] ✅ 到达最后一页显示"没有更多数据了"
- [ ] ✅ 批量导入成功
- [ ] ✅ 导入结果统计正确
- [ ] ✅ 筛选功能正常
- [ ] ✅ 搜索功能正常
- [ ] ✅ 编辑题目成功
- [ ] ✅ 删除题目成功
- [ ] ✅ Console 无错误日志
- [ ] ✅ Network 无 5xx 错误

## 联系方式

如果测试过程中遇到任何问题，请：
1. 检查 Console 和 Network 标签页的错误信息
2. 提供完整的错误日志
3. 说明复现步骤

---

**最后更新**: 2025-11-02  
**适用版本**: v1.0.0

