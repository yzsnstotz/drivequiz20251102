# 前台用户端功能板块梳理文档

**文档日期**: 2025年11月  
**版本**: v1.0  
**用途**: 供产品经理了解当前前台功能现状，用于后续调整规划

---

## 📱 一、整体架构

### 1.1 导航结构

前台采用**底部导航栏**设计，包含5个主要入口：

| 入口 | 路由 | 图标 | 说明 |
|------|------|------|------|
| 首页 | `/` | Home | 功能总览和快速入口 |
| 学习 | `/study` | Book | 课程学习模块 |
| 食宿 | `/nearby` | UtensilsCrossed | 食宿信息查询 |
| 汽车 | `/cars` | Truck | 汽车服务信息 |
| 我的 | `/profile` | User | 个人中心和设置 |

### 1.2 页面访问路径

```
首页 (/)
├── 课程学习 (/study) → 答题页面 (/study/*)
├── 模拟考试 (/exam)
├── 错题本 (/mistakes)
├── 大乱斗 (/royalbattle)
├── AI助手 (弹窗)
└── 视频教程 (本免许学试 / 二种免许学试)

我的 (/profile)
├── 错题本 (/mistakes)
├── 考试历史 (内嵌)
├── 做题历史 (内嵌)
└── 清除激活 (功能)
```

---

## 🏠 二、首页模块 (`/`)

### 2.1 核心功能

**页面路径**: `/`  
**主要用途**: 应用入口和功能导航

#### 2.1.1 欢迎横幅轮播
- **位置**: 页面顶部
- **功能**: 
  - 自动轮播（5秒间隔）
  - 手动左右切换
  - 点击跳转外部链接
- **内容**: 
  1. 平台介绍
  2. "大乱斗"挑战赛活动
  3. 志愿者招募计划
  4. 商家入驻计划

#### 2.1.2 主要功能入口（4宫格）
| 功能 | 路由 | 图标颜色 | 说明 |
|------|------|----------|------|
| 课程学习 | `/study` | 蓝色 | 进入学习模块 |
| 模拟考试 | `/exam` | 橙色 | 进入考试模块 |
| 错题本 | `/mistakes` | 红色 | 查看错题 |
| 大乱斗 | `/royalbattle` | 紫色 | 挑战游戏 |

#### 2.1.3 AI助手入口
- **位置**: 顶部导航栏 + 页面中部卡片
- **功能**: 
  - 点击打开AI助手对话界面
  - 支持驾考问题问答
  - 聊天历史本地保存

#### 2.1.4 视频教程区域
- **分类**: 
  - 本免许学试（基础视频）
  - 二种免许学试（进阶视频）
- **显示方式**: 横向滚动卡片
- **数据来源**: `/api/videos` 接口

---

## 📚 三、学习模块 (`/study`)

### 3.1 学习主页

**页面路径**: `/study`  
**主要功能**: 展示课程分类和题目集

#### 3.1.1 课程分类

**分类1: 学科讲习**
- 學科講習-1 (50题)
- 學科講習-2 (50题)
- 學科講習-3 (50题)
- 學科講習-4 (50题)

**分类2: 仮免**
- 仮免-1 (50题)
- 仮免-2 (50题)
- 仮免-3 (50题)
- 仮免-4 (50题)
- 仮免-5 (50题)

**分类3: 免许**
- 免许-1 (50题)
- 免许-2 (50题)
- 免许-3 (50题)
- 免许-4 (50题)
- 免许-5 (50题)
- 免许-6 (50题)

#### 3.1.2 功能特性
- ✅ **进度显示**: 每个题目集显示完成百分比
- ✅ **进度条**: 可视化展示学习进度
- ✅ **本地存储**: 进度保存在 localStorage
- ✅ **点击进入**: 点击题目集进入答题页面

### 3.2 答题页面

**页面路径**: `/study/[题目集]`  
**组件**: `QuestionPage.tsx`

#### 3.2.1 核心功能
- ✅ **题目展示**: 支持单选题、多选题、判断题
- ✅ **图片支持**: 题目可包含图片
- ✅ **答案验证**: 实时显示答案正确性
- ✅ **答案解析**: 显示题目解析
- ✅ **进度追踪**: 
  - 显示当前题目位置 (X/总数)
  - 显示整体进度百分比
  - 显示正确率百分比
- ✅ **题目导航**: 上一题/下一题切换
- ✅ **错题记录**: 答错题目自动保存到错题本
- ✅ **学习历史**: 答题记录保存到练习历史

#### 3.2.2 数据存储
- **进度保存**: `localStorage.progress_[题目集名称]`
- **错题保存**: `localStorage.mistakeBook`
- **历史保存**: `localStorage.practiceHistory` (最近50题)

---

## 📝 四、模拟考试模块 (`/exam`)

### 4.1 考试主页

**页面路径**: `/exam`  
**主要功能**: 选择考试套题

#### 4.1.1 考试套题
- 模拟考试-1 (50题, 60分钟)
- 模拟考试-2 (50题, 60分钟)
- 模拟考试-3 (50题, 60分钟)
- 模拟考试-4 (50题, 60分钟)
- 模拟考试-5 (50题, 60分钟)

### 4.2 考试页面

**页面路径**: `/exam` (考试进行中)

#### 4.2.1 核心功能
- ✅ **倒计时**: 显示剩余时间（分钟:秒）
- ✅ **进度显示**: 显示已答题数/总题数
- ✅ **正确率**: 实时显示当前正确率
- ✅ **题目类型**: 单选题、多选题、判断题
- ✅ **题目导航**: 上一题/下一题
- ✅ **答案选择**: 支持单选和多选
- ✅ **即时反馈**: 选择后立即显示对错
- ✅ **答案解析**: 显示题目解析
- ✅ **自动保存**: 
  - 错题自动加入错题本
  - 答题记录保存到练习历史
  - 考试完成保存到考试历史

#### 4.2.2 数据存储
- **考试历史**: `localStorage.examHistory`
- **错题保存**: `localStorage.mistakeBook`
- **练习历史**: `localStorage.practiceHistory`

---

## ⚔️ 五、大乱斗模块 (`/royalbattle`)

### 5.1 游戏机制

**页面路径**: `/royalbattle`  
**游戏类型**: 限时答题挑战

#### 5.1.1 游戏规则
- **生命值**: 初始5条命
- **初始时间**: 每题20秒
- **时间递减**: 每100分减少2秒，最低3秒
- **得分规则**: 答对+10分
- **失败条件**: 生命值归零或时间耗尽

#### 5.1.2 题目来源
- 从所有题目集随机抽取并打乱
- 包含: 学科讲习、仮免、免许所有题目

#### 5.1.3 界面元素
- **生命值显示**: 5个心形图标
- **分数显示**: 实时分数
- **倒计时**: 精确到小数点后2位
- **进度条**: 时间进度可视化
- **题目类型**: 支持单选、多选、判断题

#### 5.1.4 游戏结束
- 显示最终得分
- 显示答对题目数
- 提供返回首页按钮

---

## ❌ 六、错题本模块 (`/mistakes`)

### 6.1 错题列表

**页面路径**: `/mistakes`  
**主要功能**: 复习答错的题目

#### 6.1.1 核心功能
- ✅ **错题展示**: 列表形式展示所有错题
- ✅ **题目分类**: 显示题目类型（单选/多选/判断）
- ✅ **来源标识**: 显示来自考试或学习
- ✅ **删除功能**: 单个删除或清空全部
- ✅ **点击查看**: 点击进入详情页

#### 6.1.2 错题详情页
- **题目完整展示**: 包括题目、选项、图片
- **正确答案高亮**: 绿色背景标识正确答案
- **答案解析**: 显示题目解析
- **移出错题本**: 删除当前错题

#### 6.1.3 数据来源
- 来自学习模块的错题: `fromStudy: true`
- 来自考试模块的错题: `fromExam: true`
- 存储位置: `localStorage.mistakeBook`

---

## 🍽️ 七、食宿模块 (`/nearby`)

### 7.1 食宿信息页

**页面路径**: `/nearby`  
**主要功能**: 查看附近商家信息

#### 7.1.1 核心功能
- ✅ **商家列表**: 展示商家信息卡片
- ✅ **分类筛选**: 
  - "全部"选项
  - 按商家类型筛选
  - 数据来源: `/api/merchant-categories`
- ✅ **商家信息**: 
  - 商家名称
  - 商家图片
  - 商家描述
  - 地址（带地图图标）
  - 电话（可点击拨打）
  - 邮箱（可点击发送邮件）
  - 商家类型标签

#### 7.1.2 数据接口
- **商家列表**: `/api/merchants`
- **分类列表**: `/api/merchant-categories`
- **筛选参数**: `?category=分类名称`

---

## 🚗 八、汽车模块 (`/cars`)

### 8.1 汽车服务页

**页面路径**: `/cars`  
**主要功能**: 查看汽车相关服务

#### 8.1.1 核心功能
- ✅ **服务列表**: 展示服务商信息卡片
- ✅ **分类筛选**: 
  - 全部
  - 驾校用车
  - 租车
  - 二手车
  - 汽车保养
  - 驾驶培训
- ✅ **排序功能**: 
  - 按距离排序
  - 按评分排序
- ✅ **服务信息**: 
  - 服务商名称
  - 服务商图片
  - 服务类型
  - 距离
  - 评分（星级）
  - 地址
  - 营业时间
  - 价格信息

#### 8.1.2 当前状态
- ⚠️ **注意**: 当前使用示例数据（硬编码）
- ⚠️ **待完善**: 需要对接后端API接口

---

## 👤 九、我的模块 (`/profile`)

### 9.1 个人中心页

**页面路径**: `/profile`  
**主要功能**: 用户信息和学习数据管理

#### 9.1.1 用户信息区域
- **头像**: 默认灰色圆形头像
- **昵称**: 
  - 可编辑（点击昵称编辑）
  - 保存到 `localStorage.user_nickname`
  - 默认值: "User"

#### 9.1.2 功能菜单
| 功能 | 说明 | 路由/操作 |
|------|------|-----------|
| 错题本 | 复习错误的题目 | `/mistakes` |
| 考试历史 | 查看考试成绩记录 | 内嵌滚动 |
| 做题历史 | 查看最近50题记录 | 内嵌滚动 |
| 清除激活 | 清除当前激活状态 | 功能按钮 |
| 设置 | 偏好设置 | 待实现 |

#### 9.1.3 考试历史区域
- **显示内容**: 
  - 最近5次考试记录
  - 考试名称
  - 考试日期
  - 得分（百分比）
  - 正确题数/总题数
- **数据来源**: `localStorage.examHistory`

#### 9.1.4 做题历史区域
- **显示内容**: 
  - 最近20题记录
  - 题目内容（截断显示）
  - 答题日期
  - 正确/错误状态标签
  - 来源标识（考试/学习）
- **数据来源**: `localStorage.practiceHistory`
- **数据限制**: 仅显示最近50题中的20题

---

## 🤖 十、AI助手模块

### 10.1 AI对话页面

**入口**: 首页顶部导航栏 + 首页卡片  
**组件**: `AIPage.tsx`  
**显示方式**: 全屏弹窗

#### 10.1.1 核心功能
- ✅ **对话界面**: 类似聊天应用
- ✅ **消息历史**: 
  - 本地保存（localStorage）
  - 最多保存100条消息
  - 支持清空历史
- ✅ **消息类型**: 
  - 用户消息（蓝色气泡，右对齐）
  - AI消息（白色气泡，左对齐）
- ✅ **输入功能**: 
  - 文本输入框
  - 发送按钮
  - 支持回车发送
  - 字数统计
- ✅ **自动聚焦**: 打开页面自动聚焦输入框
- ✅ **自动滚动**: 新消息自动滚动到底部

#### 10.1.2 API接口
- **接口地址**: `/api/ai/ask`
- **请求方式**: POST
- **请求参数**: 
  ```json
  {
    "question": "用户问题",
    "locale": "zh-CN"
  }
  ```
- **响应格式**: 
  ```json
  {
    "ok": true,
    "data": {
      "answer": "AI回答",
      "sources": [...],
      "model": "...",
      "safetyFlag": "...",
      "costEstimate": {...}
    }
  }
  ```

#### 10.1.3 认证机制
- **Token获取**: 从 localStorage 或 cookie 获取
- **Token键名**: `USER_TOKEN` 或 `sb-access-token`
- **请求头**: `Authorization: Bearer {token}`

#### 10.1.4 错误处理
- **认证错误**: 显示友好提示，建议刷新页面
- **网络错误**: 显示错误信息
- **超时处理**: 30秒超时
- **错误提示**: 显示在输入框下方

---

## 📊 十一、数据存储说明

### 11.1 题目数据存储

**存储方式**: 离线缓存（打包在应用中）
- **位置**: `src/data/questions/zh/` 目录
- **格式**: JSON 文件
- **加载方式**: 动态 import（Next.js 打包时包含在应用中）
- **特点**: 
  - ✅ 无需网络请求
  - ✅ 离线可用
  - ✅ 加载速度快
  - ✅ 已包含所有题目集（15套题，共750题）

### 11.2 LocalStorage 键值

| 键名 | 用途 | 数据结构 |
|------|------|----------|
| `user_nickname` | 用户昵称 | 字符串 |
| `progress_[题目集名称]` | 学习进度 | JSON对象 |
| `mistakeBook` | 错题本 | JSON数组 |
| `examHistory` | 考试历史 | JSON数组 |
| `practiceHistory` | 做题历史 | JSON数组 |
| `AI_CHAT_HISTORY` | AI聊天历史 | JSON数组 |
| `drive-quiz-activated` | 激活状态 | 字符串 |
| `drive-quiz-email` | 激活邮箱 | 字符串 |
| `USER_TOKEN` | 用户Token | 字符串 |

### 11.3 数据限制
- **练习历史**: 最多保存50条
- **AI聊天历史**: 最多保存100条
- **考试历史**: 无限制
- **错题本**: 无限制

---

## 🔗 十二、API接口汇总

### 12.1 前台使用的API

| 接口路径 | 方法 | 用途 | 说明 |
|----------|------|------|------|
| `/api/videos` | GET | 获取视频列表 | 支持 `?category=basic|advanced` |
| `/api/merchants` | GET | 获取商家列表 | 支持 `?category=分类名` |
| `/api/merchant-categories` | GET | 获取商家分类 | 返回分类列表 |
| `/api/ai/ask` | POST | AI问答 | 需要认证 |

---

## 📝 十三、功能特性总结

### 13.1 已实现功能 ✅

1. **学习系统**
   - ✅ 课程分类展示
   - ✅ 题目答题功能
   - ✅ 进度追踪
   - ✅ 错题自动记录
   - ✅ 学习历史记录

2. **考试系统**
   - ✅ 模拟考试功能
   - ✅ 倒计时功能
   - ✅ 成绩统计
   - ✅ 考试历史保存

3. **游戏系统**
   - ✅ 大乱斗挑战
   - ✅ 生命值系统
   - ✅ 分数系统
   - ✅ 动态时间限制

4. **错题系统**
   - ✅ 错题收集
   - ✅ 错题复习
   - ✅ 错题删除

5. **信息查询**
   - ✅ 食宿信息查询（后端接口）
   - ⚠️ 汽车服务查询（示例数据）

6. **AI助手**
   - ✅ 对话功能
   - ✅ 历史记录
   - ✅ 认证机制

7. **用户中心**
   - ✅ 昵称编辑
   - ✅ 历史查看
   - ✅ 激活管理

### 13.2 待完善功能 ⚠️

1. **汽车模块**: 需要对接后端API
2. **设置功能**: 用户偏好设置未实现
3. **数据同步**: 目前仅本地存储，无云端同步
4. **用户系统**: 无用户注册/登录功能（使用激活码）

---

## 🎯 十四、产品建议

### 14.1 用户体验优化
1. **数据持久化**: 考虑添加云端同步功能（用户进度、错题等）
2. **题目数据**: ✅ 题目数据已离线缓存（打包在应用中，无需网络）
3. **性能优化**: 大量题目加载时的性能优化
4. **错误处理**: 完善网络错误和异常情况的提示

### 14.2 功能扩展建议
1. **学习计划**: 添加学习计划功能
2. **排行榜**: 大乱斗排行榜功能
3. **成就系统**: 学习成就和徽章系统
4. **社交功能**: 分享学习成果功能

### 14.3 数据完善
1. **汽车服务**: 完善汽车服务后端接口
2. **商家信息**: 考虑添加地图功能
3. **视频管理**: 完善视频分类和管理

---

## 📌 十五、技术栈说明

- **框架**: Next.js (App Router)
- **语言**: TypeScript
- **样式**: Tailwind CSS
- **状态管理**: React Hooks + localStorage
- **图标**: Lucide React
- **图片**: Next.js Image组件

---

**文档结束**

---
*本文档基于当前代码库分析生成，如有疑问请参考实际代码实现。*

