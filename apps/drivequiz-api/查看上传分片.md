# æŸ¥çœ‹ Datapull ä¸Šä¼ çš„åˆ†ç‰‡

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ psql ç›´æ¥æŸ¥è¯¢ï¼ˆæœ€ç®€å•ï¼‰

```bash
# è¿æ¥æ•°æ®åº“
psql "postgresql://postgres:zKV0rtIV1QOByu89@db.cgpmpfnjzlzbakmmrj.supabase.co:5432/postgres?sslmode=require"
```

ç„¶åæ‰§è¡Œä»¥ä¸‹ SQLï¼š

```sql
-- 1. æŸ¥çœ‹æœ€è¿‘çš„æ“ä½œè®°å½•
SELECT 
  operation_id,
  source_id,
  status,
  docs_count,
  failed_count,
  created_at
FROM rag_operations
ORDER BY created_at DESC
LIMIT 10;

-- 2. æŸ¥çœ‹æœ€è¿‘çš„æ–‡æ¡£
SELECT 
  doc_id,
  title,
  url,
  version,
  lang,
  source_id,
  vectorization_status,
  LEFT(content, 100) as content_preview,
  created_at
FROM rag_documents
ORDER BY created_at DESC
LIMIT 20;

-- 3. æŸ¥çœ‹ç‰¹å®šæ“ä½œçš„æ‰€æœ‰æ–‡æ¡£ï¼ˆæ›¿æ¢ operation_idï¼‰
SELECT 
  d.doc_id,
  d.title,
  d.url,
  d.version,
  LEFT(d.content, 200) as content_preview,
  od.status as upload_status
FROM rag_operation_documents od
LEFT JOIN rag_documents d ON od.doc_id = d.doc_id
WHERE od.operation_id = 'op_xxx'  -- æ›¿æ¢ä¸ºå®é™…çš„æ“ä½œID
ORDER BY od.created_at;
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨ APIï¼ˆéœ€è¦ Tokenï¼‰

```bash
# è·å– Token
TOKEN=$(grep "^DRIVEQUIZ_API_TOKEN_SECRET=" .env | cut -d'=' -f2)

# æŸ¥è¯¢æ“ä½œè®°å½•
curl -X GET "http://localhost:8789/api/v1/rag/operations?limit=5" \
  -H "Authorization: Bearer $TOKEN"

# æŸ¥è¯¢æ“ä½œè¯¦æƒ…ï¼ˆæ›¿æ¢ operationIdï¼‰
curl -X GET "http://localhost:8789/api/v1/rag/operations/<operationId>" \
  -H "Authorization: Bearer $TOKEN"
```

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨æŸ¥è¯¢è„šæœ¬

```bash
# æŸ¥çœ‹æ‰€æœ‰æ–‡æ¡£
npx tsx scripts/query-documents.ts

# æŒ‰æ¥æºIDè¿‡æ»¤
npx tsx scripts/query-documents.ts --sourceId=your_source_id

# æŸ¥çœ‹ç‰¹å®šæ“ä½œ
npx tsx scripts/query-documents.ts --operationId=op_xxx

# æ˜¾ç¤ºæ–‡æ¡£å†…å®¹
npx tsx scripts/query-documents.ts --show-content
```

---

## ğŸ“‹ å¸¸ç”¨æŸ¥è¯¢

### æŸ¥çœ‹æ‰€æœ‰æ“ä½œè®°å½•

```sql
SELECT * FROM rag_operations ORDER BY created_at DESC LIMIT 10;
```

### æŸ¥çœ‹æ‰€æœ‰æ–‡æ¡£

```sql
SELECT 
  doc_id,
  title,
  url,
  source_id,
  vectorization_status,
  created_at
FROM rag_documents
ORDER BY created_at DESC
LIMIT 20;
```

### æŸ¥çœ‹ç‰¹å®šæ¥æºçš„æ–‡æ¡£

```sql
SELECT * FROM rag_documents
WHERE source_id = 'your_source_id'
ORDER BY created_at DESC;
```

### æŸ¥çœ‹æ“ä½œå…³è”çš„æ–‡æ¡£

```sql
SELECT 
  d.*,
  od.status as upload_status
FROM rag_operation_documents od
LEFT JOIN rag_documents d ON od.doc_id = d.doc_id
WHERE od.operation_id = 'op_xxx'
ORDER BY od.created_at;
```

### ç»Ÿè®¡ä¿¡æ¯

```sql
SELECT 
  source_id,
  COUNT(*) as total,
  COUNT(CASE WHEN vectorization_status = 'completed' THEN 1 END) as vectorized
FROM rag_documents
GROUP BY source_id;
```

---

## ğŸ” è¯¦ç»†æŸ¥è¯¢æŒ‡å—

æ›´å¤šæŸ¥è¯¢æ–¹æ³•è¯·å‚è€ƒï¼š`QUERY_GUIDE.md`

---

**æç¤º**ï¼šå¦‚æœé‡åˆ° SSL è¯ä¹¦é”™è¯¯ï¼Œç¡®ä¿ä½¿ç”¨ `sslmode=require` å‚æ•°ã€‚

